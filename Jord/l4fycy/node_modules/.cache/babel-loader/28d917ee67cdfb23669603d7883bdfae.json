{"ast":null,"code":"import _classCallCheck from \"D:/Github/NIKE-DJANGO/Jord/l4fycy/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"D:/Github/NIKE-DJANGO/Jord/l4fycy/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"D:/Github/NIKE-DJANGO/Jord/l4fycy/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"D:/Github/NIKE-DJANGO/Jord/l4fycy/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport { Loader, FileLoader, TextureLoader, LoaderUtils, Group, Color, Matrix4, BufferGeometry, Float32BufferAttribute, Mesh, MeshPhongMaterial, BufferAttribute, MeshStandardMaterial, sRGBEncoding, RepeatWrapping, ClampToEdgeWrapping, MirroredRepeatWrapping, LinearFilter, LinearMipmapLinearFilter, NearestFilter } from 'three';\nimport { unzipSync } from 'fflate';\n/**\r\n *\r\n * 3D Manufacturing Format (3MF) specification: https://3mf.io/specification/\r\n *\r\n * The following features from the core specification are supported:\r\n *\r\n * - 3D Models\r\n * - Object Resources (Meshes and Components)\r\n * - Material Resources (Base Materials)\r\n *\r\n * 3MF Materials and Properties Extension are only partially supported.\r\n *\r\n * - Texture 2D\r\n * - Texture 2D Groups\r\n * - Color Groups (Vertex Colors)\r\n * - Metallic Display Properties (PBR)\r\n */\n\nvar ThreeMFLoader = /*#__PURE__*/function (_Loader) {\n  _inherits(ThreeMFLoader, _Loader);\n\n  var _super = _createSuper(ThreeMFLoader);\n\n  function ThreeMFLoader(manager) {\n    var _this;\n\n    _classCallCheck(this, ThreeMFLoader);\n\n    _this = _super.call(this, manager);\n    _this.availableExtensions = [];\n    return _this;\n  }\n\n  _createClass(ThreeMFLoader, [{\n    key: \"load\",\n    value: function load(url, onLoad, onProgress, onError) {\n      var scope = this;\n      var loader = new FileLoader(scope.manager);\n      loader.setPath(scope.path);\n      loader.setResponseType('arraybuffer');\n      loader.setRequestHeader(scope.requestHeader);\n      loader.setWithCredentials(scope.withCredentials);\n      loader.load(url, function (buffer) {\n        try {\n          onLoad(scope.parse(buffer));\n        } catch (e) {\n          if (onError) {\n            onError(e);\n          } else {\n            console.error(e);\n          }\n\n          scope.manager.itemError(url);\n        }\n      }, onProgress, onError);\n    }\n  }, {\n    key: \"parse\",\n    value: function parse(data) {\n      var scope = this;\n      var textureLoader = new TextureLoader(this.manager);\n\n      function loadDocument(data) {\n        var zip = null;\n        var file = null;\n        var relsName;\n        var modelRelsName;\n        var modelPartNames = [];\n        var texturesPartNames = [];\n        var modelRels;\n        var modelParts = {};\n        var printTicketParts = {};\n        var texturesParts = {};\n        var otherParts = {};\n\n        try {\n          zip = unzipSync(new Uint8Array(data)); // eslint-disable-line no-undef\n        } catch (e) {\n          if (e instanceof ReferenceError) {\n            console.error('THREE.3MFLoader: fflate missing and file is compressed.');\n            return null;\n          }\n        }\n\n        for (file in zip) {\n          if (file.match(/\\_rels\\/.rels$/)) {\n            relsName = file;\n          } else if (file.match(/3D\\/_rels\\/.*\\.model\\.rels$/)) {\n            modelRelsName = file;\n          } else if (file.match(/^3D\\/.*\\.model$/)) {\n            modelPartNames.push(file);\n          } else if (file.match(/^3D\\/Metadata\\/.*\\.xml$/)) ;else if (file.match(/^3D\\/Textures?\\/.*/)) {\n            texturesPartNames.push(file);\n          } else if (file.match(/^3D\\/Other\\/.*/)) ;\n        } //\n\n\n        var relsView = zip[relsName];\n        var relsFileText = LoaderUtils.decodeText(relsView);\n        var rels = parseRelsXml(relsFileText); //\n\n        if (modelRelsName) {\n          var _relsView = zip[modelRelsName];\n\n          var _relsFileText = LoaderUtils.decodeText(_relsView);\n\n          modelRels = parseRelsXml(_relsFileText);\n        } //\n\n\n        for (var i = 0; i < modelPartNames.length; i++) {\n          var modelPart = modelPartNames[i];\n          var view = zip[modelPart];\n          var fileText = LoaderUtils.decodeText(view);\n          var xmlData = new DOMParser().parseFromString(fileText, 'application/xml');\n\n          if (xmlData.documentElement.nodeName.toLowerCase() !== 'model') {\n            console.error('THREE.3MFLoader: Error loading 3MF - no 3MF document found: ', modelPart);\n          }\n\n          var modelNode = xmlData.querySelector('model');\n          var extensions = {};\n\n          for (var _i = 0; _i < modelNode.attributes.length; _i++) {\n            var attr = modelNode.attributes[_i];\n\n            if (attr.name.match(/^xmlns:(.+)$/)) {\n              extensions[attr.value] = RegExp.$1;\n            }\n          }\n\n          var modelData = parseModelNode(modelNode);\n          modelData['xml'] = modelNode;\n\n          if (0 < Object.keys(extensions).length) {\n            modelData['extensions'] = extensions;\n          }\n\n          modelParts[modelPart] = modelData;\n        } //\n\n\n        for (var _i2 = 0; _i2 < texturesPartNames.length; _i2++) {\n          var texturesPartName = texturesPartNames[_i2];\n          texturesParts[texturesPartName] = zip[texturesPartName].buffer;\n        }\n\n        return {\n          rels: rels,\n          modelRels: modelRels,\n          model: modelParts,\n          printTicket: printTicketParts,\n          texture: texturesParts,\n          other: otherParts\n        };\n      }\n\n      function parseRelsXml(relsFileText) {\n        var relationships = [];\n        var relsXmlData = new DOMParser().parseFromString(relsFileText, 'application/xml');\n        var relsNodes = relsXmlData.querySelectorAll('Relationship');\n\n        for (var i = 0; i < relsNodes.length; i++) {\n          var relsNode = relsNodes[i];\n          var relationship = {\n            target: relsNode.getAttribute('Target'),\n            //required\n            id: relsNode.getAttribute('Id'),\n            //required\n            type: relsNode.getAttribute('Type') //required\n\n          };\n          relationships.push(relationship);\n        }\n\n        return relationships;\n      }\n\n      function parseMetadataNodes(metadataNodes) {\n        var metadataData = {};\n\n        for (var i = 0; i < metadataNodes.length; i++) {\n          var metadataNode = metadataNodes[i];\n          var name = metadataNode.getAttribute('name');\n          var validNames = ['Title', 'Designer', 'Description', 'Copyright', 'LicenseTerms', 'Rating', 'CreationDate', 'ModificationDate'];\n\n          if (0 <= validNames.indexOf(name)) {\n            metadataData[name] = metadataNode.textContent;\n          }\n        }\n\n        return metadataData;\n      }\n\n      function parseBasematerialsNode(basematerialsNode) {\n        var basematerialsData = {\n          id: basematerialsNode.getAttribute('id'),\n          // required\n          basematerials: []\n        };\n        var basematerialNodes = basematerialsNode.querySelectorAll('base');\n\n        for (var i = 0; i < basematerialNodes.length; i++) {\n          var basematerialNode = basematerialNodes[i];\n          var basematerialData = parseBasematerialNode(basematerialNode);\n          basematerialData.index = i; // the order and count of the material nodes form an implicit 0-based index\n\n          basematerialsData.basematerials.push(basematerialData);\n        }\n\n        return basematerialsData;\n      }\n\n      function parseTexture2DNode(texture2DNode) {\n        var texture2dData = {\n          id: texture2DNode.getAttribute('id'),\n          // required\n          path: texture2DNode.getAttribute('path'),\n          // required\n          contenttype: texture2DNode.getAttribute('contenttype'),\n          // required\n          tilestyleu: texture2DNode.getAttribute('tilestyleu'),\n          tilestylev: texture2DNode.getAttribute('tilestylev'),\n          filter: texture2DNode.getAttribute('filter')\n        };\n        return texture2dData;\n      }\n\n      function parseTextures2DGroupNode(texture2DGroupNode) {\n        var texture2DGroupData = {\n          id: texture2DGroupNode.getAttribute('id'),\n          // required\n          texid: texture2DGroupNode.getAttribute('texid'),\n          // required\n          displaypropertiesid: texture2DGroupNode.getAttribute('displaypropertiesid')\n        };\n        var tex2coordNodes = texture2DGroupNode.querySelectorAll('tex2coord');\n        var uvs = [];\n\n        for (var i = 0; i < tex2coordNodes.length; i++) {\n          var tex2coordNode = tex2coordNodes[i];\n          var u = tex2coordNode.getAttribute('u');\n          var v = tex2coordNode.getAttribute('v');\n          uvs.push(parseFloat(u), parseFloat(v));\n        }\n\n        texture2DGroupData['uvs'] = new Float32Array(uvs);\n        return texture2DGroupData;\n      }\n\n      function parseColorGroupNode(colorGroupNode) {\n        var colorGroupData = {\n          id: colorGroupNode.getAttribute('id'),\n          // required\n          displaypropertiesid: colorGroupNode.getAttribute('displaypropertiesid')\n        };\n        var colorNodes = colorGroupNode.querySelectorAll('color');\n        var colors = [];\n        var colorObject = new Color();\n\n        for (var i = 0; i < colorNodes.length; i++) {\n          var colorNode = colorNodes[i];\n          var color = colorNode.getAttribute('color');\n          colorObject.setStyle(color.substring(0, 7));\n          colorObject.convertSRGBToLinear(); // color is in sRGB\n\n          colors.push(colorObject.r, colorObject.g, colorObject.b);\n        }\n\n        colorGroupData['colors'] = new Float32Array(colors);\n        return colorGroupData;\n      }\n\n      function parseMetallicDisplaypropertiesNode(metallicDisplaypropetiesNode) {\n        var metallicDisplaypropertiesData = {\n          id: metallicDisplaypropetiesNode.getAttribute('id') // required\n\n        };\n        var metallicNodes = metallicDisplaypropetiesNode.querySelectorAll('pbmetallic');\n        var metallicData = [];\n\n        for (var i = 0; i < metallicNodes.length; i++) {\n          var metallicNode = metallicNodes[i];\n          metallicData.push({\n            name: metallicNode.getAttribute('name'),\n            // required\n            metallicness: parseFloat(metallicNode.getAttribute('metallicness')),\n            // required\n            roughness: parseFloat(metallicNode.getAttribute('roughness')) // required\n\n          });\n        }\n\n        metallicDisplaypropertiesData.data = metallicData;\n        return metallicDisplaypropertiesData;\n      }\n\n      function parseBasematerialNode(basematerialNode) {\n        var basematerialData = {};\n        basematerialData['name'] = basematerialNode.getAttribute('name'); // required\n\n        basematerialData['displaycolor'] = basematerialNode.getAttribute('displaycolor'); // required\n\n        basematerialData['displaypropertiesid'] = basematerialNode.getAttribute('displaypropertiesid');\n        return basematerialData;\n      }\n\n      function parseMeshNode(meshNode) {\n        var meshData = {};\n        var vertices = [];\n        var vertexNodes = meshNode.querySelectorAll('vertices vertex');\n\n        for (var i = 0; i < vertexNodes.length; i++) {\n          var vertexNode = vertexNodes[i];\n          var x = vertexNode.getAttribute('x');\n          var y = vertexNode.getAttribute('y');\n          var z = vertexNode.getAttribute('z');\n          vertices.push(parseFloat(x), parseFloat(y), parseFloat(z));\n        }\n\n        meshData['vertices'] = new Float32Array(vertices);\n        var triangleProperties = [];\n        var triangles = [];\n        var triangleNodes = meshNode.querySelectorAll('triangles triangle');\n\n        for (var _i3 = 0; _i3 < triangleNodes.length; _i3++) {\n          var triangleNode = triangleNodes[_i3];\n          var v1 = triangleNode.getAttribute('v1');\n          var v2 = triangleNode.getAttribute('v2');\n          var v3 = triangleNode.getAttribute('v3');\n          var p1 = triangleNode.getAttribute('p1');\n          var p2 = triangleNode.getAttribute('p2');\n          var p3 = triangleNode.getAttribute('p3');\n          var pid = triangleNode.getAttribute('pid');\n          var triangleProperty = {};\n          triangleProperty['v1'] = parseInt(v1, 10);\n          triangleProperty['v2'] = parseInt(v2, 10);\n          triangleProperty['v3'] = parseInt(v3, 10);\n          triangles.push(triangleProperty['v1'], triangleProperty['v2'], triangleProperty['v3']); // optional\n\n          if (p1) {\n            triangleProperty['p1'] = parseInt(p1, 10);\n          }\n\n          if (p2) {\n            triangleProperty['p2'] = parseInt(p2, 10);\n          }\n\n          if (p3) {\n            triangleProperty['p3'] = parseInt(p3, 10);\n          }\n\n          if (pid) {\n            triangleProperty['pid'] = pid;\n          }\n\n          if (0 < Object.keys(triangleProperty).length) {\n            triangleProperties.push(triangleProperty);\n          }\n        }\n\n        meshData['triangleProperties'] = triangleProperties;\n        meshData['triangles'] = new Uint32Array(triangles);\n        return meshData;\n      }\n\n      function parseComponentsNode(componentsNode) {\n        var components = [];\n        var componentNodes = componentsNode.querySelectorAll('component');\n\n        for (var i = 0; i < componentNodes.length; i++) {\n          var componentNode = componentNodes[i];\n          var componentData = parseComponentNode(componentNode);\n          components.push(componentData);\n        }\n\n        return components;\n      }\n\n      function parseComponentNode(componentNode) {\n        var componentData = {};\n        componentData['objectId'] = componentNode.getAttribute('objectid'); // required\n\n        var transform = componentNode.getAttribute('transform');\n\n        if (transform) {\n          componentData['transform'] = parseTransform(transform);\n        }\n\n        return componentData;\n      }\n\n      function parseTransform(transform) {\n        var t = [];\n        transform.split(' ').forEach(function (s) {\n          t.push(parseFloat(s));\n        });\n        var matrix = new Matrix4();\n        matrix.set(t[0], t[3], t[6], t[9], t[1], t[4], t[7], t[10], t[2], t[5], t[8], t[11], 0.0, 0.0, 0.0, 1.0);\n        return matrix;\n      }\n\n      function parseObjectNode(objectNode) {\n        var objectData = {\n          type: objectNode.getAttribute('type')\n        };\n        var id = objectNode.getAttribute('id');\n\n        if (id) {\n          objectData['id'] = id;\n        }\n\n        var pid = objectNode.getAttribute('pid');\n\n        if (pid) {\n          objectData['pid'] = pid;\n        }\n\n        var pindex = objectNode.getAttribute('pindex');\n\n        if (pindex) {\n          objectData['pindex'] = pindex;\n        }\n\n        var thumbnail = objectNode.getAttribute('thumbnail');\n\n        if (thumbnail) {\n          objectData['thumbnail'] = thumbnail;\n        }\n\n        var partnumber = objectNode.getAttribute('partnumber');\n\n        if (partnumber) {\n          objectData['partnumber'] = partnumber;\n        }\n\n        var name = objectNode.getAttribute('name');\n\n        if (name) {\n          objectData['name'] = name;\n        }\n\n        var meshNode = objectNode.querySelector('mesh');\n\n        if (meshNode) {\n          objectData['mesh'] = parseMeshNode(meshNode);\n        }\n\n        var componentsNode = objectNode.querySelector('components');\n\n        if (componentsNode) {\n          objectData['components'] = parseComponentsNode(componentsNode);\n        }\n\n        return objectData;\n      }\n\n      function parseResourcesNode(resourcesNode) {\n        var resourcesData = {};\n        resourcesData['basematerials'] = {};\n        var basematerialsNodes = resourcesNode.querySelectorAll('basematerials');\n\n        for (var i = 0; i < basematerialsNodes.length; i++) {\n          var basematerialsNode = basematerialsNodes[i];\n          var basematerialsData = parseBasematerialsNode(basematerialsNode);\n          resourcesData['basematerials'][basematerialsData['id']] = basematerialsData;\n        } //\n\n\n        resourcesData['texture2d'] = {};\n        var textures2DNodes = resourcesNode.querySelectorAll('texture2d');\n\n        for (var _i4 = 0; _i4 < textures2DNodes.length; _i4++) {\n          var textures2DNode = textures2DNodes[_i4];\n          var texture2DData = parseTexture2DNode(textures2DNode);\n          resourcesData['texture2d'][texture2DData['id']] = texture2DData;\n        } //\n\n\n        resourcesData['colorgroup'] = {};\n        var colorGroupNodes = resourcesNode.querySelectorAll('colorgroup');\n\n        for (var _i5 = 0; _i5 < colorGroupNodes.length; _i5++) {\n          var colorGroupNode = colorGroupNodes[_i5];\n          var colorGroupData = parseColorGroupNode(colorGroupNode);\n          resourcesData['colorgroup'][colorGroupData['id']] = colorGroupData;\n        } //\n\n\n        resourcesData['pbmetallicdisplayproperties'] = {};\n        var pbmetallicdisplaypropertiesNodes = resourcesNode.querySelectorAll('pbmetallicdisplayproperties');\n\n        for (var _i6 = 0; _i6 < pbmetallicdisplaypropertiesNodes.length; _i6++) {\n          var pbmetallicdisplaypropertiesNode = pbmetallicdisplaypropertiesNodes[_i6];\n          var pbmetallicdisplaypropertiesData = parseMetallicDisplaypropertiesNode(pbmetallicdisplaypropertiesNode);\n          resourcesData['pbmetallicdisplayproperties'][pbmetallicdisplaypropertiesData['id']] = pbmetallicdisplaypropertiesData;\n        } //\n\n\n        resourcesData['texture2dgroup'] = {};\n        var textures2DGroupNodes = resourcesNode.querySelectorAll('texture2dgroup');\n\n        for (var _i7 = 0; _i7 < textures2DGroupNodes.length; _i7++) {\n          var textures2DGroupNode = textures2DGroupNodes[_i7];\n          var textures2DGroupData = parseTextures2DGroupNode(textures2DGroupNode);\n          resourcesData['texture2dgroup'][textures2DGroupData['id']] = textures2DGroupData;\n        } //\n\n\n        resourcesData['object'] = {};\n        var objectNodes = resourcesNode.querySelectorAll('object');\n\n        for (var _i8 = 0; _i8 < objectNodes.length; _i8++) {\n          var objectNode = objectNodes[_i8];\n          var objectData = parseObjectNode(objectNode);\n          resourcesData['object'][objectData['id']] = objectData;\n        }\n\n        return resourcesData;\n      }\n\n      function parseBuildNode(buildNode) {\n        var buildData = [];\n        var itemNodes = buildNode.querySelectorAll('item');\n\n        for (var i = 0; i < itemNodes.length; i++) {\n          var itemNode = itemNodes[i];\n          var buildItem = {\n            objectId: itemNode.getAttribute('objectid')\n          };\n          var transform = itemNode.getAttribute('transform');\n\n          if (transform) {\n            buildItem['transform'] = parseTransform(transform);\n          }\n\n          buildData.push(buildItem);\n        }\n\n        return buildData;\n      }\n\n      function parseModelNode(modelNode) {\n        var modelData = {\n          unit: modelNode.getAttribute('unit') || 'millimeter'\n        };\n        var metadataNodes = modelNode.querySelectorAll('metadata');\n\n        if (metadataNodes) {\n          modelData['metadata'] = parseMetadataNodes(metadataNodes);\n        }\n\n        var resourcesNode = modelNode.querySelector('resources');\n\n        if (resourcesNode) {\n          modelData['resources'] = parseResourcesNode(resourcesNode);\n        }\n\n        var buildNode = modelNode.querySelector('build');\n\n        if (buildNode) {\n          modelData['build'] = parseBuildNode(buildNode);\n        }\n\n        return modelData;\n      }\n\n      function buildTexture(texture2dgroup, objects, modelData, textureData) {\n        var texid = texture2dgroup.texid;\n        var texture2ds = modelData.resources.texture2d;\n        var texture2d = texture2ds[texid];\n\n        if (texture2d) {\n          var _data = textureData[texture2d.path];\n          var type = texture2d.contenttype;\n          var blob = new Blob([_data], {\n            type: type\n          });\n          var sourceURI = URL.createObjectURL(blob);\n          var texture = textureLoader.load(sourceURI, function () {\n            URL.revokeObjectURL(sourceURI);\n          });\n          texture.encoding = sRGBEncoding; // texture parameters\n\n          switch (texture2d.tilestyleu) {\n            case 'wrap':\n              texture.wrapS = RepeatWrapping;\n              break;\n\n            case 'mirror':\n              texture.wrapS = MirroredRepeatWrapping;\n              break;\n\n            case 'none':\n            case 'clamp':\n              texture.wrapS = ClampToEdgeWrapping;\n              break;\n\n            default:\n              texture.wrapS = RepeatWrapping;\n          }\n\n          switch (texture2d.tilestylev) {\n            case 'wrap':\n              texture.wrapT = RepeatWrapping;\n              break;\n\n            case 'mirror':\n              texture.wrapT = MirroredRepeatWrapping;\n              break;\n\n            case 'none':\n            case 'clamp':\n              texture.wrapT = ClampToEdgeWrapping;\n              break;\n\n            default:\n              texture.wrapT = RepeatWrapping;\n          }\n\n          switch (texture2d.filter) {\n            case 'auto':\n              texture.magFilter = LinearFilter;\n              texture.minFilter = LinearMipmapLinearFilter;\n              break;\n\n            case 'linear':\n              texture.magFilter = LinearFilter;\n              texture.minFilter = LinearFilter;\n              break;\n\n            case 'nearest':\n              texture.magFilter = NearestFilter;\n              texture.minFilter = NearestFilter;\n              break;\n\n            default:\n              texture.magFilter = LinearFilter;\n              texture.minFilter = LinearMipmapLinearFilter;\n          }\n\n          return texture;\n        } else {\n          return null;\n        }\n      }\n\n      function buildBasematerialsMeshes(basematerials, triangleProperties, meshData, objects, modelData, textureData, objectData) {\n        var objectPindex = objectData.pindex;\n        var materialMap = {};\n\n        for (var i = 0, l = triangleProperties.length; i < l; i++) {\n          var triangleProperty = triangleProperties[i];\n          var pindex = triangleProperty.p1 !== undefined ? triangleProperty.p1 : objectPindex;\n          if (materialMap[pindex] === undefined) materialMap[pindex] = [];\n          materialMap[pindex].push(triangleProperty);\n        } //\n\n\n        var keys = Object.keys(materialMap);\n        var meshes = [];\n\n        for (var _i9 = 0, _l = keys.length; _i9 < _l; _i9++) {\n          var materialIndex = keys[_i9];\n          var trianglePropertiesProps = materialMap[materialIndex];\n          var basematerialData = basematerials.basematerials[materialIndex];\n          var material = getBuild(basematerialData, objects, modelData, textureData, objectData, buildBasematerial); //\n\n          var geometry = new BufferGeometry();\n          var positionData = [];\n          var vertices = meshData.vertices;\n\n          for (var j = 0, jl = trianglePropertiesProps.length; j < jl; j++) {\n            var _triangleProperty = trianglePropertiesProps[j];\n            positionData.push(vertices[_triangleProperty.v1 * 3 + 0]);\n            positionData.push(vertices[_triangleProperty.v1 * 3 + 1]);\n            positionData.push(vertices[_triangleProperty.v1 * 3 + 2]);\n            positionData.push(vertices[_triangleProperty.v2 * 3 + 0]);\n            positionData.push(vertices[_triangleProperty.v2 * 3 + 1]);\n            positionData.push(vertices[_triangleProperty.v2 * 3 + 2]);\n            positionData.push(vertices[_triangleProperty.v3 * 3 + 0]);\n            positionData.push(vertices[_triangleProperty.v3 * 3 + 1]);\n            positionData.push(vertices[_triangleProperty.v3 * 3 + 2]);\n          }\n\n          geometry.setAttribute('position', new Float32BufferAttribute(positionData, 3)); //\n\n          var mesh = new Mesh(geometry, material);\n          meshes.push(mesh);\n        }\n\n        return meshes;\n      }\n\n      function buildTexturedMesh(texture2dgroup, triangleProperties, meshData, objects, modelData, textureData, objectData) {\n        // geometry\n        var geometry = new BufferGeometry();\n        var positionData = [];\n        var uvData = [];\n        var vertices = meshData.vertices;\n        var uvs = texture2dgroup.uvs;\n\n        for (var i = 0, l = triangleProperties.length; i < l; i++) {\n          var triangleProperty = triangleProperties[i];\n          positionData.push(vertices[triangleProperty.v1 * 3 + 0]);\n          positionData.push(vertices[triangleProperty.v1 * 3 + 1]);\n          positionData.push(vertices[triangleProperty.v1 * 3 + 2]);\n          positionData.push(vertices[triangleProperty.v2 * 3 + 0]);\n          positionData.push(vertices[triangleProperty.v2 * 3 + 1]);\n          positionData.push(vertices[triangleProperty.v2 * 3 + 2]);\n          positionData.push(vertices[triangleProperty.v3 * 3 + 0]);\n          positionData.push(vertices[triangleProperty.v3 * 3 + 1]);\n          positionData.push(vertices[triangleProperty.v3 * 3 + 2]); //\n\n          uvData.push(uvs[triangleProperty.p1 * 2 + 0]);\n          uvData.push(uvs[triangleProperty.p1 * 2 + 1]);\n          uvData.push(uvs[triangleProperty.p2 * 2 + 0]);\n          uvData.push(uvs[triangleProperty.p2 * 2 + 1]);\n          uvData.push(uvs[triangleProperty.p3 * 2 + 0]);\n          uvData.push(uvs[triangleProperty.p3 * 2 + 1]);\n        }\n\n        geometry.setAttribute('position', new Float32BufferAttribute(positionData, 3));\n        geometry.setAttribute('uv', new Float32BufferAttribute(uvData, 2)); // material\n\n        var texture = getBuild(texture2dgroup, objects, modelData, textureData, objectData, buildTexture);\n        var material = new MeshPhongMaterial({\n          map: texture,\n          flatShading: true\n        }); // mesh\n\n        var mesh = new Mesh(geometry, material);\n        return mesh;\n      }\n\n      function buildVertexColorMesh(colorgroup, triangleProperties, meshData, objects, modelData, objectData) {\n        // geometry\n        var geometry = new BufferGeometry();\n        var positionData = [];\n        var colorData = [];\n        var vertices = meshData.vertices;\n        var colors = colorgroup.colors;\n\n        for (var i = 0, l = triangleProperties.length; i < l; i++) {\n          var triangleProperty = triangleProperties[i];\n          var v1 = triangleProperty.v1;\n          var v2 = triangleProperty.v2;\n          var v3 = triangleProperty.v3;\n          positionData.push(vertices[v1 * 3 + 0]);\n          positionData.push(vertices[v1 * 3 + 1]);\n          positionData.push(vertices[v1 * 3 + 2]);\n          positionData.push(vertices[v2 * 3 + 0]);\n          positionData.push(vertices[v2 * 3 + 1]);\n          positionData.push(vertices[v2 * 3 + 2]);\n          positionData.push(vertices[v3 * 3 + 0]);\n          positionData.push(vertices[v3 * 3 + 1]);\n          positionData.push(vertices[v3 * 3 + 2]); //\n\n          var p1 = triangleProperty.p1 !== undefined ? triangleProperty.p1 : objectData.pindex;\n          var p2 = triangleProperty.p2 !== undefined ? triangleProperty.p2 : p1;\n          var p3 = triangleProperty.p3 !== undefined ? triangleProperty.p3 : p1;\n          colorData.push(colors[p1 * 3 + 0]);\n          colorData.push(colors[p1 * 3 + 1]);\n          colorData.push(colors[p1 * 3 + 2]);\n          colorData.push(colors[p2 * 3 + 0]);\n          colorData.push(colors[p2 * 3 + 1]);\n          colorData.push(colors[p2 * 3 + 2]);\n          colorData.push(colors[p3 * 3 + 0]);\n          colorData.push(colors[p3 * 3 + 1]);\n          colorData.push(colors[p3 * 3 + 2]);\n        }\n\n        geometry.setAttribute('position', new Float32BufferAttribute(positionData, 3));\n        geometry.setAttribute('color', new Float32BufferAttribute(colorData, 3)); // material\n\n        var material = new MeshPhongMaterial({\n          vertexColors: true,\n          flatShading: true\n        }); // mesh\n\n        var mesh = new Mesh(geometry, material);\n        return mesh;\n      }\n\n      function buildDefaultMesh(meshData) {\n        var geometry = new BufferGeometry();\n        geometry.setIndex(new BufferAttribute(meshData['triangles'], 1));\n        geometry.setAttribute('position', new BufferAttribute(meshData['vertices'], 3));\n        var material = new MeshPhongMaterial({\n          color: 0xaaaaff,\n          flatShading: true\n        });\n        var mesh = new Mesh(geometry, material);\n        return mesh;\n      }\n\n      function buildMeshes(resourceMap, meshData, objects, modelData, textureData, objectData) {\n        var keys = Object.keys(resourceMap);\n        var meshes = [];\n\n        for (var i = 0, il = keys.length; i < il; i++) {\n          var resourceId = keys[i];\n          var triangleProperties = resourceMap[resourceId];\n          var resourceType = getResourceType(resourceId, modelData);\n\n          switch (resourceType) {\n            case 'material':\n              var basematerials = modelData.resources.basematerials[resourceId];\n              var newMeshes = buildBasematerialsMeshes(basematerials, triangleProperties, meshData, objects, modelData, textureData, objectData);\n\n              for (var j = 0, jl = newMeshes.length; j < jl; j++) {\n                meshes.push(newMeshes[j]);\n              }\n\n              break;\n\n            case 'texture':\n              var texture2dgroup = modelData.resources.texture2dgroup[resourceId];\n              meshes.push(buildTexturedMesh(texture2dgroup, triangleProperties, meshData, objects, modelData, textureData, objectData));\n              break;\n\n            case 'vertexColors':\n              var colorgroup = modelData.resources.colorgroup[resourceId];\n              meshes.push(buildVertexColorMesh(colorgroup, triangleProperties, meshData, objects, modelData, objectData));\n              break;\n\n            case 'default':\n              meshes.push(buildDefaultMesh(meshData));\n              break;\n\n            default:\n              console.error('THREE.3MFLoader: Unsupported resource type.');\n          }\n        }\n\n        return meshes;\n      }\n\n      function getResourceType(pid, modelData) {\n        if (modelData.resources.texture2dgroup[pid] !== undefined) {\n          return 'texture';\n        } else if (modelData.resources.basematerials[pid] !== undefined) {\n          return 'material';\n        } else if (modelData.resources.colorgroup[pid] !== undefined) {\n          return 'vertexColors';\n        } else if (pid === 'default') {\n          return 'default';\n        } else {\n          return undefined;\n        }\n      }\n\n      function analyzeObject(modelData, meshData, objectData) {\n        var resourceMap = {};\n        var triangleProperties = meshData['triangleProperties'];\n        var objectPid = objectData.pid;\n\n        for (var i = 0, l = triangleProperties.length; i < l; i++) {\n          var triangleProperty = triangleProperties[i];\n          var pid = triangleProperty.pid !== undefined ? triangleProperty.pid : objectPid;\n          if (pid === undefined) pid = 'default';\n          if (resourceMap[pid] === undefined) resourceMap[pid] = [];\n          resourceMap[pid].push(triangleProperty);\n        }\n\n        return resourceMap;\n      }\n\n      function buildGroup(meshData, objects, modelData, textureData, objectData) {\n        var group = new Group();\n        var resourceMap = analyzeObject(modelData, meshData, objectData);\n        var meshes = buildMeshes(resourceMap, meshData, objects, modelData, textureData, objectData);\n\n        for (var i = 0, l = meshes.length; i < l; i++) {\n          group.add(meshes[i]);\n        }\n\n        return group;\n      }\n\n      function applyExtensions(extensions, meshData, modelXml) {\n        if (!extensions) {\n          return;\n        }\n\n        var availableExtensions = [];\n        var keys = Object.keys(extensions);\n\n        for (var i = 0; i < keys.length; i++) {\n          var ns = keys[i];\n\n          for (var j = 0; j < scope.availableExtensions.length; j++) {\n            var extension = scope.availableExtensions[j];\n\n            if (extension.ns === ns) {\n              availableExtensions.push(extension);\n            }\n          }\n        }\n\n        for (var _i10 = 0; _i10 < availableExtensions.length; _i10++) {\n          var _extension = availableExtensions[_i10];\n\n          _extension.apply(modelXml, extensions[_extension['ns']], meshData);\n        }\n      }\n\n      function getBuild(data, objects, modelData, textureData, objectData, builder) {\n        if (data.build !== undefined) return data.build;\n        data.build = builder(data, objects, modelData, textureData, objectData);\n        return data.build;\n      }\n\n      function buildBasematerial(materialData, objects, modelData) {\n        var material;\n        var displaypropertiesid = materialData.displaypropertiesid;\n        var pbmetallicdisplayproperties = modelData.resources.pbmetallicdisplayproperties;\n\n        if (displaypropertiesid !== null && pbmetallicdisplayproperties[displaypropertiesid] !== undefined) {\n          // metallic display property, use StandardMaterial\n          var pbmetallicdisplayproperty = pbmetallicdisplayproperties[displaypropertiesid];\n          var metallicData = pbmetallicdisplayproperty.data[materialData.index];\n          material = new MeshStandardMaterial({\n            flatShading: true,\n            roughness: metallicData.roughness,\n            metalness: metallicData.metallicness\n          });\n        } else {\n          // otherwise use PhongMaterial\n          material = new MeshPhongMaterial({\n            flatShading: true\n          });\n        }\n\n        material.name = materialData.name; // displaycolor MUST be specified with a value of a 6 or 8 digit hexadecimal number, e.g. \"#RRGGBB\" or \"#RRGGBBAA\"\n\n        var displaycolor = materialData.displaycolor;\n        var color = displaycolor.substring(0, 7);\n        material.color.setStyle(color);\n        material.color.convertSRGBToLinear(); // displaycolor is in sRGB\n        // process alpha if set\n\n        if (displaycolor.length === 9) {\n          material.opacity = parseInt(displaycolor.charAt(7) + displaycolor.charAt(8), 16) / 255;\n        }\n\n        return material;\n      }\n\n      function buildComposite(compositeData, objects, modelData, textureData) {\n        var composite = new Group();\n\n        for (var j = 0; j < compositeData.length; j++) {\n          var component = compositeData[j];\n          var _build = objects[component.objectId];\n\n          if (_build === undefined) {\n            buildObject(component.objectId, objects, modelData, textureData);\n            _build = objects[component.objectId];\n          }\n\n          var object3D = _build.clone(); // apply component transform\n\n\n          var transform = component.transform;\n\n          if (transform) {\n            object3D.applyMatrix4(transform);\n          }\n\n          composite.add(object3D);\n        }\n\n        return composite;\n      }\n\n      function buildObject(objectId, objects, modelData, textureData) {\n        var objectData = modelData['resources']['object'][objectId];\n\n        if (objectData['mesh']) {\n          var meshData = objectData['mesh'];\n          var extensions = modelData['extensions'];\n          var modelXml = modelData['xml'];\n          applyExtensions(extensions, meshData, modelXml);\n          objects[objectData.id] = getBuild(meshData, objects, modelData, textureData, objectData, buildGroup);\n        } else {\n          var compositeData = objectData['components'];\n          objects[objectData.id] = getBuild(compositeData, objects, modelData, textureData, objectData, buildComposite);\n        }\n      }\n\n      function buildObjects(data3mf) {\n        var modelsData = data3mf.model;\n        var modelRels = data3mf.modelRels;\n        var objects = {};\n        var modelsKeys = Object.keys(modelsData);\n        var textureData = {}; // evaluate model relationships to textures\n\n        if (modelRels) {\n          for (var i = 0, l = modelRels.length; i < l; i++) {\n            var modelRel = modelRels[i];\n            var textureKey = modelRel.target.substring(1);\n\n            if (data3mf.texture[textureKey]) {\n              textureData[modelRel.target] = data3mf.texture[textureKey];\n            }\n          }\n        } // start build\n\n\n        for (var _i11 = 0; _i11 < modelsKeys.length; _i11++) {\n          var modelsKey = modelsKeys[_i11];\n          var modelData = modelsData[modelsKey];\n          var objectIds = Object.keys(modelData['resources']['object']);\n\n          for (var j = 0; j < objectIds.length; j++) {\n            var objectId = objectIds[j];\n            buildObject(objectId, objects, modelData, textureData);\n          }\n        }\n\n        return objects;\n      }\n\n      function fetch3DModelPart(rels) {\n        for (var i = 0; i < rels.length; i++) {\n          var rel = rels[i];\n          var extension = rel.target.split('.').pop();\n          if (extension.toLowerCase() === 'model') return rel;\n        }\n      }\n\n      function build(objects, data3mf) {\n        var group = new Group();\n        var relationship = fetch3DModelPart(data3mf['rels']);\n        var buildData = data3mf.model[relationship['target'].substring(1)]['build'];\n\n        for (var i = 0; i < buildData.length; i++) {\n          var buildItem = buildData[i];\n          var object3D = objects[buildItem['objectId']]; // apply transform\n\n          var transform = buildItem['transform'];\n\n          if (transform) {\n            object3D.applyMatrix4(transform);\n          }\n\n          group.add(object3D);\n        }\n\n        return group;\n      }\n\n      var data3mf = loadDocument(data);\n      var objects = buildObjects(data3mf);\n      return build(objects, data3mf);\n    }\n  }, {\n    key: \"addExtension\",\n    value: function addExtension(extension) {\n      this.availableExtensions.push(extension);\n    }\n  }]);\n\n  return ThreeMFLoader;\n}(Loader);\n\nexport { ThreeMFLoader };","map":{"version":3,"names":["Loader","FileLoader","TextureLoader","LoaderUtils","Group","Color","Matrix4","BufferGeometry","Float32BufferAttribute","Mesh","MeshPhongMaterial","BufferAttribute","MeshStandardMaterial","sRGBEncoding","RepeatWrapping","ClampToEdgeWrapping","MirroredRepeatWrapping","LinearFilter","LinearMipmapLinearFilter","NearestFilter","unzipSync","ThreeMFLoader","manager","availableExtensions","url","onLoad","onProgress","onError","scope","loader","setPath","path","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","load","buffer","parse","e","console","error","itemError","data","textureLoader","loadDocument","zip","file","relsName","modelRelsName","modelPartNames","texturesPartNames","modelRels","modelParts","printTicketParts","texturesParts","otherParts","Uint8Array","ReferenceError","match","push","relsView","relsFileText","decodeText","rels","parseRelsXml","i","length","modelPart","view","fileText","xmlData","DOMParser","parseFromString","documentElement","nodeName","toLowerCase","modelNode","querySelector","extensions","attributes","attr","name","value","RegExp","$1","modelData","parseModelNode","Object","keys","texturesPartName","model","printTicket","texture","other","relationships","relsXmlData","relsNodes","querySelectorAll","relsNode","relationship","target","getAttribute","id","type","parseMetadataNodes","metadataNodes","metadataData","metadataNode","validNames","indexOf","textContent","parseBasematerialsNode","basematerialsNode","basematerialsData","basematerials","basematerialNodes","basematerialNode","basematerialData","parseBasematerialNode","index","parseTexture2DNode","texture2DNode","texture2dData","contenttype","tilestyleu","tilestylev","filter","parseTextures2DGroupNode","texture2DGroupNode","texture2DGroupData","texid","displaypropertiesid","tex2coordNodes","uvs","tex2coordNode","u","v","parseFloat","Float32Array","parseColorGroupNode","colorGroupNode","colorGroupData","colorNodes","colors","colorObject","colorNode","color","setStyle","substring","convertSRGBToLinear","r","g","b","parseMetallicDisplaypropertiesNode","metallicDisplaypropetiesNode","metallicDisplaypropertiesData","metallicNodes","metallicData","metallicNode","metallicness","roughness","parseMeshNode","meshNode","meshData","vertices","vertexNodes","vertexNode","x","y","z","triangleProperties","triangles","triangleNodes","triangleNode","v1","v2","v3","p1","p2","p3","pid","triangleProperty","parseInt","Uint32Array","parseComponentsNode","componentsNode","components","componentNodes","componentNode","componentData","parseComponentNode","transform","parseTransform","t","split","forEach","s","matrix","set","parseObjectNode","objectNode","objectData","pindex","thumbnail","partnumber","parseResourcesNode","resourcesNode","resourcesData","basematerialsNodes","textures2DNodes","textures2DNode","texture2DData","colorGroupNodes","pbmetallicdisplaypropertiesNodes","pbmetallicdisplaypropertiesNode","pbmetallicdisplaypropertiesData","textures2DGroupNodes","textures2DGroupNode","textures2DGroupData","objectNodes","parseBuildNode","buildNode","buildData","itemNodes","itemNode","buildItem","objectId","unit","buildTexture","texture2dgroup","objects","textureData","texture2ds","resources","texture2d","blob","Blob","sourceURI","URL","createObjectURL","revokeObjectURL","encoding","wrapS","wrapT","magFilter","minFilter","buildBasematerialsMeshes","objectPindex","materialMap","l","undefined","meshes","materialIndex","trianglePropertiesProps","material","getBuild","buildBasematerial","geometry","positionData","j","jl","setAttribute","mesh","buildTexturedMesh","uvData","map","flatShading","buildVertexColorMesh","colorgroup","colorData","vertexColors","buildDefaultMesh","setIndex","buildMeshes","resourceMap","il","resourceId","resourceType","getResourceType","newMeshes","analyzeObject","objectPid","buildGroup","group","add","applyExtensions","modelXml","ns","extension","apply","builder","build","materialData","pbmetallicdisplayproperties","pbmetallicdisplayproperty","metalness","displaycolor","opacity","charAt","buildComposite","compositeData","composite","component","buildObject","object3D","clone","applyMatrix4","buildObjects","data3mf","modelsData","modelsKeys","modelRel","textureKey","modelsKey","objectIds","fetch3DModelPart","rel","pop"],"sources":["D:/Github/NIKE-DJANGO/Jord/l4fycy/node_modules/three-stdlib/loaders/3MFLoader.js"],"sourcesContent":["import { Loader, FileLoader, TextureLoader, LoaderUtils, Group, Color, Matrix4, BufferGeometry, Float32BufferAttribute, Mesh, MeshPhongMaterial, BufferAttribute, MeshStandardMaterial, sRGBEncoding, RepeatWrapping, ClampToEdgeWrapping, MirroredRepeatWrapping, LinearFilter, LinearMipmapLinearFilter, NearestFilter } from 'three';\r\nimport { unzipSync } from 'fflate';\r\n\r\n/**\r\n *\r\n * 3D Manufacturing Format (3MF) specification: https://3mf.io/specification/\r\n *\r\n * The following features from the core specification are supported:\r\n *\r\n * - 3D Models\r\n * - Object Resources (Meshes and Components)\r\n * - Material Resources (Base Materials)\r\n *\r\n * 3MF Materials and Properties Extension are only partially supported.\r\n *\r\n * - Texture 2D\r\n * - Texture 2D Groups\r\n * - Color Groups (Vertex Colors)\r\n * - Metallic Display Properties (PBR)\r\n */\r\n\r\nclass ThreeMFLoader extends Loader {\r\n  constructor(manager) {\r\n    super(manager);\r\n    this.availableExtensions = [];\r\n  }\r\n\r\n  load(url, onLoad, onProgress, onError) {\r\n    const scope = this;\r\n    const loader = new FileLoader(scope.manager);\r\n    loader.setPath(scope.path);\r\n    loader.setResponseType('arraybuffer');\r\n    loader.setRequestHeader(scope.requestHeader);\r\n    loader.setWithCredentials(scope.withCredentials);\r\n    loader.load(url, function (buffer) {\r\n      try {\r\n        onLoad(scope.parse(buffer));\r\n      } catch (e) {\r\n        if (onError) {\r\n          onError(e);\r\n        } else {\r\n          console.error(e);\r\n        }\r\n\r\n        scope.manager.itemError(url);\r\n      }\r\n    }, onProgress, onError);\r\n  }\r\n\r\n  parse(data) {\r\n    const scope = this;\r\n    const textureLoader = new TextureLoader(this.manager);\r\n\r\n    function loadDocument(data) {\r\n      let zip = null;\r\n      let file = null;\r\n      let relsName;\r\n      let modelRelsName;\r\n      const modelPartNames = [];\r\n      const texturesPartNames = [];\r\n      let modelRels;\r\n      const modelParts = {};\r\n      const printTicketParts = {};\r\n      const texturesParts = {};\r\n      const otherParts = {};\r\n\r\n      try {\r\n        zip = unzipSync(new Uint8Array(data)); // eslint-disable-line no-undef\r\n      } catch (e) {\r\n        if (e instanceof ReferenceError) {\r\n          console.error('THREE.3MFLoader: fflate missing and file is compressed.');\r\n          return null;\r\n        }\r\n      }\r\n\r\n      for (file in zip) {\r\n        if (file.match(/\\_rels\\/.rels$/)) {\r\n          relsName = file;\r\n        } else if (file.match(/3D\\/_rels\\/.*\\.model\\.rels$/)) {\r\n          modelRelsName = file;\r\n        } else if (file.match(/^3D\\/.*\\.model$/)) {\r\n          modelPartNames.push(file);\r\n        } else if (file.match(/^3D\\/Metadata\\/.*\\.xml$/)) ; else if (file.match(/^3D\\/Textures?\\/.*/)) {\r\n          texturesPartNames.push(file);\r\n        } else if (file.match(/^3D\\/Other\\/.*/)) ;\r\n      } //\r\n\r\n\r\n      const relsView = zip[relsName];\r\n      const relsFileText = LoaderUtils.decodeText(relsView);\r\n      const rels = parseRelsXml(relsFileText); //\r\n\r\n      if (modelRelsName) {\r\n        const relsView = zip[modelRelsName];\r\n        const relsFileText = LoaderUtils.decodeText(relsView);\r\n        modelRels = parseRelsXml(relsFileText);\r\n      } //\r\n\r\n\r\n      for (let i = 0; i < modelPartNames.length; i++) {\r\n        const modelPart = modelPartNames[i];\r\n        const view = zip[modelPart];\r\n        const fileText = LoaderUtils.decodeText(view);\r\n        const xmlData = new DOMParser().parseFromString(fileText, 'application/xml');\r\n\r\n        if (xmlData.documentElement.nodeName.toLowerCase() !== 'model') {\r\n          console.error('THREE.3MFLoader: Error loading 3MF - no 3MF document found: ', modelPart);\r\n        }\r\n\r\n        const modelNode = xmlData.querySelector('model');\r\n        const extensions = {};\r\n\r\n        for (let i = 0; i < modelNode.attributes.length; i++) {\r\n          const attr = modelNode.attributes[i];\r\n\r\n          if (attr.name.match(/^xmlns:(.+)$/)) {\r\n            extensions[attr.value] = RegExp.$1;\r\n          }\r\n        }\r\n\r\n        const modelData = parseModelNode(modelNode);\r\n        modelData['xml'] = modelNode;\r\n\r\n        if (0 < Object.keys(extensions).length) {\r\n          modelData['extensions'] = extensions;\r\n        }\r\n\r\n        modelParts[modelPart] = modelData;\r\n      } //\r\n\r\n\r\n      for (let i = 0; i < texturesPartNames.length; i++) {\r\n        const texturesPartName = texturesPartNames[i];\r\n        texturesParts[texturesPartName] = zip[texturesPartName].buffer;\r\n      }\r\n\r\n      return {\r\n        rels: rels,\r\n        modelRels: modelRels,\r\n        model: modelParts,\r\n        printTicket: printTicketParts,\r\n        texture: texturesParts,\r\n        other: otherParts\r\n      };\r\n    }\r\n\r\n    function parseRelsXml(relsFileText) {\r\n      const relationships = [];\r\n      const relsXmlData = new DOMParser().parseFromString(relsFileText, 'application/xml');\r\n      const relsNodes = relsXmlData.querySelectorAll('Relationship');\r\n\r\n      for (let i = 0; i < relsNodes.length; i++) {\r\n        const relsNode = relsNodes[i];\r\n        const relationship = {\r\n          target: relsNode.getAttribute('Target'),\r\n          //required\r\n          id: relsNode.getAttribute('Id'),\r\n          //required\r\n          type: relsNode.getAttribute('Type') //required\r\n\r\n        };\r\n        relationships.push(relationship);\r\n      }\r\n\r\n      return relationships;\r\n    }\r\n\r\n    function parseMetadataNodes(metadataNodes) {\r\n      const metadataData = {};\r\n\r\n      for (let i = 0; i < metadataNodes.length; i++) {\r\n        const metadataNode = metadataNodes[i];\r\n        const name = metadataNode.getAttribute('name');\r\n        const validNames = ['Title', 'Designer', 'Description', 'Copyright', 'LicenseTerms', 'Rating', 'CreationDate', 'ModificationDate'];\r\n\r\n        if (0 <= validNames.indexOf(name)) {\r\n          metadataData[name] = metadataNode.textContent;\r\n        }\r\n      }\r\n\r\n      return metadataData;\r\n    }\r\n\r\n    function parseBasematerialsNode(basematerialsNode) {\r\n      const basematerialsData = {\r\n        id: basematerialsNode.getAttribute('id'),\r\n        // required\r\n        basematerials: []\r\n      };\r\n      const basematerialNodes = basematerialsNode.querySelectorAll('base');\r\n\r\n      for (let i = 0; i < basematerialNodes.length; i++) {\r\n        const basematerialNode = basematerialNodes[i];\r\n        const basematerialData = parseBasematerialNode(basematerialNode);\r\n        basematerialData.index = i; // the order and count of the material nodes form an implicit 0-based index\r\n\r\n        basematerialsData.basematerials.push(basematerialData);\r\n      }\r\n\r\n      return basematerialsData;\r\n    }\r\n\r\n    function parseTexture2DNode(texture2DNode) {\r\n      const texture2dData = {\r\n        id: texture2DNode.getAttribute('id'),\r\n        // required\r\n        path: texture2DNode.getAttribute('path'),\r\n        // required\r\n        contenttype: texture2DNode.getAttribute('contenttype'),\r\n        // required\r\n        tilestyleu: texture2DNode.getAttribute('tilestyleu'),\r\n        tilestylev: texture2DNode.getAttribute('tilestylev'),\r\n        filter: texture2DNode.getAttribute('filter')\r\n      };\r\n      return texture2dData;\r\n    }\r\n\r\n    function parseTextures2DGroupNode(texture2DGroupNode) {\r\n      const texture2DGroupData = {\r\n        id: texture2DGroupNode.getAttribute('id'),\r\n        // required\r\n        texid: texture2DGroupNode.getAttribute('texid'),\r\n        // required\r\n        displaypropertiesid: texture2DGroupNode.getAttribute('displaypropertiesid')\r\n      };\r\n      const tex2coordNodes = texture2DGroupNode.querySelectorAll('tex2coord');\r\n      const uvs = [];\r\n\r\n      for (let i = 0; i < tex2coordNodes.length; i++) {\r\n        const tex2coordNode = tex2coordNodes[i];\r\n        const u = tex2coordNode.getAttribute('u');\r\n        const v = tex2coordNode.getAttribute('v');\r\n        uvs.push(parseFloat(u), parseFloat(v));\r\n      }\r\n\r\n      texture2DGroupData['uvs'] = new Float32Array(uvs);\r\n      return texture2DGroupData;\r\n    }\r\n\r\n    function parseColorGroupNode(colorGroupNode) {\r\n      const colorGroupData = {\r\n        id: colorGroupNode.getAttribute('id'),\r\n        // required\r\n        displaypropertiesid: colorGroupNode.getAttribute('displaypropertiesid')\r\n      };\r\n      const colorNodes = colorGroupNode.querySelectorAll('color');\r\n      const colors = [];\r\n      const colorObject = new Color();\r\n\r\n      for (let i = 0; i < colorNodes.length; i++) {\r\n        const colorNode = colorNodes[i];\r\n        const color = colorNode.getAttribute('color');\r\n        colorObject.setStyle(color.substring(0, 7));\r\n        colorObject.convertSRGBToLinear(); // color is in sRGB\r\n\r\n        colors.push(colorObject.r, colorObject.g, colorObject.b);\r\n      }\r\n\r\n      colorGroupData['colors'] = new Float32Array(colors);\r\n      return colorGroupData;\r\n    }\r\n\r\n    function parseMetallicDisplaypropertiesNode(metallicDisplaypropetiesNode) {\r\n      const metallicDisplaypropertiesData = {\r\n        id: metallicDisplaypropetiesNode.getAttribute('id') // required\r\n\r\n      };\r\n      const metallicNodes = metallicDisplaypropetiesNode.querySelectorAll('pbmetallic');\r\n      const metallicData = [];\r\n\r\n      for (let i = 0; i < metallicNodes.length; i++) {\r\n        const metallicNode = metallicNodes[i];\r\n        metallicData.push({\r\n          name: metallicNode.getAttribute('name'),\r\n          // required\r\n          metallicness: parseFloat(metallicNode.getAttribute('metallicness')),\r\n          // required\r\n          roughness: parseFloat(metallicNode.getAttribute('roughness')) // required\r\n\r\n        });\r\n      }\r\n\r\n      metallicDisplaypropertiesData.data = metallicData;\r\n      return metallicDisplaypropertiesData;\r\n    }\r\n\r\n    function parseBasematerialNode(basematerialNode) {\r\n      const basematerialData = {};\r\n      basematerialData['name'] = basematerialNode.getAttribute('name'); // required\r\n\r\n      basematerialData['displaycolor'] = basematerialNode.getAttribute('displaycolor'); // required\r\n\r\n      basematerialData['displaypropertiesid'] = basematerialNode.getAttribute('displaypropertiesid');\r\n      return basematerialData;\r\n    }\r\n\r\n    function parseMeshNode(meshNode) {\r\n      const meshData = {};\r\n      const vertices = [];\r\n      const vertexNodes = meshNode.querySelectorAll('vertices vertex');\r\n\r\n      for (let i = 0; i < vertexNodes.length; i++) {\r\n        const vertexNode = vertexNodes[i];\r\n        const x = vertexNode.getAttribute('x');\r\n        const y = vertexNode.getAttribute('y');\r\n        const z = vertexNode.getAttribute('z');\r\n        vertices.push(parseFloat(x), parseFloat(y), parseFloat(z));\r\n      }\r\n\r\n      meshData['vertices'] = new Float32Array(vertices);\r\n      const triangleProperties = [];\r\n      const triangles = [];\r\n      const triangleNodes = meshNode.querySelectorAll('triangles triangle');\r\n\r\n      for (let i = 0; i < triangleNodes.length; i++) {\r\n        const triangleNode = triangleNodes[i];\r\n        const v1 = triangleNode.getAttribute('v1');\r\n        const v2 = triangleNode.getAttribute('v2');\r\n        const v3 = triangleNode.getAttribute('v3');\r\n        const p1 = triangleNode.getAttribute('p1');\r\n        const p2 = triangleNode.getAttribute('p2');\r\n        const p3 = triangleNode.getAttribute('p3');\r\n        const pid = triangleNode.getAttribute('pid');\r\n        const triangleProperty = {};\r\n        triangleProperty['v1'] = parseInt(v1, 10);\r\n        triangleProperty['v2'] = parseInt(v2, 10);\r\n        triangleProperty['v3'] = parseInt(v3, 10);\r\n        triangles.push(triangleProperty['v1'], triangleProperty['v2'], triangleProperty['v3']); // optional\r\n\r\n        if (p1) {\r\n          triangleProperty['p1'] = parseInt(p1, 10);\r\n        }\r\n\r\n        if (p2) {\r\n          triangleProperty['p2'] = parseInt(p2, 10);\r\n        }\r\n\r\n        if (p3) {\r\n          triangleProperty['p3'] = parseInt(p3, 10);\r\n        }\r\n\r\n        if (pid) {\r\n          triangleProperty['pid'] = pid;\r\n        }\r\n\r\n        if (0 < Object.keys(triangleProperty).length) {\r\n          triangleProperties.push(triangleProperty);\r\n        }\r\n      }\r\n\r\n      meshData['triangleProperties'] = triangleProperties;\r\n      meshData['triangles'] = new Uint32Array(triangles);\r\n      return meshData;\r\n    }\r\n\r\n    function parseComponentsNode(componentsNode) {\r\n      const components = [];\r\n      const componentNodes = componentsNode.querySelectorAll('component');\r\n\r\n      for (let i = 0; i < componentNodes.length; i++) {\r\n        const componentNode = componentNodes[i];\r\n        const componentData = parseComponentNode(componentNode);\r\n        components.push(componentData);\r\n      }\r\n\r\n      return components;\r\n    }\r\n\r\n    function parseComponentNode(componentNode) {\r\n      const componentData = {};\r\n      componentData['objectId'] = componentNode.getAttribute('objectid'); // required\r\n\r\n      const transform = componentNode.getAttribute('transform');\r\n\r\n      if (transform) {\r\n        componentData['transform'] = parseTransform(transform);\r\n      }\r\n\r\n      return componentData;\r\n    }\r\n\r\n    function parseTransform(transform) {\r\n      const t = [];\r\n      transform.split(' ').forEach(function (s) {\r\n        t.push(parseFloat(s));\r\n      });\r\n      const matrix = new Matrix4();\r\n      matrix.set(t[0], t[3], t[6], t[9], t[1], t[4], t[7], t[10], t[2], t[5], t[8], t[11], 0.0, 0.0, 0.0, 1.0);\r\n      return matrix;\r\n    }\r\n\r\n    function parseObjectNode(objectNode) {\r\n      const objectData = {\r\n        type: objectNode.getAttribute('type')\r\n      };\r\n      const id = objectNode.getAttribute('id');\r\n\r\n      if (id) {\r\n        objectData['id'] = id;\r\n      }\r\n\r\n      const pid = objectNode.getAttribute('pid');\r\n\r\n      if (pid) {\r\n        objectData['pid'] = pid;\r\n      }\r\n\r\n      const pindex = objectNode.getAttribute('pindex');\r\n\r\n      if (pindex) {\r\n        objectData['pindex'] = pindex;\r\n      }\r\n\r\n      const thumbnail = objectNode.getAttribute('thumbnail');\r\n\r\n      if (thumbnail) {\r\n        objectData['thumbnail'] = thumbnail;\r\n      }\r\n\r\n      const partnumber = objectNode.getAttribute('partnumber');\r\n\r\n      if (partnumber) {\r\n        objectData['partnumber'] = partnumber;\r\n      }\r\n\r\n      const name = objectNode.getAttribute('name');\r\n\r\n      if (name) {\r\n        objectData['name'] = name;\r\n      }\r\n\r\n      const meshNode = objectNode.querySelector('mesh');\r\n\r\n      if (meshNode) {\r\n        objectData['mesh'] = parseMeshNode(meshNode);\r\n      }\r\n\r\n      const componentsNode = objectNode.querySelector('components');\r\n\r\n      if (componentsNode) {\r\n        objectData['components'] = parseComponentsNode(componentsNode);\r\n      }\r\n\r\n      return objectData;\r\n    }\r\n\r\n    function parseResourcesNode(resourcesNode) {\r\n      const resourcesData = {};\r\n      resourcesData['basematerials'] = {};\r\n      const basematerialsNodes = resourcesNode.querySelectorAll('basematerials');\r\n\r\n      for (let i = 0; i < basematerialsNodes.length; i++) {\r\n        const basematerialsNode = basematerialsNodes[i];\r\n        const basematerialsData = parseBasematerialsNode(basematerialsNode);\r\n        resourcesData['basematerials'][basematerialsData['id']] = basematerialsData;\r\n      } //\r\n\r\n\r\n      resourcesData['texture2d'] = {};\r\n      const textures2DNodes = resourcesNode.querySelectorAll('texture2d');\r\n\r\n      for (let i = 0; i < textures2DNodes.length; i++) {\r\n        const textures2DNode = textures2DNodes[i];\r\n        const texture2DData = parseTexture2DNode(textures2DNode);\r\n        resourcesData['texture2d'][texture2DData['id']] = texture2DData;\r\n      } //\r\n\r\n\r\n      resourcesData['colorgroup'] = {};\r\n      const colorGroupNodes = resourcesNode.querySelectorAll('colorgroup');\r\n\r\n      for (let i = 0; i < colorGroupNodes.length; i++) {\r\n        const colorGroupNode = colorGroupNodes[i];\r\n        const colorGroupData = parseColorGroupNode(colorGroupNode);\r\n        resourcesData['colorgroup'][colorGroupData['id']] = colorGroupData;\r\n      } //\r\n\r\n\r\n      resourcesData['pbmetallicdisplayproperties'] = {};\r\n      const pbmetallicdisplaypropertiesNodes = resourcesNode.querySelectorAll('pbmetallicdisplayproperties');\r\n\r\n      for (let i = 0; i < pbmetallicdisplaypropertiesNodes.length; i++) {\r\n        const pbmetallicdisplaypropertiesNode = pbmetallicdisplaypropertiesNodes[i];\r\n        const pbmetallicdisplaypropertiesData = parseMetallicDisplaypropertiesNode(pbmetallicdisplaypropertiesNode);\r\n        resourcesData['pbmetallicdisplayproperties'][pbmetallicdisplaypropertiesData['id']] = pbmetallicdisplaypropertiesData;\r\n      } //\r\n\r\n\r\n      resourcesData['texture2dgroup'] = {};\r\n      const textures2DGroupNodes = resourcesNode.querySelectorAll('texture2dgroup');\r\n\r\n      for (let i = 0; i < textures2DGroupNodes.length; i++) {\r\n        const textures2DGroupNode = textures2DGroupNodes[i];\r\n        const textures2DGroupData = parseTextures2DGroupNode(textures2DGroupNode);\r\n        resourcesData['texture2dgroup'][textures2DGroupData['id']] = textures2DGroupData;\r\n      } //\r\n\r\n\r\n      resourcesData['object'] = {};\r\n      const objectNodes = resourcesNode.querySelectorAll('object');\r\n\r\n      for (let i = 0; i < objectNodes.length; i++) {\r\n        const objectNode = objectNodes[i];\r\n        const objectData = parseObjectNode(objectNode);\r\n        resourcesData['object'][objectData['id']] = objectData;\r\n      }\r\n\r\n      return resourcesData;\r\n    }\r\n\r\n    function parseBuildNode(buildNode) {\r\n      const buildData = [];\r\n      const itemNodes = buildNode.querySelectorAll('item');\r\n\r\n      for (let i = 0; i < itemNodes.length; i++) {\r\n        const itemNode = itemNodes[i];\r\n        const buildItem = {\r\n          objectId: itemNode.getAttribute('objectid')\r\n        };\r\n        const transform = itemNode.getAttribute('transform');\r\n\r\n        if (transform) {\r\n          buildItem['transform'] = parseTransform(transform);\r\n        }\r\n\r\n        buildData.push(buildItem);\r\n      }\r\n\r\n      return buildData;\r\n    }\r\n\r\n    function parseModelNode(modelNode) {\r\n      const modelData = {\r\n        unit: modelNode.getAttribute('unit') || 'millimeter'\r\n      };\r\n      const metadataNodes = modelNode.querySelectorAll('metadata');\r\n\r\n      if (metadataNodes) {\r\n        modelData['metadata'] = parseMetadataNodes(metadataNodes);\r\n      }\r\n\r\n      const resourcesNode = modelNode.querySelector('resources');\r\n\r\n      if (resourcesNode) {\r\n        modelData['resources'] = parseResourcesNode(resourcesNode);\r\n      }\r\n\r\n      const buildNode = modelNode.querySelector('build');\r\n\r\n      if (buildNode) {\r\n        modelData['build'] = parseBuildNode(buildNode);\r\n      }\r\n\r\n      return modelData;\r\n    }\r\n\r\n    function buildTexture(texture2dgroup, objects, modelData, textureData) {\r\n      const texid = texture2dgroup.texid;\r\n      const texture2ds = modelData.resources.texture2d;\r\n      const texture2d = texture2ds[texid];\r\n\r\n      if (texture2d) {\r\n        const data = textureData[texture2d.path];\r\n        const type = texture2d.contenttype;\r\n        const blob = new Blob([data], {\r\n          type: type\r\n        });\r\n        const sourceURI = URL.createObjectURL(blob);\r\n        const texture = textureLoader.load(sourceURI, function () {\r\n          URL.revokeObjectURL(sourceURI);\r\n        });\r\n        texture.encoding = sRGBEncoding; // texture parameters\r\n\r\n        switch (texture2d.tilestyleu) {\r\n          case 'wrap':\r\n            texture.wrapS = RepeatWrapping;\r\n            break;\r\n\r\n          case 'mirror':\r\n            texture.wrapS = MirroredRepeatWrapping;\r\n            break;\r\n\r\n          case 'none':\r\n          case 'clamp':\r\n            texture.wrapS = ClampToEdgeWrapping;\r\n            break;\r\n\r\n          default:\r\n            texture.wrapS = RepeatWrapping;\r\n        }\r\n\r\n        switch (texture2d.tilestylev) {\r\n          case 'wrap':\r\n            texture.wrapT = RepeatWrapping;\r\n            break;\r\n\r\n          case 'mirror':\r\n            texture.wrapT = MirroredRepeatWrapping;\r\n            break;\r\n\r\n          case 'none':\r\n          case 'clamp':\r\n            texture.wrapT = ClampToEdgeWrapping;\r\n            break;\r\n\r\n          default:\r\n            texture.wrapT = RepeatWrapping;\r\n        }\r\n\r\n        switch (texture2d.filter) {\r\n          case 'auto':\r\n            texture.magFilter = LinearFilter;\r\n            texture.minFilter = LinearMipmapLinearFilter;\r\n            break;\r\n\r\n          case 'linear':\r\n            texture.magFilter = LinearFilter;\r\n            texture.minFilter = LinearFilter;\r\n            break;\r\n\r\n          case 'nearest':\r\n            texture.magFilter = NearestFilter;\r\n            texture.minFilter = NearestFilter;\r\n            break;\r\n\r\n          default:\r\n            texture.magFilter = LinearFilter;\r\n            texture.minFilter = LinearMipmapLinearFilter;\r\n        }\r\n\r\n        return texture;\r\n      } else {\r\n        return null;\r\n      }\r\n    }\r\n\r\n    function buildBasematerialsMeshes(basematerials, triangleProperties, meshData, objects, modelData, textureData, objectData) {\r\n      const objectPindex = objectData.pindex;\r\n      const materialMap = {};\r\n\r\n      for (let i = 0, l = triangleProperties.length; i < l; i++) {\r\n        const triangleProperty = triangleProperties[i];\r\n        const pindex = triangleProperty.p1 !== undefined ? triangleProperty.p1 : objectPindex;\r\n        if (materialMap[pindex] === undefined) materialMap[pindex] = [];\r\n        materialMap[pindex].push(triangleProperty);\r\n      } //\r\n\r\n\r\n      const keys = Object.keys(materialMap);\r\n      const meshes = [];\r\n\r\n      for (let i = 0, l = keys.length; i < l; i++) {\r\n        const materialIndex = keys[i];\r\n        const trianglePropertiesProps = materialMap[materialIndex];\r\n        const basematerialData = basematerials.basematerials[materialIndex];\r\n        const material = getBuild(basematerialData, objects, modelData, textureData, objectData, buildBasematerial); //\r\n\r\n        const geometry = new BufferGeometry();\r\n        const positionData = [];\r\n        const vertices = meshData.vertices;\r\n\r\n        for (let j = 0, jl = trianglePropertiesProps.length; j < jl; j++) {\r\n          const triangleProperty = trianglePropertiesProps[j];\r\n          positionData.push(vertices[triangleProperty.v1 * 3 + 0]);\r\n          positionData.push(vertices[triangleProperty.v1 * 3 + 1]);\r\n          positionData.push(vertices[triangleProperty.v1 * 3 + 2]);\r\n          positionData.push(vertices[triangleProperty.v2 * 3 + 0]);\r\n          positionData.push(vertices[triangleProperty.v2 * 3 + 1]);\r\n          positionData.push(vertices[triangleProperty.v2 * 3 + 2]);\r\n          positionData.push(vertices[triangleProperty.v3 * 3 + 0]);\r\n          positionData.push(vertices[triangleProperty.v3 * 3 + 1]);\r\n          positionData.push(vertices[triangleProperty.v3 * 3 + 2]);\r\n        }\r\n\r\n        geometry.setAttribute('position', new Float32BufferAttribute(positionData, 3)); //\r\n\r\n        const mesh = new Mesh(geometry, material);\r\n        meshes.push(mesh);\r\n      }\r\n\r\n      return meshes;\r\n    }\r\n\r\n    function buildTexturedMesh(texture2dgroup, triangleProperties, meshData, objects, modelData, textureData, objectData) {\r\n      // geometry\r\n      const geometry = new BufferGeometry();\r\n      const positionData = [];\r\n      const uvData = [];\r\n      const vertices = meshData.vertices;\r\n      const uvs = texture2dgroup.uvs;\r\n\r\n      for (let i = 0, l = triangleProperties.length; i < l; i++) {\r\n        const triangleProperty = triangleProperties[i];\r\n        positionData.push(vertices[triangleProperty.v1 * 3 + 0]);\r\n        positionData.push(vertices[triangleProperty.v1 * 3 + 1]);\r\n        positionData.push(vertices[triangleProperty.v1 * 3 + 2]);\r\n        positionData.push(vertices[triangleProperty.v2 * 3 + 0]);\r\n        positionData.push(vertices[triangleProperty.v2 * 3 + 1]);\r\n        positionData.push(vertices[triangleProperty.v2 * 3 + 2]);\r\n        positionData.push(vertices[triangleProperty.v3 * 3 + 0]);\r\n        positionData.push(vertices[triangleProperty.v3 * 3 + 1]);\r\n        positionData.push(vertices[triangleProperty.v3 * 3 + 2]); //\r\n\r\n        uvData.push(uvs[triangleProperty.p1 * 2 + 0]);\r\n        uvData.push(uvs[triangleProperty.p1 * 2 + 1]);\r\n        uvData.push(uvs[triangleProperty.p2 * 2 + 0]);\r\n        uvData.push(uvs[triangleProperty.p2 * 2 + 1]);\r\n        uvData.push(uvs[triangleProperty.p3 * 2 + 0]);\r\n        uvData.push(uvs[triangleProperty.p3 * 2 + 1]);\r\n      }\r\n\r\n      geometry.setAttribute('position', new Float32BufferAttribute(positionData, 3));\r\n      geometry.setAttribute('uv', new Float32BufferAttribute(uvData, 2)); // material\r\n\r\n      const texture = getBuild(texture2dgroup, objects, modelData, textureData, objectData, buildTexture);\r\n      const material = new MeshPhongMaterial({\r\n        map: texture,\r\n        flatShading: true\r\n      }); // mesh\r\n\r\n      const mesh = new Mesh(geometry, material);\r\n      return mesh;\r\n    }\r\n\r\n    function buildVertexColorMesh(colorgroup, triangleProperties, meshData, objects, modelData, objectData) {\r\n      // geometry\r\n      const geometry = new BufferGeometry();\r\n      const positionData = [];\r\n      const colorData = [];\r\n      const vertices = meshData.vertices;\r\n      const colors = colorgroup.colors;\r\n\r\n      for (let i = 0, l = triangleProperties.length; i < l; i++) {\r\n        const triangleProperty = triangleProperties[i];\r\n        const v1 = triangleProperty.v1;\r\n        const v2 = triangleProperty.v2;\r\n        const v3 = triangleProperty.v3;\r\n        positionData.push(vertices[v1 * 3 + 0]);\r\n        positionData.push(vertices[v1 * 3 + 1]);\r\n        positionData.push(vertices[v1 * 3 + 2]);\r\n        positionData.push(vertices[v2 * 3 + 0]);\r\n        positionData.push(vertices[v2 * 3 + 1]);\r\n        positionData.push(vertices[v2 * 3 + 2]);\r\n        positionData.push(vertices[v3 * 3 + 0]);\r\n        positionData.push(vertices[v3 * 3 + 1]);\r\n        positionData.push(vertices[v3 * 3 + 2]); //\r\n\r\n        const p1 = triangleProperty.p1 !== undefined ? triangleProperty.p1 : objectData.pindex;\r\n        const p2 = triangleProperty.p2 !== undefined ? triangleProperty.p2 : p1;\r\n        const p3 = triangleProperty.p3 !== undefined ? triangleProperty.p3 : p1;\r\n        colorData.push(colors[p1 * 3 + 0]);\r\n        colorData.push(colors[p1 * 3 + 1]);\r\n        colorData.push(colors[p1 * 3 + 2]);\r\n        colorData.push(colors[p2 * 3 + 0]);\r\n        colorData.push(colors[p2 * 3 + 1]);\r\n        colorData.push(colors[p2 * 3 + 2]);\r\n        colorData.push(colors[p3 * 3 + 0]);\r\n        colorData.push(colors[p3 * 3 + 1]);\r\n        colorData.push(colors[p3 * 3 + 2]);\r\n      }\r\n\r\n      geometry.setAttribute('position', new Float32BufferAttribute(positionData, 3));\r\n      geometry.setAttribute('color', new Float32BufferAttribute(colorData, 3)); // material\r\n\r\n      const material = new MeshPhongMaterial({\r\n        vertexColors: true,\r\n        flatShading: true\r\n      }); // mesh\r\n\r\n      const mesh = new Mesh(geometry, material);\r\n      return mesh;\r\n    }\r\n\r\n    function buildDefaultMesh(meshData) {\r\n      const geometry = new BufferGeometry();\r\n      geometry.setIndex(new BufferAttribute(meshData['triangles'], 1));\r\n      geometry.setAttribute('position', new BufferAttribute(meshData['vertices'], 3));\r\n      const material = new MeshPhongMaterial({\r\n        color: 0xaaaaff,\r\n        flatShading: true\r\n      });\r\n      const mesh = new Mesh(geometry, material);\r\n      return mesh;\r\n    }\r\n\r\n    function buildMeshes(resourceMap, meshData, objects, modelData, textureData, objectData) {\r\n      const keys = Object.keys(resourceMap);\r\n      const meshes = [];\r\n\r\n      for (let i = 0, il = keys.length; i < il; i++) {\r\n        const resourceId = keys[i];\r\n        const triangleProperties = resourceMap[resourceId];\r\n        const resourceType = getResourceType(resourceId, modelData);\r\n\r\n        switch (resourceType) {\r\n          case 'material':\r\n            const basematerials = modelData.resources.basematerials[resourceId];\r\n            const newMeshes = buildBasematerialsMeshes(basematerials, triangleProperties, meshData, objects, modelData, textureData, objectData);\r\n\r\n            for (let j = 0, jl = newMeshes.length; j < jl; j++) {\r\n              meshes.push(newMeshes[j]);\r\n            }\r\n\r\n            break;\r\n\r\n          case 'texture':\r\n            const texture2dgroup = modelData.resources.texture2dgroup[resourceId];\r\n            meshes.push(buildTexturedMesh(texture2dgroup, triangleProperties, meshData, objects, modelData, textureData, objectData));\r\n            break;\r\n\r\n          case 'vertexColors':\r\n            const colorgroup = modelData.resources.colorgroup[resourceId];\r\n            meshes.push(buildVertexColorMesh(colorgroup, triangleProperties, meshData, objects, modelData, objectData));\r\n            break;\r\n\r\n          case 'default':\r\n            meshes.push(buildDefaultMesh(meshData));\r\n            break;\r\n\r\n          default:\r\n            console.error('THREE.3MFLoader: Unsupported resource type.');\r\n        }\r\n      }\r\n\r\n      return meshes;\r\n    }\r\n\r\n    function getResourceType(pid, modelData) {\r\n      if (modelData.resources.texture2dgroup[pid] !== undefined) {\r\n        return 'texture';\r\n      } else if (modelData.resources.basematerials[pid] !== undefined) {\r\n        return 'material';\r\n      } else if (modelData.resources.colorgroup[pid] !== undefined) {\r\n        return 'vertexColors';\r\n      } else if (pid === 'default') {\r\n        return 'default';\r\n      } else {\r\n        return undefined;\r\n      }\r\n    }\r\n\r\n    function analyzeObject(modelData, meshData, objectData) {\r\n      const resourceMap = {};\r\n      const triangleProperties = meshData['triangleProperties'];\r\n      const objectPid = objectData.pid;\r\n\r\n      for (let i = 0, l = triangleProperties.length; i < l; i++) {\r\n        const triangleProperty = triangleProperties[i];\r\n        let pid = triangleProperty.pid !== undefined ? triangleProperty.pid : objectPid;\r\n        if (pid === undefined) pid = 'default';\r\n        if (resourceMap[pid] === undefined) resourceMap[pid] = [];\r\n        resourceMap[pid].push(triangleProperty);\r\n      }\r\n\r\n      return resourceMap;\r\n    }\r\n\r\n    function buildGroup(meshData, objects, modelData, textureData, objectData) {\r\n      const group = new Group();\r\n      const resourceMap = analyzeObject(modelData, meshData, objectData);\r\n      const meshes = buildMeshes(resourceMap, meshData, objects, modelData, textureData, objectData);\r\n\r\n      for (let i = 0, l = meshes.length; i < l; i++) {\r\n        group.add(meshes[i]);\r\n      }\r\n\r\n      return group;\r\n    }\r\n\r\n    function applyExtensions(extensions, meshData, modelXml) {\r\n      if (!extensions) {\r\n        return;\r\n      }\r\n\r\n      const availableExtensions = [];\r\n      const keys = Object.keys(extensions);\r\n\r\n      for (let i = 0; i < keys.length; i++) {\r\n        const ns = keys[i];\r\n\r\n        for (let j = 0; j < scope.availableExtensions.length; j++) {\r\n          const extension = scope.availableExtensions[j];\r\n\r\n          if (extension.ns === ns) {\r\n            availableExtensions.push(extension);\r\n          }\r\n        }\r\n      }\r\n\r\n      for (let i = 0; i < availableExtensions.length; i++) {\r\n        const extension = availableExtensions[i];\r\n        extension.apply(modelXml, extensions[extension['ns']], meshData);\r\n      }\r\n    }\r\n\r\n    function getBuild(data, objects, modelData, textureData, objectData, builder) {\r\n      if (data.build !== undefined) return data.build;\r\n      data.build = builder(data, objects, modelData, textureData, objectData);\r\n      return data.build;\r\n    }\r\n\r\n    function buildBasematerial(materialData, objects, modelData) {\r\n      let material;\r\n      const displaypropertiesid = materialData.displaypropertiesid;\r\n      const pbmetallicdisplayproperties = modelData.resources.pbmetallicdisplayproperties;\r\n\r\n      if (displaypropertiesid !== null && pbmetallicdisplayproperties[displaypropertiesid] !== undefined) {\r\n        // metallic display property, use StandardMaterial\r\n        const pbmetallicdisplayproperty = pbmetallicdisplayproperties[displaypropertiesid];\r\n        const metallicData = pbmetallicdisplayproperty.data[materialData.index];\r\n        material = new MeshStandardMaterial({\r\n          flatShading: true,\r\n          roughness: metallicData.roughness,\r\n          metalness: metallicData.metallicness\r\n        });\r\n      } else {\r\n        // otherwise use PhongMaterial\r\n        material = new MeshPhongMaterial({\r\n          flatShading: true\r\n        });\r\n      }\r\n\r\n      material.name = materialData.name; // displaycolor MUST be specified with a value of a 6 or 8 digit hexadecimal number, e.g. \"#RRGGBB\" or \"#RRGGBBAA\"\r\n\r\n      const displaycolor = materialData.displaycolor;\r\n      const color = displaycolor.substring(0, 7);\r\n      material.color.setStyle(color);\r\n      material.color.convertSRGBToLinear(); // displaycolor is in sRGB\r\n      // process alpha if set\r\n\r\n      if (displaycolor.length === 9) {\r\n        material.opacity = parseInt(displaycolor.charAt(7) + displaycolor.charAt(8), 16) / 255;\r\n      }\r\n\r\n      return material;\r\n    }\r\n\r\n    function buildComposite(compositeData, objects, modelData, textureData) {\r\n      const composite = new Group();\r\n\r\n      for (let j = 0; j < compositeData.length; j++) {\r\n        const component = compositeData[j];\r\n        let build = objects[component.objectId];\r\n\r\n        if (build === undefined) {\r\n          buildObject(component.objectId, objects, modelData, textureData);\r\n          build = objects[component.objectId];\r\n        }\r\n\r\n        const object3D = build.clone(); // apply component transform\r\n\r\n        const transform = component.transform;\r\n\r\n        if (transform) {\r\n          object3D.applyMatrix4(transform);\r\n        }\r\n\r\n        composite.add(object3D);\r\n      }\r\n\r\n      return composite;\r\n    }\r\n\r\n    function buildObject(objectId, objects, modelData, textureData) {\r\n      const objectData = modelData['resources']['object'][objectId];\r\n\r\n      if (objectData['mesh']) {\r\n        const meshData = objectData['mesh'];\r\n        const extensions = modelData['extensions'];\r\n        const modelXml = modelData['xml'];\r\n        applyExtensions(extensions, meshData, modelXml);\r\n        objects[objectData.id] = getBuild(meshData, objects, modelData, textureData, objectData, buildGroup);\r\n      } else {\r\n        const compositeData = objectData['components'];\r\n        objects[objectData.id] = getBuild(compositeData, objects, modelData, textureData, objectData, buildComposite);\r\n      }\r\n    }\r\n\r\n    function buildObjects(data3mf) {\r\n      const modelsData = data3mf.model;\r\n      const modelRels = data3mf.modelRels;\r\n      const objects = {};\r\n      const modelsKeys = Object.keys(modelsData);\r\n      const textureData = {}; // evaluate model relationships to textures\r\n\r\n      if (modelRels) {\r\n        for (let i = 0, l = modelRels.length; i < l; i++) {\r\n          const modelRel = modelRels[i];\r\n          const textureKey = modelRel.target.substring(1);\r\n\r\n          if (data3mf.texture[textureKey]) {\r\n            textureData[modelRel.target] = data3mf.texture[textureKey];\r\n          }\r\n        }\r\n      } // start build\r\n\r\n\r\n      for (let i = 0; i < modelsKeys.length; i++) {\r\n        const modelsKey = modelsKeys[i];\r\n        const modelData = modelsData[modelsKey];\r\n        const objectIds = Object.keys(modelData['resources']['object']);\r\n\r\n        for (let j = 0; j < objectIds.length; j++) {\r\n          const objectId = objectIds[j];\r\n          buildObject(objectId, objects, modelData, textureData);\r\n        }\r\n      }\r\n\r\n      return objects;\r\n    }\r\n\r\n    function fetch3DModelPart(rels) {\r\n      for (let i = 0; i < rels.length; i++) {\r\n        const rel = rels[i];\r\n        const extension = rel.target.split('.').pop();\r\n        if (extension.toLowerCase() === 'model') return rel;\r\n      }\r\n    }\r\n\r\n    function build(objects, data3mf) {\r\n      const group = new Group();\r\n      const relationship = fetch3DModelPart(data3mf['rels']);\r\n      const buildData = data3mf.model[relationship['target'].substring(1)]['build'];\r\n\r\n      for (let i = 0; i < buildData.length; i++) {\r\n        const buildItem = buildData[i];\r\n        const object3D = objects[buildItem['objectId']]; // apply transform\r\n\r\n        const transform = buildItem['transform'];\r\n\r\n        if (transform) {\r\n          object3D.applyMatrix4(transform);\r\n        }\r\n\r\n        group.add(object3D);\r\n      }\r\n\r\n      return group;\r\n    }\r\n\r\n    const data3mf = loadDocument(data);\r\n    const objects = buildObjects(data3mf);\r\n    return build(objects, data3mf);\r\n  }\r\n\r\n  addExtension(extension) {\r\n    this.availableExtensions.push(extension);\r\n  }\r\n\r\n}\r\n\r\nexport { ThreeMFLoader };\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}