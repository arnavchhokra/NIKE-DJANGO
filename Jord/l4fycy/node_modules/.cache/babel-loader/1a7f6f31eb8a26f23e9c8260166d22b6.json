{"ast":null,"code":"import { Vector3, Quaternion, FileLoader, LoaderUtils, Matrix4, Bone, BufferGeometry, Float32BufferAttribute, Uint16BufferAttribute, MeshPhongMaterial, FrontSide, Vector2, SkinnedMesh, Mesh, Skeleton, AnimationClip, AnimationMixer, Loader, TextureLoader } from 'three';\n\nvar XLoader = function () {\n  var classCallCheck = function classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError('Cannot call a class as a function');\n    }\n  };\n\n  var createClass = function () {\n    function defineProperties(target, props) {\n      for (var _i2 = 0; _i2 < props.length; _i2++) {\n        var descriptor = props[_i2];\n        descriptor.enumerable = descriptor.enumerable || false;\n        descriptor.configurable = true;\n        if ('value' in descriptor) descriptor.writable = true;\n        Object.defineProperty(target, descriptor.key, descriptor);\n      }\n    }\n\n    return function (Constructor, protoProps, staticProps) {\n      if (protoProps) defineProperties(Constructor.prototype, protoProps);\n      if (staticProps) defineProperties(Constructor, staticProps);\n      return Constructor;\n    };\n  }();\n\n  var XboneInf = function XboneInf() {\n    classCallCheck(this, XboneInf);\n    this.boneName = '';\n    this.BoneIndex = 0;\n    this.Indeces = [];\n    this.Weights = [];\n    this.initMatrix = null;\n    this.OffsetMatrix = null;\n  };\n\n  var XAnimationInfo = function XAnimationInfo() {\n    classCallCheck(this, XAnimationInfo);\n    this.animeName = '';\n    this.boneName = '';\n    this.targetBone = null;\n    this.keyType = 4;\n    this.frameStartLv = 0;\n    this.keyFrames = [];\n    this.InverseMx = null;\n  };\n\n  var XAnimationObj = function () {\n    function XAnimationObj(_flags) {\n      classCallCheck(this, XAnimationObj);\n      this.fps = 30;\n      this.name = 'xanimation';\n      this.length = 0;\n      this.hierarchy = [];\n      this.putFlags = _flags;\n\n      if (this.putFlags.putPos === undefined) {\n        this.putFlags.putPos = true;\n      }\n\n      if (this.putFlags.putRot === undefined) {\n        this.putFlags.putRot = true;\n      }\n\n      if (this.putFlags.putScl === undefined) {\n        this.putFlags.putScl = true;\n      }\n    }\n\n    createClass(XAnimationObj, [{\n      key: 'make',\n      value: function make(XAnimationInfoArray) {\n        for (var _i3 = 0; _i3 < XAnimationInfoArray.length; _i3++) {\n          this.hierarchy.push(this.makeBonekeys(XAnimationInfoArray[_i3]));\n        }\n\n        this.length = this.hierarchy[0].keys[this.hierarchy[0].keys.length - 1].time;\n      }\n    }, {\n      key: 'clone',\n      value: function clone() {\n        return Object.assign({}, this);\n      }\n    }, {\n      key: 'makeBonekeys',\n      value: function makeBonekeys(XAnimationInfo) {\n        var refObj = {};\n        refObj.name = XAnimationInfo.boneName;\n        refObj.parent = '';\n        refObj.keys = this.keyFrameRefactor(XAnimationInfo);\n\n        refObj.copy = function () {\n          return Object.assign({}, this);\n        };\n\n        return refObj;\n      }\n    }, {\n      key: 'keyFrameRefactor',\n      value: function keyFrameRefactor(XAnimationInfo) {\n        var keys = [];\n\n        for (var _i4 = 0; _i4 < XAnimationInfo.keyFrames.length; _i4++) {\n          var keyframe = {};\n          keyframe.time = XAnimationInfo.keyFrames[_i4].time * this.fps;\n\n          if (XAnimationInfo.keyFrames[_i4].pos && this.putFlags.putPos) {\n            keyframe.pos = XAnimationInfo.keyFrames[_i4].pos;\n          }\n\n          if (XAnimationInfo.keyFrames[_i4].rot && this.putFlags.putRot) {\n            keyframe.rot = XAnimationInfo.keyFrames[_i4].rot;\n          }\n\n          if (XAnimationInfo.keyFrames[_i4].scl && this.putFlags.putScl) {\n            keyframe.scl = XAnimationInfo.keyFrames[_i4].scl;\n          }\n\n          if (XAnimationInfo.keyFrames[_i4].matrix) {\n            keyframe.matrix = XAnimationInfo.keyFrames[_i4].matrix;\n\n            if (this.putFlags.putPos) {\n              keyframe.pos = new Vector3().setFromMatrixPosition(keyframe.matrix);\n            }\n\n            if (this.putFlags.putRot) {\n              keyframe.rot = new Quaternion().setFromRotationMatrix(keyframe.matrix);\n            }\n\n            if (this.putFlags.putScl) {\n              keyframe.scl = new Vector3().setFromMatrixScale(keyframe.matrix);\n            }\n          }\n\n          keys.push(keyframe);\n        }\n\n        return keys;\n      }\n    }]);\n    return XAnimationObj;\n  }();\n\n  var XKeyFrameInfo = function XKeyFrameInfo() {\n    classCallCheck(this, XKeyFrameInfo);\n    this.index = 0;\n    this.Frame = 0;\n    this.time = 0.0;\n    this.matrix = null;\n  };\n\n  var XLoader = function () {\n    function XLoader(manager) {\n      Loader.call(this, manager);\n      classCallCheck(this, XLoader);\n      this.debug = false;\n      this.texloader = new TextureLoader(this.manager);\n      this.url = '';\n      this._putMatLength = 0;\n      this._nowMat = null;\n      this._nowFrameName = '';\n      this.frameHierarchie = [];\n      this.Hierarchies = {};\n      this.HieStack = [];\n      this._currentObject = {};\n      this._currentFrame = {};\n      this._data = null;\n      this.onLoad = null;\n      this.IsUvYReverse = true;\n      this.Meshes = [];\n      this.animations = [];\n      this.animTicksPerSecond = 30;\n      this._currentGeo = null;\n      this._currentAnime = null;\n      this._currentAnimeFrames = null;\n    }\n\n    createClass(XLoader, [{\n      key: '_setArgOption',\n      value: function _setArgOption(_arg) {\n        var _start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n        if (!_arg) {\n          return;\n        }\n\n        for (var _i5 = _start; _i5 < _arg.length; _i5++) {\n          switch (_i5) {\n            case 0:\n              this.url = _arg[_i5];\n              break;\n\n            case 1:\n              this.options = _arg[_i5];\n              break;\n          }\n        }\n\n        if (this.options === undefined) {\n          this.options = {};\n        }\n      }\n    }, {\n      key: 'load',\n      value: function load(_arg, onLoad, onProgress, onError) {\n        var _this = this;\n\n        this._setArgOption(_arg);\n\n        var loader = new FileLoader(this.manager);\n        loader.setPath(this.path);\n        loader.setResponseType('arraybuffer');\n        loader.setRequestHeader(this.requestHeader);\n        loader.setWithCredentials(this.withCredentials);\n        loader.load(this.url, function (response) {\n          try {\n            _this.parse(response, onLoad);\n          } catch (e) {\n            if (onError) {\n              onError(e);\n            } else {\n              console.error(e);\n            }\n\n            _this.manager.itemError(_this.url);\n          }\n        }, onProgress, onError);\n      }\n    }, {\n      key: '_readLine',\n      value: function _readLine(line) {\n        var readed = 0;\n\n        while (true) {\n          var find = -1;\n          find = line.indexOf('//', readed);\n\n          if (find === -1) {\n            find = line.indexOf('#', readed);\n          }\n\n          if (find > -1 && find < 2) {\n            var foundNewLine = -1;\n            foundNewLine = line.indexOf('\\r\\n', readed);\n\n            if (foundNewLine > 0) {\n              readed = foundNewLine + 2;\n            } else {\n              foundNewLine = line.indexOf('\\r', readed);\n\n              if (foundNewLine > 0) {\n                readed = foundNewLine + 1;\n              } else {\n                readed = line.indexOf('\\n', readed) + 1;\n              }\n            }\n          } else {\n            break;\n          }\n        }\n\n        return line.substr(readed);\n      }\n    }, {\n      key: '_readLine',\n      value: function _readLine(line) {\n        var readed = 0;\n\n        while (true) {\n          var find = -1;\n          find = line.indexOf('//', readed);\n\n          if (find === -1) {\n            find = line.indexOf('#', readed);\n          }\n\n          if (find > -1 && find < 2) {\n            var foundNewLine = -1;\n            foundNewLine = line.indexOf('\\r\\n', readed);\n\n            if (foundNewLine > 0) {\n              readed = foundNewLine + 2;\n            } else {\n              foundNewLine = line.indexOf('\\r', readed);\n\n              if (foundNewLine > 0) {\n                readed = foundNewLine + 1;\n              } else {\n                readed = line.indexOf('\\n', readed) + 1;\n              }\n            }\n          } else {\n            break;\n          }\n        }\n\n        return line.substr(readed);\n      }\n    }, {\n      key: '_isBinary',\n      value: function _isBinary(binData) {\n        var reader = new DataView(binData);\n        var face_size = 32 / 8 * 3 + 32 / 8 * 3 * 3 + 16 / 8;\n        var n_faces = reader.getUint32(80, true);\n        var expect = 80 + 32 / 8 + n_faces * face_size;\n\n        if (expect === reader.byteLength) {\n          return true;\n        }\n\n        var fileLength = reader.byteLength;\n\n        for (var index = 0; index < fileLength; index++) {\n          if (reader.getUint8(index, false) > 127) {\n            return true;\n          }\n        }\n\n        return false;\n      }\n    }, {\n      key: '_ensureBinary',\n      value: function _ensureBinary(buf) {\n        if (typeof buf === 'string') {\n          var array_buffer = new Uint8Array(buf.length);\n\n          for (var _i6 = 0; _i6 < buf.length; _i6++) {\n            array_buffer[_i6] = buf.charCodeAt(_i6) & 0xff;\n          }\n\n          return array_buffer.buffer || array_buffer;\n        } else {\n          return buf;\n        }\n      }\n    }, {\n      key: '_ensureString',\n      value: function _ensureString(buf) {\n        if (typeof buf !== 'string') {\n          return LoaderUtils.decodeText(new Uint8Array(buf));\n        } else {\n          return buf;\n        }\n      }\n    }, {\n      key: 'parse',\n      value: function _parse(data, onLoad) {\n        var binData = this._ensureBinary(data);\n\n        this._data = this._ensureString(data);\n        this.onLoad = onLoad;\n        return this._isBinary(binData) ? this._parseBinary(binData) : this._parseASCII();\n      }\n    }, {\n      key: '_parseBinary',\n      value: function _parseBinary(data) {\n        return this._parseASCII(LoaderUtils.decodeText(new Uint8Array(data)));\n      }\n    }, {\n      key: '_parseASCII',\n      value: function _parseASCII() {\n        var path;\n\n        if (this.resourcePath !== '') {\n          path = this.resourcePath;\n        } else if (this.path !== '') {\n          path = this.path;\n        } else {\n          path = LoaderUtils.extractUrlBase(this.url);\n        }\n\n        this.texloader.setPath(path).setCrossOrigin(this.crossOrigin);\n        var endRead = 16;\n        this.Hierarchies.children = [];\n\n        this._hierarchieParse(this.Hierarchies, endRead);\n\n        this._changeRoot();\n\n        this._currentObject = this.Hierarchies.children.shift();\n\n        this._mainloop();\n      }\n    }, {\n      key: '_hierarchieParse',\n      value: function _hierarchieParse(_parent, _end) {\n        var endRead = _end;\n\n        while (true) {\n          var find1 = this._data.indexOf('{', endRead) + 1;\n\n          var findEnd = this._data.indexOf('}', endRead);\n\n          var findNext = this._data.indexOf('{', find1) + 1;\n\n          if (find1 > 0 && findEnd > find1) {\n            var _currentObject = {};\n            _currentObject.children = [];\n\n            var nameData = this._readLine(this._data.substr(endRead, find1 - endRead - 1)).trim();\n\n            var word = nameData.split(/ /g);\n\n            if (word.length > 0) {\n              _currentObject.type = word[0];\n\n              if (word.length >= 2) {\n                _currentObject.name = word[1];\n              } else {\n                _currentObject.name = word[0] + this.Hierarchies.children.length;\n              }\n            } else {\n              _currentObject.name = nameData;\n              _currentObject.type = '';\n            }\n\n            if (_currentObject.type === 'Animation') {\n              _currentObject.data = this._data.substr(findNext, findEnd - findNext).trim();\n\n              var refs = this._hierarchieParse(_currentObject, findEnd + 1);\n\n              endRead = refs.end;\n              _currentObject.children = refs.parent.children;\n            } else {\n              var DataEnder = this._data.lastIndexOf(';', findNext > 0 ? Math.min(findNext, findEnd) : findEnd);\n\n              _currentObject.data = this._data.substr(find1, DataEnder - find1).trim();\n\n              if (findNext <= 0 || findEnd < findNext) {\n                endRead = findEnd + 1;\n              } else {\n                var nextStart = Math.max(DataEnder + 1, find1);\n\n                var _refs = this._hierarchieParse(_currentObject, nextStart);\n\n                endRead = _refs.end;\n                _currentObject.children = _refs.parent.children;\n              }\n            }\n\n            _currentObject.parent = _parent;\n\n            if (_currentObject.type != 'template') {\n              _parent.children.push(_currentObject);\n            }\n          } else {\n            endRead = find1 === -1 ? this._data.length : findEnd + 1;\n            break;\n          }\n        }\n\n        return {\n          parent: _parent,\n          end: endRead\n        };\n      }\n    }, {\n      key: '_mainloop',\n      value: function _mainloop() {\n        var _this2 = this;\n\n        this._mainProc();\n\n        if (this._currentObject.parent || this._currentObject.children.length > 0 || !this._currentObject.worked) {\n          setTimeout(function () {\n            _this2._mainloop();\n          }, 1);\n        } else {\n          setTimeout(function () {\n            _this2.onLoad({\n              models: _this2.Meshes,\n              animations: _this2.animations\n            });\n          }, 1);\n        }\n      }\n    }, {\n      key: '_mainProc',\n      value: function _mainProc() {\n        var breakFlag = false;\n\n        while (true) {\n          if (!this._currentObject.worked) {\n            switch (this._currentObject.type) {\n              case 'template':\n                break;\n\n              case 'AnimTicksPerSecond':\n                this.animTicksPerSecond = parseInt(this._currentObject.data);\n                break;\n\n              case 'Frame':\n                this._setFrame();\n\n                break;\n\n              case 'FrameTransformMatrix':\n                this._setFrameTransformMatrix();\n\n                break;\n\n              case 'Mesh':\n                this._changeRoot();\n\n                this._currentGeo = {};\n                this._currentGeo.name = this._currentObject.name.trim();\n                this._currentGeo.parentName = this._getParentName(this._currentObject).trim();\n                this._currentGeo.VertexSetedBoneCount = [];\n                this._currentGeo.GeometryData = {\n                  vertices: [],\n                  normals: [],\n                  uvs: [],\n                  skinIndices: [],\n                  skinWeights: [],\n                  indices: [],\n                  materialIndices: []\n                };\n                this._currentGeo.Materials = [];\n                this._currentGeo.normalVectors = [];\n                this._currentGeo.BoneInfs = [];\n                this._currentGeo.baseFrame = this._currentFrame;\n\n                this._makeBoneFrom_CurrentFrame();\n\n                this._readVertexDatas();\n\n                breakFlag = true;\n                break;\n\n              case 'MeshNormals':\n                this._readVertexDatas();\n\n                break;\n\n              case 'MeshTextureCoords':\n                this._setMeshTextureCoords();\n\n                break;\n\n              case 'VertexDuplicationIndices':\n                break;\n\n              case 'MeshMaterialList':\n                this._setMeshMaterialList();\n\n                break;\n\n              case 'Material':\n                this._setMaterial();\n\n                break;\n\n              case 'SkinWeights':\n                this._setSkinWeights();\n\n                break;\n\n              case 'AnimationSet':\n                this._changeRoot();\n\n                this._currentAnime = {};\n                this._currentAnime.name = this._currentObject.name.trim();\n                this._currentAnime.AnimeFrames = [];\n                break;\n\n              case 'Animation':\n                if (this._currentAnimeFrames) {\n                  this._currentAnime.AnimeFrames.push(this._currentAnimeFrames);\n                }\n\n                this._currentAnimeFrames = new XAnimationInfo();\n                this._currentAnimeFrames.boneName = this._currentObject.data.trim();\n                break;\n\n              case 'AnimationKey':\n                this._readAnimationKey();\n\n                breakFlag = true;\n                break;\n            }\n\n            this._currentObject.worked = true;\n          }\n\n          if (this._currentObject.children.length > 0) {\n            this._currentObject = this._currentObject.children.shift();\n\n            if (this.debug) {\n              console.log('processing ' + this._currentObject.name);\n            }\n\n            if (breakFlag) break;\n          } else {\n            if (this._currentObject.worked) {\n              if (this._currentObject.parent && !this._currentObject.parent.parent) {\n                this._changeRoot();\n              }\n            }\n\n            if (this._currentObject.parent) {\n              this._currentObject = this._currentObject.parent;\n            } else {\n              breakFlag = true;\n            }\n\n            if (breakFlag) break;\n          }\n        }\n\n        return;\n      }\n    }, {\n      key: '_changeRoot',\n      value: function _changeRoot() {\n        if (this._currentGeo != null && this._currentGeo.name) {\n          this._makeOutputGeometry();\n        }\n\n        this._currentGeo = {};\n\n        if (this._currentAnime != null && this._currentAnime.name) {\n          if (this._currentAnimeFrames) {\n            this._currentAnime.AnimeFrames.push(this._currentAnimeFrames);\n\n            this._currentAnimeFrames = null;\n          }\n\n          this._makeOutputAnimation();\n        }\n\n        this._currentAnime = {};\n      }\n    }, {\n      key: '_getParentName',\n      value: function _getParentName(_obj) {\n        if (_obj.parent) {\n          if (_obj.parent.name) {\n            return _obj.parent.name;\n          } else {\n            return this._getParentName(_obj.parent);\n          }\n        } else {\n          return '';\n        }\n      }\n    }, {\n      key: '_setFrame',\n      value: function _setFrame() {\n        this._nowFrameName = this._currentObject.name.trim();\n        this._currentFrame = {};\n        this._currentFrame.name = this._nowFrameName;\n        this._currentFrame.children = [];\n\n        if (this._currentObject.parent && this._currentObject.parent.name) {\n          this._currentFrame.parentName = this._currentObject.parent.name;\n        }\n\n        this.frameHierarchie.push(this._nowFrameName);\n        this.HieStack[this._nowFrameName] = this._currentFrame;\n      }\n    }, {\n      key: '_setFrameTransformMatrix',\n      value: function _setFrameTransformMatrix() {\n        this._currentFrame.FrameTransformMatrix = new Matrix4();\n\n        var data = this._currentObject.data.split(',');\n\n        this._ParseMatrixData(this._currentFrame.FrameTransformMatrix, data);\n\n        this._makeBoneFrom_CurrentFrame();\n      }\n    }, {\n      key: '_makeBoneFrom_CurrentFrame',\n      value: function _makeBoneFrom_CurrentFrame() {\n        if (!this._currentFrame.FrameTransformMatrix) {\n          return;\n        }\n\n        var b = new Bone();\n        b.name = this._currentFrame.name;\n        b.applyMatrix4(this._currentFrame.FrameTransformMatrix);\n        b.matrixWorld = b.matrix;\n        b.FrameTransformMatrix = this._currentFrame.FrameTransformMatrix;\n        this._currentFrame.putBone = b;\n\n        if (this._currentFrame.parentName) {\n          for (var frame in this.HieStack) {\n            if (this.HieStack[frame].name === this._currentFrame.parentName) {\n              this.HieStack[frame].putBone.add(this._currentFrame.putBone);\n            }\n          }\n        }\n      }\n    }, {\n      key: '_readVertexDatas',\n      value: function _readVertexDatas() {\n        var endRead = 0;\n        var mode = 0;\n        var mode_local = 0;\n        var maxLength = 0;\n\n        while (true) {\n          var changeMode = false;\n\n          if (mode_local === 0) {\n            var refO = this._readInt1(endRead);\n\n            endRead = refO.endRead;\n            mode_local = 1;\n            maxLength = this._currentObject.data.indexOf(';;', endRead) + 1;\n\n            if (maxLength <= 0) {\n              maxLength = this._currentObject.data.length;\n            }\n          } else {\n            var find = 0;\n\n            switch (mode) {\n              case 0:\n                find = this._currentObject.data.indexOf(',', endRead) + 1;\n                break;\n\n              case 1:\n                find = this._currentObject.data.indexOf(';,', endRead) + 1;\n                break;\n            }\n\n            if (find === 0 || find > maxLength) {\n              find = maxLength;\n              mode_local = 0;\n              changeMode = true;\n            }\n\n            switch (this._currentObject.type) {\n              case 'Mesh':\n                switch (mode) {\n                  case 0:\n                    this._readVertex1(this._currentObject.data.substr(endRead, find - endRead));\n\n                    break;\n\n                  case 1:\n                    this._readFace1(this._currentObject.data.substr(endRead, find - endRead));\n\n                    break;\n                }\n\n                break;\n\n              case 'MeshNormals':\n                switch (mode) {\n                  case 0:\n                    this._readNormalVector1(this._currentObject.data.substr(endRead, find - endRead));\n\n                    break;\n                }\n\n                break;\n            }\n\n            endRead = find + 1;\n\n            if (changeMode) {\n              mode++;\n            }\n          }\n\n          if (endRead >= this._currentObject.data.length) {\n            break;\n          }\n        }\n      }\n    }, {\n      key: '_readInt1',\n      value: function _readInt1(start) {\n        var find = this._currentObject.data.indexOf(';', start);\n\n        return {\n          refI: parseInt(this._currentObject.data.substr(start, find - start)),\n          endRead: find + 1\n        };\n      }\n    }, {\n      key: '_readVertex1',\n      value: function _readVertex1(line) {\n        var data = this._readLine(line.trim()).substr(0, line.length - 2).split(';');\n\n        this._currentGeo.GeometryData.vertices.push(parseFloat(data[0]), parseFloat(data[1]), parseFloat(data[2]));\n\n        this._currentGeo.GeometryData.skinIndices.push(0, 0, 0, 0);\n\n        this._currentGeo.GeometryData.skinWeights.push(1, 0, 0, 0);\n\n        this._currentGeo.VertexSetedBoneCount.push(0);\n      }\n    }, {\n      key: '_readFace1',\n      value: function _readFace1(line) {\n        var data = this._readLine(line.trim()).substr(2, line.length - 4).split(',');\n\n        this._currentGeo.GeometryData.indices.push(parseInt(data[0], 10), parseInt(data[1], 10), parseInt(data[2], 10));\n      }\n    }, {\n      key: '_readNormalVector1',\n      value: function _readNormalVector1(line) {\n        var data = this._readLine(line.trim()).substr(0, line.length - 2).split(';');\n\n        this._currentGeo.GeometryData.normals.push(parseFloat(data[0]), parseFloat(data[1]), parseFloat(data[2]));\n      }\n    }, {\n      key: '_buildGeometry',\n      value: function _buildGeometry() {\n        var bufferGeometry = new BufferGeometry();\n        var position = [];\n        var normals = [];\n        var uvs = [];\n        var skinIndices = [];\n        var skinWeights = []; //\n\n        var data = this._currentGeo.GeometryData;\n\n        for (var _i7 = 0, l = data.indices.length; _i7 < l; _i7++) {\n          var stride2 = data.indices[_i7] * 2;\n          var stride3 = data.indices[_i7] * 3;\n          var stride4 = data.indices[_i7] * 4;\n          position.push(data.vertices[stride3], data.vertices[stride3 + 1], data.vertices[stride3 + 2]);\n          normals.push(data.normals[stride3], data.normals[stride3 + 1], data.normals[stride3 + 2]);\n          skinIndices.push(data.skinIndices[stride4], data.skinIndices[stride4 + 1], data.skinIndices[stride4 + 2], data.skinIndices[stride4 + 3]);\n          skinWeights.push(data.skinWeights[stride4], data.skinWeights[stride4 + 1], data.skinWeights[stride4 + 2], data.skinWeights[stride4 + 3]);\n          uvs.push(data.uvs[stride2], data.uvs[stride2 + 1]);\n        } //\n\n\n        bufferGeometry.setAttribute('position', new Float32BufferAttribute(position, 3));\n        bufferGeometry.setAttribute('normal', new Float32BufferAttribute(normals, 3));\n        bufferGeometry.setAttribute('uv', new Float32BufferAttribute(uvs, 2));\n        bufferGeometry.setAttribute('skinIndex', new Uint16BufferAttribute(skinIndices, 4));\n        bufferGeometry.setAttribute('skinWeight', new Float32BufferAttribute(skinWeights, 4));\n\n        this._computeGroups(bufferGeometry, data.materialIndices);\n\n        return bufferGeometry;\n      }\n    }, {\n      key: '_computeGroups',\n      value: function _computeGroups(bufferGeometry, materialIndices) {\n        var group;\n        var groups = [];\n        var materialIndex = undefined;\n\n        for (var _i8 = 0; _i8 < materialIndices.length; _i8++) {\n          var currentMaterialIndex = materialIndices[_i8];\n\n          if (currentMaterialIndex !== materialIndex) {\n            materialIndex = currentMaterialIndex;\n\n            if (group !== undefined) {\n              group.count = _i8 * 3 - group.start;\n              groups.push(group);\n            }\n\n            group = {\n              start: _i8 * 3,\n              materialIndex: materialIndex\n            };\n          }\n        }\n\n        if (group !== undefined) {\n          group.count = i * 3 - group.start;\n          groups.push(group);\n        }\n\n        bufferGeometry.groups = groups;\n      }\n    }, {\n      key: '_setMeshTextureCoords',\n      value: function _setMeshTextureCoords() {\n        var endRead = 0;\n        var mode = 0;\n        var mode_local = 0;\n\n        while (true) {\n          switch (mode) {\n            case 0:\n              if (mode_local === 0) {\n                var refO = this._readInt1(0);\n\n                endRead = refO.endRead;\n                mode_local = 1;\n              } else {\n                var find = this._currentObject.data.indexOf(',', endRead) + 1;\n\n                if (find === 0) {\n                  find = this._currentObject.data.length;\n                  mode = 2;\n                  mode_local = 0;\n                }\n\n                var line = this._currentObject.data.substr(endRead, find - endRead);\n\n                var data = this._readLine(line.trim()).split(';');\n\n                if (this.IsUvYReverse) {\n                  this._currentGeo.GeometryData.uvs.push(parseFloat(data[0]), 1 - parseFloat(data[1]));\n                } else {\n                  this._currentGeo.GeometryData.uvs.push(parseFloat(data[0]), parseFloat(data[1]));\n                }\n\n                endRead = find + 1;\n              }\n\n              break;\n          }\n\n          if (endRead >= this._currentObject.data.length) {\n            break;\n          }\n        }\n      }\n    }, {\n      key: '_setMeshMaterialList',\n      value: function _setMeshMaterialList() {\n        var endRead = 0;\n        var mode = 0;\n        var mode_local = 0;\n\n        while (true) {\n          if (mode_local < 2) {\n            var refO = this._readInt1(endRead);\n\n            endRead = refO.endRead;\n            mode_local++;\n          } else {\n            var find = this._currentObject.data.indexOf(';', endRead);\n\n            if (find === -1) {\n              find = this._currentObject.data.length;\n              mode = 3;\n              mode_local = 0;\n            }\n\n            var line = this._currentObject.data.substr(endRead, find - endRead);\n\n            var data = this._readLine(line.trim()).split(',');\n\n            for (var _i9 = 0; _i9 < data.length; _i9++) {\n              this._currentGeo.GeometryData.materialIndices[_i9] = parseInt(data[_i9]);\n            }\n\n            endRead = this._currentObject.data.length;\n          }\n\n          if (endRead >= this._currentObject.data.length || mode >= 3) {\n            break;\n          }\n        }\n      }\n    }, {\n      key: '_setMaterial',\n      value: function _setMaterial() {\n        var _nowMat = new MeshPhongMaterial({\n          color: Math.random() * 0xffffff\n        });\n\n        _nowMat.side = FrontSide;\n        _nowMat.name = this._currentObject.name;\n        var endRead = 0;\n\n        var find = this._currentObject.data.indexOf(';;', endRead);\n\n        var line = this._currentObject.data.substr(endRead, find - endRead);\n\n        var data = this._readLine(line.trim()).split(';');\n\n        _nowMat.color.r = parseFloat(data[0]);\n        _nowMat.color.g = parseFloat(data[1]);\n        _nowMat.color.b = parseFloat(data[2]);\n        endRead = find + 2;\n        find = this._currentObject.data.indexOf(';', endRead);\n        line = this._currentObject.data.substr(endRead, find - endRead);\n        _nowMat.shininess = parseFloat(this._readLine(line));\n        endRead = find + 1;\n        find = this._currentObject.data.indexOf(';;', endRead);\n        line = this._currentObject.data.substr(endRead, find - endRead);\n\n        var data2 = this._readLine(line.trim()).split(';');\n\n        _nowMat.specular.r = parseFloat(data2[0]);\n        _nowMat.specular.g = parseFloat(data2[1]);\n        _nowMat.specular.b = parseFloat(data2[2]);\n        endRead = find + 2;\n        find = this._currentObject.data.indexOf(';;', endRead);\n\n        if (find === -1) {\n          find = this._currentObject.data.length;\n        }\n\n        line = this._currentObject.data.substr(endRead, find - endRead);\n\n        var data3 = this._readLine(line.trim()).split(';');\n\n        _nowMat.emissive.r = parseFloat(data3[0]);\n        _nowMat.emissive.g = parseFloat(data3[1]);\n        _nowMat.emissive.b = parseFloat(data3[2]);\n        var localObject = null;\n\n        while (true) {\n          if (this._currentObject.children.length > 0) {\n            localObject = this._currentObject.children.shift();\n\n            if (this.debug) {\n              console.log('processing ' + localObject.name);\n            }\n\n            var fileName = localObject.data.substr(1, localObject.data.length - 2);\n\n            switch (localObject.type) {\n              case 'TextureFilename':\n                _nowMat.map = this.texloader.load(fileName);\n                break;\n\n              case 'BumpMapFilename':\n                _nowMat.bumpMap = this.texloader.load(fileName);\n                _nowMat.bumpScale = 0.05;\n                break;\n\n              case 'NormalMapFilename':\n                _nowMat.normalMap = this.texloader.load(fileName);\n                _nowMat.normalScale = new Vector2(2, 2);\n                break;\n\n              case 'EmissiveMapFilename':\n                _nowMat.emissiveMap = this.texloader.load(fileName);\n                break;\n\n              case 'LightMapFilename':\n                _nowMat.lightMap = this.texloader.load(fileName);\n                break;\n            }\n          } else {\n            break;\n          }\n        }\n\n        this._currentGeo.Materials.push(_nowMat);\n      }\n    }, {\n      key: '_setSkinWeights',\n      value: function _setSkinWeights() {\n        var boneInf = new XboneInf();\n        var endRead = 0;\n\n        var find = this._currentObject.data.indexOf(';', endRead);\n\n        var line = this._currentObject.data.substr(endRead, find - endRead);\n\n        endRead = find + 1;\n        boneInf.boneName = line.substr(1, line.length - 2);\n        boneInf.BoneIndex = this._currentGeo.BoneInfs.length;\n        find = this._currentObject.data.indexOf(';', endRead);\n        endRead = find + 1;\n        find = this._currentObject.data.indexOf(';', endRead);\n        line = this._currentObject.data.substr(endRead, find - endRead);\n\n        var data = this._readLine(line.trim()).split(',');\n\n        for (var _i10 = 0; _i10 < data.length; _i10++) {\n          boneInf.Indeces.push(parseInt(data[_i10]));\n        }\n\n        endRead = find + 1;\n        find = this._currentObject.data.indexOf(';', endRead);\n        line = this._currentObject.data.substr(endRead, find - endRead);\n\n        var data2 = this._readLine(line.trim()).split(',');\n\n        for (var _i = 0; _i < data2.length; _i++) {\n          boneInf.Weights.push(parseFloat(data2[_i]));\n        }\n\n        endRead = find + 1;\n        find = this._currentObject.data.indexOf(';', endRead);\n\n        if (find <= 0) {\n          find = this._currentObject.data.length;\n        }\n\n        line = this._currentObject.data.substr(endRead, find - endRead);\n\n        var data3 = this._readLine(line.trim()).split(',');\n\n        boneInf.OffsetMatrix = new Matrix4();\n\n        this._ParseMatrixData(boneInf.OffsetMatrix, data3);\n\n        this._currentGeo.BoneInfs.push(boneInf);\n      }\n    }, {\n      key: '_makePutBoneList',\n      value: function _makePutBoneList(_RootName, _bones) {\n        var putting = false;\n\n        for (var frame in this.HieStack) {\n          if (this.HieStack[frame].name === _RootName || putting) {\n            putting = true;\n            var b = new Bone();\n            b.name = this.HieStack[frame].name;\n            b.applyMatrix4(this.HieStack[frame].FrameTransformMatrix);\n            b.matrixWorld = b.matrix;\n            b.FrameTransformMatrix = this.HieStack[frame].FrameTransformMatrix;\n            b.pos = new Vector3().setFromMatrixPosition(b.FrameTransformMatrix).toArray();\n            b.rotq = new Quaternion().setFromRotationMatrix(b.FrameTransformMatrix).toArray();\n            b.scl = new Vector3().setFromMatrixScale(b.FrameTransformMatrix).toArray();\n\n            if (this.HieStack[frame].parentName && this.HieStack[frame].parentName.length > 0) {\n              for (var _i11 = 0; _i11 < _bones.length; _i11++) {\n                if (this.HieStack[frame].parentName === _bones[_i11].name) {\n                  _bones[_i11].add(b);\n\n                  b.parent = _i11;\n                  break;\n                }\n              }\n            }\n\n            _bones.push(b);\n          }\n        }\n      }\n    }, {\n      key: '_makeOutputGeometry',\n      value: function _makeOutputGeometry() {\n        var mesh = null;\n\n        if (this._currentGeo.BoneInfs.length > 0) {\n          var putBones = [];\n\n          this._makePutBoneList(this._currentGeo.baseFrame.parentName, putBones);\n\n          for (var bi = 0; bi < this._currentGeo.BoneInfs.length; bi++) {\n            var boneIndex = 0;\n\n            for (var bb = 0; bb < putBones.length; bb++) {\n              if (putBones[bb].name === this._currentGeo.BoneInfs[bi].boneName) {\n                boneIndex = bb;\n                putBones[bb].OffsetMatrix = new Matrix4();\n                putBones[bb].OffsetMatrix.copy(this._currentGeo.BoneInfs[bi].OffsetMatrix);\n                break;\n              }\n            }\n\n            for (var vi = 0; vi < this._currentGeo.BoneInfs[bi].Indeces.length; vi++) {\n              var nowVertexID = this._currentGeo.BoneInfs[bi].Indeces[vi];\n              var nowVal = this._currentGeo.BoneInfs[bi].Weights[vi];\n              var stride = nowVertexID * 4;\n\n              switch (this._currentGeo.VertexSetedBoneCount[nowVertexID]) {\n                case 0:\n                  this._currentGeo.GeometryData.skinIndices[stride] = boneIndex;\n                  this._currentGeo.GeometryData.skinWeights[stride] = nowVal;\n                  break;\n\n                case 1:\n                  this._currentGeo.GeometryData.skinIndices[stride + 1] = boneIndex;\n                  this._currentGeo.GeometryData.skinWeights[stride + 1] = nowVal;\n                  break;\n\n                case 2:\n                  this._currentGeo.GeometryData.skinIndices[stride + 2] = boneIndex;\n                  this._currentGeo.GeometryData.skinWeights[stride + 2] = nowVal;\n                  break;\n\n                case 3:\n                  this._currentGeo.GeometryData.skinIndices[stride + 3] = boneIndex;\n                  this._currentGeo.GeometryData.skinWeights[stride + 3] = nowVal;\n                  break;\n              }\n\n              this._currentGeo.VertexSetedBoneCount[nowVertexID]++;\n\n              if (this._currentGeo.VertexSetedBoneCount[nowVertexID] > 4) {\n                console.log('warn! over 4 bone weight! :' + nowVertexID);\n              }\n            }\n          }\n\n          for (var sk = 0; sk < this._currentGeo.Materials.length; sk++) {\n            this._currentGeo.Materials[sk].skinning = true;\n          }\n\n          var offsetList = [];\n\n          for (var _bi = 0; _bi < putBones.length; _bi++) {\n            if (putBones[_bi].OffsetMatrix) {\n              offsetList.push(putBones[_bi].OffsetMatrix);\n            } else {\n              offsetList.push(new Matrix4());\n            }\n          }\n\n          var bufferGeometry = this._buildGeometry();\n\n          mesh = new SkinnedMesh(bufferGeometry, this._currentGeo.Materials.length === 1 ? this._currentGeo.Materials[0] : this._currentGeo.Materials);\n\n          this._initSkeleton(mesh, putBones, offsetList);\n        } else {\n          var _bufferGeometry = this._buildGeometry();\n\n          mesh = new Mesh(_bufferGeometry, this._currentGeo.Materials.length === 1 ? this._currentGeo.Materials[0] : this._currentGeo.Materials);\n        }\n\n        mesh.name = this._currentGeo.name;\n        var worldBaseMx = new Matrix4();\n        var currentMxFrame = this._currentGeo.baseFrame.putBone;\n\n        if (currentMxFrame && currentMxFrame.parent) {\n          while (true) {\n            currentMxFrame = currentMxFrame.parent;\n\n            if (currentMxFrame) {\n              worldBaseMx.multiply(currentMxFrame.FrameTransformMatrix);\n            } else {\n              break;\n            }\n          }\n\n          mesh.applyMatrix4(worldBaseMx);\n        }\n\n        this.Meshes.push(mesh);\n      }\n    }, {\n      key: '_initSkeleton',\n      value: function _initSkeleton(mesh, boneList, boneInverses) {\n        var bones = [],\n            bone,\n            gbone;\n        var i, il;\n\n        for (i = 0, il = boneList.length; i < il; i++) {\n          gbone = boneList[i];\n          bone = new Bone();\n          bones.push(bone);\n          bone.name = gbone.name;\n          bone.position.fromArray(gbone.pos);\n          bone.quaternion.fromArray(gbone.rotq);\n          if (gbone.scl !== undefined) bone.scale.fromArray(gbone.scl);\n        }\n\n        for (i = 0, il = boneList.length; i < il; i++) {\n          gbone = boneList[i];\n\n          if (gbone.parent !== -1 && gbone.parent !== null && bones[gbone.parent] !== undefined) {\n            bones[gbone.parent].add(bones[i]);\n          } else {\n            mesh.add(bones[i]);\n          }\n        }\n\n        mesh.updateMatrixWorld(true);\n        var skeleton = new Skeleton(bones, boneInverses);\n        mesh.bind(skeleton, mesh.matrixWorld);\n      }\n    }, {\n      key: '_readAnimationKey',\n      value: function _readAnimationKey() {\n        var endRead = 0;\n\n        var find = this._currentObject.data.indexOf(';', endRead);\n\n        var line = this._currentObject.data.substr(endRead, find - endRead);\n\n        endRead = find + 1;\n        var nowKeyType = parseInt(this._readLine(line));\n        find = this._currentObject.data.indexOf(';', endRead);\n        endRead = find + 1;\n        line = this._currentObject.data.substr(endRead);\n\n        var data = this._readLine(line.trim()).split(';;,');\n\n        for (var _i12 = 0; _i12 < data.length; _i12++) {\n          var data2 = data[_i12].split(';');\n\n          var keyInfo = new XKeyFrameInfo();\n          keyInfo.type = nowKeyType;\n          keyInfo.Frame = parseInt(data2[0]);\n          keyInfo.index = this._currentAnimeFrames.keyFrames.length;\n          keyInfo.time = keyInfo.Frame;\n\n          if (nowKeyType != 4) {\n            var frameFound = false;\n\n            for (var mm = 0; mm < this._currentAnimeFrames.keyFrames.length; mm++) {\n              if (this._currentAnimeFrames.keyFrames[mm].Frame === keyInfo.Frame) {\n                keyInfo = this._currentAnimeFrames.keyFrames[mm];\n                frameFound = true;\n                break;\n              }\n            }\n\n            var frameValue = data2[2].split(',');\n\n            switch (nowKeyType) {\n              case 0:\n                keyInfo.rot = new Quaternion(parseFloat(frameValue[1]), parseFloat(frameValue[2]), parseFloat(frameValue[3]), parseFloat(frameValue[0]) * -1);\n                break;\n\n              case 1:\n                keyInfo.scl = new Vector3(parseFloat(frameValue[0]), parseFloat(frameValue[1]), parseFloat(frameValue[2]));\n                break;\n\n              case 2:\n                keyInfo.pos = new Vector3(parseFloat(frameValue[0]), parseFloat(frameValue[1]), parseFloat(frameValue[2]));\n                break;\n            }\n\n            if (!frameFound) {\n              this._currentAnimeFrames.keyFrames.push(keyInfo);\n            }\n          } else {\n            keyInfo.matrix = new Matrix4();\n\n            this._ParseMatrixData(keyInfo.matrix, data2[2].split(','));\n\n            this._currentAnimeFrames.keyFrames.push(keyInfo);\n          }\n        }\n      }\n    }, {\n      key: '_makeOutputAnimation',\n      value: function _makeOutputAnimation() {\n        var animationObj = new XAnimationObj(this.options);\n        animationObj.fps = this.animTicksPerSecond;\n        animationObj.name = this._currentAnime.name;\n        animationObj.make(this._currentAnime.AnimeFrames);\n        this.animations.push(animationObj);\n      }\n    }, {\n      key: 'assignAnimation',\n      value: function assignAnimation(_model, _animation) {\n        var model = _model;\n        var animation = _animation;\n\n        if (!model) {\n          model = this.Meshes[0];\n        }\n\n        if (!animation) {\n          animation = this.animations[0];\n        }\n\n        if (!model || !animation) {\n          return null;\n        }\n\n        var put = {};\n        put.fps = animation.fps;\n        put.name = animation.name;\n        put.length = animation.length;\n        put.hierarchy = [];\n\n        for (var b = 0; b < model.skeleton.bones.length; b++) {\n          var findAnimation = false;\n\n          for (var _i13 = 0; _i13 < animation.hierarchy.length; _i13++) {\n            if (model.skeleton.bones[b].name === animation.hierarchy[_i13].name) {\n              findAnimation = true;\n\n              var c_key = animation.hierarchy[_i13].copy();\n\n              c_key.parent = -1;\n\n              if (model.skeleton.bones[b].parent && model.skeleton.bones[b].parent.type === 'Bone') {\n                for (var bb = 0; bb < put.hierarchy.length; bb++) {\n                  if (put.hierarchy[bb].name === model.skeleton.bones[b].parent.name) {\n                    c_key.parent = bb;\n                    c_key.parentName = model.skeleton.bones[b].parent.name;\n                  }\n                }\n              }\n\n              put.hierarchy.push(c_key);\n              break;\n            }\n          }\n\n          if (!findAnimation) {\n            var _c_key = animation.hierarchy[0].copy();\n\n            _c_key.name = model.skeleton.bones[b].name;\n            _c_key.parent = -1;\n\n            for (var k = 0; k < _c_key.keys.length; k++) {\n              if (_c_key.keys[k].pos) {\n                _c_key.keys[k].pos.set(0, 0, 0);\n              }\n\n              if (_c_key.keys[k].scl) {\n                _c_key.keys[k].scl.set(1, 1, 1);\n              }\n\n              if (_c_key.keys[k].rot) {\n                _c_key.keys[k].rot.set(0, 0, 0, 1);\n              }\n            }\n\n            put.hierarchy.push(_c_key);\n          }\n        }\n\n        if (!model.geometry.animations) {\n          model.geometry.animations = [];\n        }\n\n        model.geometry.animations.push(AnimationClip.parseAnimation(put, model.skeleton.bones));\n\n        if (!model.animationMixer) {\n          model.animationMixer = new AnimationMixer(model);\n        }\n\n        return put;\n      }\n    }, {\n      key: '_ParseMatrixData',\n      value: function _ParseMatrixData(targetMatrix, data) {\n        targetMatrix.set(parseFloat(data[0]), parseFloat(data[4]), parseFloat(data[8]), parseFloat(data[12]), parseFloat(data[1]), parseFloat(data[5]), parseFloat(data[9]), parseFloat(data[13]), parseFloat(data[2]), parseFloat(data[6]), parseFloat(data[10]), parseFloat(data[14]), parseFloat(data[3]), parseFloat(data[7]), parseFloat(data[11]), parseFloat(data[15]));\n      }\n    }]);\n    return XLoader;\n  }();\n\n  return XLoader;\n}();\n\nexport { XLoader };","map":{"version":3,"names":["Vector3","Quaternion","FileLoader","LoaderUtils","Matrix4","Bone","BufferGeometry","Float32BufferAttribute","Uint16BufferAttribute","MeshPhongMaterial","FrontSide","Vector2","SkinnedMesh","Mesh","Skeleton","AnimationClip","AnimationMixer","Loader","TextureLoader","XLoader","classCallCheck","instance","Constructor","TypeError","createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","XboneInf","boneName","BoneIndex","Indeces","Weights","initMatrix","OffsetMatrix","XAnimationInfo","animeName","targetBone","keyType","frameStartLv","keyFrames","InverseMx","XAnimationObj","_flags","fps","name","hierarchy","putFlags","putPos","undefined","putRot","putScl","value","make","XAnimationInfoArray","push","makeBonekeys","keys","time","clone","assign","refObj","parent","keyFrameRefactor","copy","keyframe","pos","rot","scl","matrix","setFromMatrixPosition","setFromRotationMatrix","setFromMatrixScale","XKeyFrameInfo","index","Frame","manager","call","debug","texloader","url","_putMatLength","_nowMat","_nowFrameName","frameHierarchie","Hierarchies","HieStack","_currentObject","_currentFrame","_data","onLoad","IsUvYReverse","Meshes","animations","animTicksPerSecond","_currentGeo","_currentAnime","_currentAnimeFrames","_setArgOption","_arg","_start","arguments","options","load","onProgress","onError","_this","loader","setPath","path","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","response","parse","e","console","error","itemError","_readLine","line","readed","find","indexOf","foundNewLine","substr","_isBinary","binData","reader","DataView","face_size","n_faces","getUint32","expect","byteLength","fileLength","getUint8","_ensureBinary","buf","array_buffer","Uint8Array","charCodeAt","buffer","_ensureString","decodeText","_parse","data","_parseBinary","_parseASCII","resourcePath","extractUrlBase","setCrossOrigin","crossOrigin","endRead","children","_hierarchieParse","_changeRoot","shift","_mainloop","_parent","_end","find1","findEnd","findNext","nameData","trim","word","split","type","refs","end","DataEnder","lastIndexOf","Math","min","nextStart","max","_refs","_this2","_mainProc","worked","setTimeout","models","breakFlag","parseInt","_setFrame","_setFrameTransformMatrix","parentName","_getParentName","VertexSetedBoneCount","GeometryData","vertices","normals","uvs","skinIndices","skinWeights","indices","materialIndices","Materials","normalVectors","BoneInfs","baseFrame","_makeBoneFrom_CurrentFrame","_readVertexDatas","_setMeshTextureCoords","_setMeshMaterialList","_setMaterial","_setSkinWeights","AnimeFrames","_readAnimationKey","log","_makeOutputGeometry","_makeOutputAnimation","_obj","FrameTransformMatrix","_ParseMatrixData","b","applyMatrix4","matrixWorld","putBone","frame","add","mode","mode_local","maxLength","changeMode","refO","_readInt1","_readVertex1","_readFace1","_readNormalVector1","start","refI","parseFloat","_buildGeometry","bufferGeometry","position","l","stride2","stride3","stride4","setAttribute","_computeGroups","group","groups","materialIndex","currentMaterialIndex","count","color","random","side","r","g","shininess","data2","specular","data3","emissive","localObject","fileName","map","bumpMap","bumpScale","normalMap","normalScale","emissiveMap","lightMap","boneInf","_i","_makePutBoneList","_RootName","_bones","putting","toArray","rotq","mesh","putBones","bi","boneIndex","bb","vi","nowVertexID","nowVal","stride","sk","skinning","offsetList","_bi","_initSkeleton","_bufferGeometry","worldBaseMx","currentMxFrame","multiply","boneList","boneInverses","bones","bone","gbone","il","fromArray","quaternion","scale","updateMatrixWorld","skeleton","bind","nowKeyType","keyInfo","frameFound","mm","frameValue","animationObj","assignAnimation","_model","_animation","model","animation","put","findAnimation","c_key","_c_key","k","set","geometry","parseAnimation","animationMixer","targetMatrix"],"sources":["D:/Github/NIKE-DJANGO/Jord/l4fycy/node_modules/three-stdlib/loaders/XLoader.js"],"sourcesContent":["import { Vector3, Quaternion, FileLoader, LoaderUtils, Matrix4, Bone, BufferGeometry, Float32BufferAttribute, Uint16BufferAttribute, MeshPhongMaterial, FrontSide, Vector2, SkinnedMesh, Mesh, Skeleton, AnimationClip, AnimationMixer, Loader, TextureLoader } from 'three';\r\n\r\nvar XLoader = function () {\r\n  var classCallCheck = function (instance, Constructor) {\r\n    if (!(instance instanceof Constructor)) {\r\n      throw new TypeError('Cannot call a class as a function');\r\n    }\r\n  };\r\n\r\n  var createClass = function () {\r\n    function defineProperties(target, props) {\r\n      for (let i = 0; i < props.length; i++) {\r\n        var descriptor = props[i];\r\n        descriptor.enumerable = descriptor.enumerable || false;\r\n        descriptor.configurable = true;\r\n        if ('value' in descriptor) descriptor.writable = true;\r\n        Object.defineProperty(target, descriptor.key, descriptor);\r\n      }\r\n    }\r\n\r\n    return function (Constructor, protoProps, staticProps) {\r\n      if (protoProps) defineProperties(Constructor.prototype, protoProps);\r\n      if (staticProps) defineProperties(Constructor, staticProps);\r\n      return Constructor;\r\n    };\r\n  }();\r\n\r\n  var XboneInf = function XboneInf() {\r\n    classCallCheck(this, XboneInf);\r\n    this.boneName = '';\r\n    this.BoneIndex = 0;\r\n    this.Indeces = [];\r\n    this.Weights = [];\r\n    this.initMatrix = null;\r\n    this.OffsetMatrix = null;\r\n  };\r\n\r\n  var XAnimationInfo = function XAnimationInfo() {\r\n    classCallCheck(this, XAnimationInfo);\r\n    this.animeName = '';\r\n    this.boneName = '';\r\n    this.targetBone = null;\r\n    this.keyType = 4;\r\n    this.frameStartLv = 0;\r\n    this.keyFrames = [];\r\n    this.InverseMx = null;\r\n  };\r\n\r\n  var XAnimationObj = function () {\r\n    function XAnimationObj(_flags) {\r\n      classCallCheck(this, XAnimationObj);\r\n      this.fps = 30;\r\n      this.name = 'xanimation';\r\n      this.length = 0;\r\n      this.hierarchy = [];\r\n      this.putFlags = _flags;\r\n\r\n      if (this.putFlags.putPos === undefined) {\r\n        this.putFlags.putPos = true;\r\n      }\r\n\r\n      if (this.putFlags.putRot === undefined) {\r\n        this.putFlags.putRot = true;\r\n      }\r\n\r\n      if (this.putFlags.putScl === undefined) {\r\n        this.putFlags.putScl = true;\r\n      }\r\n    }\r\n\r\n    createClass(XAnimationObj, [{\r\n      key: 'make',\r\n      value: function make(XAnimationInfoArray) {\r\n        for (let i = 0; i < XAnimationInfoArray.length; i++) {\r\n          this.hierarchy.push(this.makeBonekeys(XAnimationInfoArray[i]));\r\n        }\r\n\r\n        this.length = this.hierarchy[0].keys[this.hierarchy[0].keys.length - 1].time;\r\n      }\r\n    }, {\r\n      key: 'clone',\r\n      value: function clone() {\r\n        return Object.assign({}, this);\r\n      }\r\n    }, {\r\n      key: 'makeBonekeys',\r\n      value: function makeBonekeys(XAnimationInfo) {\r\n        var refObj = {};\r\n        refObj.name = XAnimationInfo.boneName;\r\n        refObj.parent = '';\r\n        refObj.keys = this.keyFrameRefactor(XAnimationInfo);\r\n\r\n        refObj.copy = function () {\r\n          return Object.assign({}, this);\r\n        };\r\n\r\n        return refObj;\r\n      }\r\n    }, {\r\n      key: 'keyFrameRefactor',\r\n      value: function keyFrameRefactor(XAnimationInfo) {\r\n        var keys = [];\r\n\r\n        for (let i = 0; i < XAnimationInfo.keyFrames.length; i++) {\r\n          var keyframe = {};\r\n          keyframe.time = XAnimationInfo.keyFrames[i].time * this.fps;\r\n\r\n          if (XAnimationInfo.keyFrames[i].pos && this.putFlags.putPos) {\r\n            keyframe.pos = XAnimationInfo.keyFrames[i].pos;\r\n          }\r\n\r\n          if (XAnimationInfo.keyFrames[i].rot && this.putFlags.putRot) {\r\n            keyframe.rot = XAnimationInfo.keyFrames[i].rot;\r\n          }\r\n\r\n          if (XAnimationInfo.keyFrames[i].scl && this.putFlags.putScl) {\r\n            keyframe.scl = XAnimationInfo.keyFrames[i].scl;\r\n          }\r\n\r\n          if (XAnimationInfo.keyFrames[i].matrix) {\r\n            keyframe.matrix = XAnimationInfo.keyFrames[i].matrix;\r\n\r\n            if (this.putFlags.putPos) {\r\n              keyframe.pos = new Vector3().setFromMatrixPosition(keyframe.matrix);\r\n            }\r\n\r\n            if (this.putFlags.putRot) {\r\n              keyframe.rot = new Quaternion().setFromRotationMatrix(keyframe.matrix);\r\n            }\r\n\r\n            if (this.putFlags.putScl) {\r\n              keyframe.scl = new Vector3().setFromMatrixScale(keyframe.matrix);\r\n            }\r\n          }\r\n\r\n          keys.push(keyframe);\r\n        }\r\n\r\n        return keys;\r\n      }\r\n    }]);\r\n    return XAnimationObj;\r\n  }();\r\n\r\n  var XKeyFrameInfo = function XKeyFrameInfo() {\r\n    classCallCheck(this, XKeyFrameInfo);\r\n    this.index = 0;\r\n    this.Frame = 0;\r\n    this.time = 0.0;\r\n    this.matrix = null;\r\n  };\r\n\r\n  var XLoader = function () {\r\n    function XLoader(manager) {\r\n      Loader.call(this, manager);\r\n      classCallCheck(this, XLoader);\r\n      this.debug = false;\r\n      this.texloader = new TextureLoader(this.manager);\r\n      this.url = '';\r\n      this._putMatLength = 0;\r\n      this._nowMat = null;\r\n      this._nowFrameName = '';\r\n      this.frameHierarchie = [];\r\n      this.Hierarchies = {};\r\n      this.HieStack = [];\r\n      this._currentObject = {};\r\n      this._currentFrame = {};\r\n      this._data = null;\r\n      this.onLoad = null;\r\n      this.IsUvYReverse = true;\r\n      this.Meshes = [];\r\n      this.animations = [];\r\n      this.animTicksPerSecond = 30;\r\n      this._currentGeo = null;\r\n      this._currentAnime = null;\r\n      this._currentAnimeFrames = null;\r\n    }\r\n\r\n    createClass(XLoader, [{\r\n      key: '_setArgOption',\r\n      value: function _setArgOption(_arg) {\r\n        var _start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\r\n\r\n        if (!_arg) {\r\n          return;\r\n        }\r\n\r\n        for (let i = _start; i < _arg.length; i++) {\r\n          switch (i) {\r\n            case 0:\r\n              this.url = _arg[i];\r\n              break;\r\n\r\n            case 1:\r\n              this.options = _arg[i];\r\n              break;\r\n          }\r\n        }\r\n\r\n        if (this.options === undefined) {\r\n          this.options = {};\r\n        }\r\n      }\r\n    }, {\r\n      key: 'load',\r\n      value: function load(_arg, onLoad, onProgress, onError) {\r\n        var _this = this;\r\n\r\n        this._setArgOption(_arg);\r\n\r\n        var loader = new FileLoader(this.manager);\r\n        loader.setPath(this.path);\r\n        loader.setResponseType('arraybuffer');\r\n        loader.setRequestHeader(this.requestHeader);\r\n        loader.setWithCredentials(this.withCredentials);\r\n        loader.load(this.url, function (response) {\r\n          try {\r\n            _this.parse(response, onLoad);\r\n          } catch (e) {\r\n            if (onError) {\r\n              onError(e);\r\n            } else {\r\n              console.error(e);\r\n            }\r\n\r\n            _this.manager.itemError(_this.url);\r\n          }\r\n        }, onProgress, onError);\r\n      }\r\n    }, {\r\n      key: '_readLine',\r\n      value: function _readLine(line) {\r\n        var readed = 0;\r\n\r\n        while (true) {\r\n          var find = -1;\r\n          find = line.indexOf('//', readed);\r\n\r\n          if (find === -1) {\r\n            find = line.indexOf('#', readed);\r\n          }\r\n\r\n          if (find > -1 && find < 2) {\r\n            var foundNewLine = -1;\r\n            foundNewLine = line.indexOf('\\r\\n', readed);\r\n\r\n            if (foundNewLine > 0) {\r\n              readed = foundNewLine + 2;\r\n            } else {\r\n              foundNewLine = line.indexOf('\\r', readed);\r\n\r\n              if (foundNewLine > 0) {\r\n                readed = foundNewLine + 1;\r\n              } else {\r\n                readed = line.indexOf('\\n', readed) + 1;\r\n              }\r\n            }\r\n          } else {\r\n            break;\r\n          }\r\n        }\r\n\r\n        return line.substr(readed);\r\n      }\r\n    }, {\r\n      key: '_readLine',\r\n      value: function _readLine(line) {\r\n        var readed = 0;\r\n\r\n        while (true) {\r\n          var find = -1;\r\n          find = line.indexOf('//', readed);\r\n\r\n          if (find === -1) {\r\n            find = line.indexOf('#', readed);\r\n          }\r\n\r\n          if (find > -1 && find < 2) {\r\n            var foundNewLine = -1;\r\n            foundNewLine = line.indexOf('\\r\\n', readed);\r\n\r\n            if (foundNewLine > 0) {\r\n              readed = foundNewLine + 2;\r\n            } else {\r\n              foundNewLine = line.indexOf('\\r', readed);\r\n\r\n              if (foundNewLine > 0) {\r\n                readed = foundNewLine + 1;\r\n              } else {\r\n                readed = line.indexOf('\\n', readed) + 1;\r\n              }\r\n            }\r\n          } else {\r\n            break;\r\n          }\r\n        }\r\n\r\n        return line.substr(readed);\r\n      }\r\n    }, {\r\n      key: '_isBinary',\r\n      value: function _isBinary(binData) {\r\n        var reader = new DataView(binData);\r\n        var face_size = 32 / 8 * 3 + 32 / 8 * 3 * 3 + 16 / 8;\r\n        var n_faces = reader.getUint32(80, true);\r\n        var expect = 80 + 32 / 8 + n_faces * face_size;\r\n\r\n        if (expect === reader.byteLength) {\r\n          return true;\r\n        }\r\n\r\n        var fileLength = reader.byteLength;\r\n\r\n        for (let index = 0; index < fileLength; index++) {\r\n          if (reader.getUint8(index, false) > 127) {\r\n            return true;\r\n          }\r\n        }\r\n\r\n        return false;\r\n      }\r\n    }, {\r\n      key: '_ensureBinary',\r\n      value: function _ensureBinary(buf) {\r\n        if (typeof buf === 'string') {\r\n          var array_buffer = new Uint8Array(buf.length);\r\n\r\n          for (let i = 0; i < buf.length; i++) {\r\n            array_buffer[i] = buf.charCodeAt(i) & 0xff;\r\n          }\r\n\r\n          return array_buffer.buffer || array_buffer;\r\n        } else {\r\n          return buf;\r\n        }\r\n      }\r\n    }, {\r\n      key: '_ensureString',\r\n      value: function _ensureString(buf) {\r\n        if (typeof buf !== 'string') {\r\n          return LoaderUtils.decodeText(new Uint8Array(buf));\r\n        } else {\r\n          return buf;\r\n        }\r\n      }\r\n    }, {\r\n      key: 'parse',\r\n      value: function _parse(data, onLoad) {\r\n        var binData = this._ensureBinary(data);\r\n\r\n        this._data = this._ensureString(data);\r\n        this.onLoad = onLoad;\r\n        return this._isBinary(binData) ? this._parseBinary(binData) : this._parseASCII();\r\n      }\r\n    }, {\r\n      key: '_parseBinary',\r\n      value: function _parseBinary(data) {\r\n        return this._parseASCII(LoaderUtils.decodeText(new Uint8Array(data)));\r\n      }\r\n    }, {\r\n      key: '_parseASCII',\r\n      value: function _parseASCII() {\r\n        var path;\r\n\r\n        if (this.resourcePath !== '') {\r\n          path = this.resourcePath;\r\n        } else if (this.path !== '') {\r\n          path = this.path;\r\n        } else {\r\n          path = LoaderUtils.extractUrlBase(this.url);\r\n        }\r\n\r\n        this.texloader.setPath(path).setCrossOrigin(this.crossOrigin);\r\n        var endRead = 16;\r\n        this.Hierarchies.children = [];\r\n\r\n        this._hierarchieParse(this.Hierarchies, endRead);\r\n\r\n        this._changeRoot();\r\n\r\n        this._currentObject = this.Hierarchies.children.shift();\r\n\r\n        this._mainloop();\r\n      }\r\n    }, {\r\n      key: '_hierarchieParse',\r\n      value: function _hierarchieParse(_parent, _end) {\r\n        var endRead = _end;\r\n\r\n        while (true) {\r\n          var find1 = this._data.indexOf('{', endRead) + 1;\r\n\r\n          var findEnd = this._data.indexOf('}', endRead);\r\n\r\n          var findNext = this._data.indexOf('{', find1) + 1;\r\n\r\n          if (find1 > 0 && findEnd > find1) {\r\n            var _currentObject = {};\r\n            _currentObject.children = [];\r\n\r\n            var nameData = this._readLine(this._data.substr(endRead, find1 - endRead - 1)).trim();\r\n\r\n            var word = nameData.split(/ /g);\r\n\r\n            if (word.length > 0) {\r\n              _currentObject.type = word[0];\r\n\r\n              if (word.length >= 2) {\r\n                _currentObject.name = word[1];\r\n              } else {\r\n                _currentObject.name = word[0] + this.Hierarchies.children.length;\r\n              }\r\n            } else {\r\n              _currentObject.name = nameData;\r\n              _currentObject.type = '';\r\n            }\r\n\r\n            if (_currentObject.type === 'Animation') {\r\n              _currentObject.data = this._data.substr(findNext, findEnd - findNext).trim();\r\n\r\n              var refs = this._hierarchieParse(_currentObject, findEnd + 1);\r\n\r\n              endRead = refs.end;\r\n              _currentObject.children = refs.parent.children;\r\n            } else {\r\n              var DataEnder = this._data.lastIndexOf(';', findNext > 0 ? Math.min(findNext, findEnd) : findEnd);\r\n\r\n              _currentObject.data = this._data.substr(find1, DataEnder - find1).trim();\r\n\r\n              if (findNext <= 0 || findEnd < findNext) {\r\n                endRead = findEnd + 1;\r\n              } else {\r\n                var nextStart = Math.max(DataEnder + 1, find1);\r\n\r\n                var _refs = this._hierarchieParse(_currentObject, nextStart);\r\n\r\n                endRead = _refs.end;\r\n                _currentObject.children = _refs.parent.children;\r\n              }\r\n            }\r\n\r\n            _currentObject.parent = _parent;\r\n\r\n            if (_currentObject.type != 'template') {\r\n              _parent.children.push(_currentObject);\r\n            }\r\n          } else {\r\n            endRead = find1 === -1 ? this._data.length : findEnd + 1;\r\n            break;\r\n          }\r\n        }\r\n\r\n        return {\r\n          parent: _parent,\r\n          end: endRead\r\n        };\r\n      }\r\n    }, {\r\n      key: '_mainloop',\r\n      value: function _mainloop() {\r\n        var _this2 = this;\r\n\r\n        this._mainProc();\r\n\r\n        if (this._currentObject.parent || this._currentObject.children.length > 0 || !this._currentObject.worked) {\r\n          setTimeout(function () {\r\n            _this2._mainloop();\r\n          }, 1);\r\n        } else {\r\n          setTimeout(function () {\r\n            _this2.onLoad({\r\n              models: _this2.Meshes,\r\n              animations: _this2.animations\r\n            });\r\n          }, 1);\r\n        }\r\n      }\r\n    }, {\r\n      key: '_mainProc',\r\n      value: function _mainProc() {\r\n        var breakFlag = false;\r\n\r\n        while (true) {\r\n          if (!this._currentObject.worked) {\r\n            switch (this._currentObject.type) {\r\n              case 'template':\r\n                break;\r\n\r\n              case 'AnimTicksPerSecond':\r\n                this.animTicksPerSecond = parseInt(this._currentObject.data);\r\n                break;\r\n\r\n              case 'Frame':\r\n                this._setFrame();\r\n\r\n                break;\r\n\r\n              case 'FrameTransformMatrix':\r\n                this._setFrameTransformMatrix();\r\n\r\n                break;\r\n\r\n              case 'Mesh':\r\n                this._changeRoot();\r\n\r\n                this._currentGeo = {};\r\n                this._currentGeo.name = this._currentObject.name.trim();\r\n                this._currentGeo.parentName = this._getParentName(this._currentObject).trim();\r\n                this._currentGeo.VertexSetedBoneCount = [];\r\n                this._currentGeo.GeometryData = {\r\n                  vertices: [],\r\n                  normals: [],\r\n                  uvs: [],\r\n                  skinIndices: [],\r\n                  skinWeights: [],\r\n                  indices: [],\r\n                  materialIndices: []\r\n                };\r\n                this._currentGeo.Materials = [];\r\n                this._currentGeo.normalVectors = [];\r\n                this._currentGeo.BoneInfs = [];\r\n                this._currentGeo.baseFrame = this._currentFrame;\r\n\r\n                this._makeBoneFrom_CurrentFrame();\r\n\r\n                this._readVertexDatas();\r\n\r\n                breakFlag = true;\r\n                break;\r\n\r\n              case 'MeshNormals':\r\n                this._readVertexDatas();\r\n\r\n                break;\r\n\r\n              case 'MeshTextureCoords':\r\n                this._setMeshTextureCoords();\r\n\r\n                break;\r\n\r\n              case 'VertexDuplicationIndices':\r\n                break;\r\n\r\n              case 'MeshMaterialList':\r\n                this._setMeshMaterialList();\r\n\r\n                break;\r\n\r\n              case 'Material':\r\n                this._setMaterial();\r\n\r\n                break;\r\n\r\n              case 'SkinWeights':\r\n                this._setSkinWeights();\r\n\r\n                break;\r\n\r\n              case 'AnimationSet':\r\n                this._changeRoot();\r\n\r\n                this._currentAnime = {};\r\n                this._currentAnime.name = this._currentObject.name.trim();\r\n                this._currentAnime.AnimeFrames = [];\r\n                break;\r\n\r\n              case 'Animation':\r\n                if (this._currentAnimeFrames) {\r\n                  this._currentAnime.AnimeFrames.push(this._currentAnimeFrames);\r\n                }\r\n\r\n                this._currentAnimeFrames = new XAnimationInfo();\r\n                this._currentAnimeFrames.boneName = this._currentObject.data.trim();\r\n                break;\r\n\r\n              case 'AnimationKey':\r\n                this._readAnimationKey();\r\n\r\n                breakFlag = true;\r\n                break;\r\n            }\r\n\r\n            this._currentObject.worked = true;\r\n          }\r\n\r\n          if (this._currentObject.children.length > 0) {\r\n            this._currentObject = this._currentObject.children.shift();\r\n\r\n            if (this.debug) {\r\n              console.log('processing ' + this._currentObject.name);\r\n            }\r\n\r\n            if (breakFlag) break;\r\n          } else {\r\n            if (this._currentObject.worked) {\r\n              if (this._currentObject.parent && !this._currentObject.parent.parent) {\r\n                this._changeRoot();\r\n              }\r\n            }\r\n\r\n            if (this._currentObject.parent) {\r\n              this._currentObject = this._currentObject.parent;\r\n            } else {\r\n              breakFlag = true;\r\n            }\r\n\r\n            if (breakFlag) break;\r\n          }\r\n        }\r\n\r\n        return;\r\n      }\r\n    }, {\r\n      key: '_changeRoot',\r\n      value: function _changeRoot() {\r\n        if (this._currentGeo != null && this._currentGeo.name) {\r\n          this._makeOutputGeometry();\r\n        }\r\n\r\n        this._currentGeo = {};\r\n\r\n        if (this._currentAnime != null && this._currentAnime.name) {\r\n          if (this._currentAnimeFrames) {\r\n            this._currentAnime.AnimeFrames.push(this._currentAnimeFrames);\r\n\r\n            this._currentAnimeFrames = null;\r\n          }\r\n\r\n          this._makeOutputAnimation();\r\n        }\r\n\r\n        this._currentAnime = {};\r\n      }\r\n    }, {\r\n      key: '_getParentName',\r\n      value: function _getParentName(_obj) {\r\n        if (_obj.parent) {\r\n          if (_obj.parent.name) {\r\n            return _obj.parent.name;\r\n          } else {\r\n            return this._getParentName(_obj.parent);\r\n          }\r\n        } else {\r\n          return '';\r\n        }\r\n      }\r\n    }, {\r\n      key: '_setFrame',\r\n      value: function _setFrame() {\r\n        this._nowFrameName = this._currentObject.name.trim();\r\n        this._currentFrame = {};\r\n        this._currentFrame.name = this._nowFrameName;\r\n        this._currentFrame.children = [];\r\n\r\n        if (this._currentObject.parent && this._currentObject.parent.name) {\r\n          this._currentFrame.parentName = this._currentObject.parent.name;\r\n        }\r\n\r\n        this.frameHierarchie.push(this._nowFrameName);\r\n        this.HieStack[this._nowFrameName] = this._currentFrame;\r\n      }\r\n    }, {\r\n      key: '_setFrameTransformMatrix',\r\n      value: function _setFrameTransformMatrix() {\r\n        this._currentFrame.FrameTransformMatrix = new Matrix4();\r\n\r\n        var data = this._currentObject.data.split(',');\r\n\r\n        this._ParseMatrixData(this._currentFrame.FrameTransformMatrix, data);\r\n\r\n        this._makeBoneFrom_CurrentFrame();\r\n      }\r\n    }, {\r\n      key: '_makeBoneFrom_CurrentFrame',\r\n      value: function _makeBoneFrom_CurrentFrame() {\r\n        if (!this._currentFrame.FrameTransformMatrix) {\r\n          return;\r\n        }\r\n\r\n        var b = new Bone();\r\n        b.name = this._currentFrame.name;\r\n        b.applyMatrix4(this._currentFrame.FrameTransformMatrix);\r\n        b.matrixWorld = b.matrix;\r\n        b.FrameTransformMatrix = this._currentFrame.FrameTransformMatrix;\r\n        this._currentFrame.putBone = b;\r\n\r\n        if (this._currentFrame.parentName) {\r\n          for (let frame in this.HieStack) {\r\n            if (this.HieStack[frame].name === this._currentFrame.parentName) {\r\n              this.HieStack[frame].putBone.add(this._currentFrame.putBone);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }, {\r\n      key: '_readVertexDatas',\r\n      value: function _readVertexDatas() {\r\n        var endRead = 0;\r\n        var mode = 0;\r\n        var mode_local = 0;\r\n        var maxLength = 0;\r\n\r\n        while (true) {\r\n          var changeMode = false;\r\n\r\n          if (mode_local === 0) {\r\n            var refO = this._readInt1(endRead);\r\n\r\n            endRead = refO.endRead;\r\n            mode_local = 1;\r\n            maxLength = this._currentObject.data.indexOf(';;', endRead) + 1;\r\n\r\n            if (maxLength <= 0) {\r\n              maxLength = this._currentObject.data.length;\r\n            }\r\n          } else {\r\n            var find = 0;\r\n\r\n            switch (mode) {\r\n              case 0:\r\n                find = this._currentObject.data.indexOf(',', endRead) + 1;\r\n                break;\r\n\r\n              case 1:\r\n                find = this._currentObject.data.indexOf(';,', endRead) + 1;\r\n                break;\r\n            }\r\n\r\n            if (find === 0 || find > maxLength) {\r\n              find = maxLength;\r\n              mode_local = 0;\r\n              changeMode = true;\r\n            }\r\n\r\n            switch (this._currentObject.type) {\r\n              case 'Mesh':\r\n                switch (mode) {\r\n                  case 0:\r\n                    this._readVertex1(this._currentObject.data.substr(endRead, find - endRead));\r\n\r\n                    break;\r\n\r\n                  case 1:\r\n                    this._readFace1(this._currentObject.data.substr(endRead, find - endRead));\r\n\r\n                    break;\r\n                }\r\n\r\n                break;\r\n\r\n              case 'MeshNormals':\r\n                switch (mode) {\r\n                  case 0:\r\n                    this._readNormalVector1(this._currentObject.data.substr(endRead, find - endRead));\r\n\r\n                    break;\r\n                }\r\n\r\n                break;\r\n            }\r\n\r\n            endRead = find + 1;\r\n\r\n            if (changeMode) {\r\n              mode++;\r\n            }\r\n          }\r\n\r\n          if (endRead >= this._currentObject.data.length) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }, {\r\n      key: '_readInt1',\r\n      value: function _readInt1(start) {\r\n        var find = this._currentObject.data.indexOf(';', start);\r\n\r\n        return {\r\n          refI: parseInt(this._currentObject.data.substr(start, find - start)),\r\n          endRead: find + 1\r\n        };\r\n      }\r\n    }, {\r\n      key: '_readVertex1',\r\n      value: function _readVertex1(line) {\r\n        var data = this._readLine(line.trim()).substr(0, line.length - 2).split(';');\r\n\r\n        this._currentGeo.GeometryData.vertices.push(parseFloat(data[0]), parseFloat(data[1]), parseFloat(data[2]));\r\n\r\n        this._currentGeo.GeometryData.skinIndices.push(0, 0, 0, 0);\r\n\r\n        this._currentGeo.GeometryData.skinWeights.push(1, 0, 0, 0);\r\n\r\n        this._currentGeo.VertexSetedBoneCount.push(0);\r\n      }\r\n    }, {\r\n      key: '_readFace1',\r\n      value: function _readFace1(line) {\r\n        var data = this._readLine(line.trim()).substr(2, line.length - 4).split(',');\r\n\r\n        this._currentGeo.GeometryData.indices.push(parseInt(data[0], 10), parseInt(data[1], 10), parseInt(data[2], 10));\r\n      }\r\n    }, {\r\n      key: '_readNormalVector1',\r\n      value: function _readNormalVector1(line) {\r\n        var data = this._readLine(line.trim()).substr(0, line.length - 2).split(';');\r\n\r\n        this._currentGeo.GeometryData.normals.push(parseFloat(data[0]), parseFloat(data[1]), parseFloat(data[2]));\r\n      }\r\n    }, {\r\n      key: '_buildGeometry',\r\n      value: function _buildGeometry() {\r\n        var bufferGeometry = new BufferGeometry();\r\n        var position = [];\r\n        var normals = [];\r\n        var uvs = [];\r\n        var skinIndices = [];\r\n        var skinWeights = []; //\r\n\r\n        var data = this._currentGeo.GeometryData;\r\n\r\n        for (let i = 0, l = data.indices.length; i < l; i++) {\r\n          var stride2 = data.indices[i] * 2;\r\n          var stride3 = data.indices[i] * 3;\r\n          var stride4 = data.indices[i] * 4;\r\n          position.push(data.vertices[stride3], data.vertices[stride3 + 1], data.vertices[stride3 + 2]);\r\n          normals.push(data.normals[stride3], data.normals[stride3 + 1], data.normals[stride3 + 2]);\r\n          skinIndices.push(data.skinIndices[stride4], data.skinIndices[stride4 + 1], data.skinIndices[stride4 + 2], data.skinIndices[stride4 + 3]);\r\n          skinWeights.push(data.skinWeights[stride4], data.skinWeights[stride4 + 1], data.skinWeights[stride4 + 2], data.skinWeights[stride4 + 3]);\r\n          uvs.push(data.uvs[stride2], data.uvs[stride2 + 1]);\r\n        } //\r\n\r\n\r\n        bufferGeometry.setAttribute('position', new Float32BufferAttribute(position, 3));\r\n        bufferGeometry.setAttribute('normal', new Float32BufferAttribute(normals, 3));\r\n        bufferGeometry.setAttribute('uv', new Float32BufferAttribute(uvs, 2));\r\n        bufferGeometry.setAttribute('skinIndex', new Uint16BufferAttribute(skinIndices, 4));\r\n        bufferGeometry.setAttribute('skinWeight', new Float32BufferAttribute(skinWeights, 4));\r\n\r\n        this._computeGroups(bufferGeometry, data.materialIndices);\r\n\r\n        return bufferGeometry;\r\n      }\r\n    }, {\r\n      key: '_computeGroups',\r\n      value: function _computeGroups(bufferGeometry, materialIndices) {\r\n        var group;\r\n        var groups = [];\r\n        var materialIndex = undefined;\r\n\r\n        for (let i = 0; i < materialIndices.length; i++) {\r\n          var currentMaterialIndex = materialIndices[i];\r\n\r\n          if (currentMaterialIndex !== materialIndex) {\r\n            materialIndex = currentMaterialIndex;\r\n\r\n            if (group !== undefined) {\r\n              group.count = i * 3 - group.start;\r\n              groups.push(group);\r\n            }\r\n\r\n            group = {\r\n              start: i * 3,\r\n              materialIndex: materialIndex\r\n            };\r\n          }\r\n        }\r\n\r\n        if (group !== undefined) {\r\n          group.count = i * 3 - group.start;\r\n          groups.push(group);\r\n        }\r\n\r\n        bufferGeometry.groups = groups;\r\n      }\r\n    }, {\r\n      key: '_setMeshTextureCoords',\r\n      value: function _setMeshTextureCoords() {\r\n        var endRead = 0;\r\n        var mode = 0;\r\n        var mode_local = 0;\r\n\r\n        while (true) {\r\n          switch (mode) {\r\n            case 0:\r\n              if (mode_local === 0) {\r\n                var refO = this._readInt1(0);\r\n\r\n                endRead = refO.endRead;\r\n                mode_local = 1;\r\n              } else {\r\n                var find = this._currentObject.data.indexOf(',', endRead) + 1;\r\n\r\n                if (find === 0) {\r\n                  find = this._currentObject.data.length;\r\n                  mode = 2;\r\n                  mode_local = 0;\r\n                }\r\n\r\n                var line = this._currentObject.data.substr(endRead, find - endRead);\r\n\r\n                var data = this._readLine(line.trim()).split(';');\r\n\r\n                if (this.IsUvYReverse) {\r\n                  this._currentGeo.GeometryData.uvs.push(parseFloat(data[0]), 1 - parseFloat(data[1]));\r\n                } else {\r\n                  this._currentGeo.GeometryData.uvs.push(parseFloat(data[0]), parseFloat(data[1]));\r\n                }\r\n\r\n                endRead = find + 1;\r\n              }\r\n\r\n              break;\r\n          }\r\n\r\n          if (endRead >= this._currentObject.data.length) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }, {\r\n      key: '_setMeshMaterialList',\r\n      value: function _setMeshMaterialList() {\r\n        var endRead = 0;\r\n        var mode = 0;\r\n        var mode_local = 0;\r\n\r\n        while (true) {\r\n          if (mode_local < 2) {\r\n            var refO = this._readInt1(endRead);\r\n\r\n            endRead = refO.endRead;\r\n            mode_local++;\r\n          } else {\r\n            var find = this._currentObject.data.indexOf(';', endRead);\r\n\r\n            if (find === -1) {\r\n              find = this._currentObject.data.length;\r\n              mode = 3;\r\n              mode_local = 0;\r\n            }\r\n\r\n            var line = this._currentObject.data.substr(endRead, find - endRead);\r\n\r\n            var data = this._readLine(line.trim()).split(',');\r\n\r\n            for (let i = 0; i < data.length; i++) {\r\n              this._currentGeo.GeometryData.materialIndices[i] = parseInt(data[i]);\r\n            }\r\n\r\n            endRead = this._currentObject.data.length;\r\n          }\r\n\r\n          if (endRead >= this._currentObject.data.length || mode >= 3) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }, {\r\n      key: '_setMaterial',\r\n      value: function _setMaterial() {\r\n        var _nowMat = new MeshPhongMaterial({\r\n          color: Math.random() * 0xffffff\r\n        });\r\n\r\n        _nowMat.side = FrontSide;\r\n        _nowMat.name = this._currentObject.name;\r\n        var endRead = 0;\r\n\r\n        var find = this._currentObject.data.indexOf(';;', endRead);\r\n\r\n        var line = this._currentObject.data.substr(endRead, find - endRead);\r\n\r\n        var data = this._readLine(line.trim()).split(';');\r\n\r\n        _nowMat.color.r = parseFloat(data[0]);\r\n        _nowMat.color.g = parseFloat(data[1]);\r\n        _nowMat.color.b = parseFloat(data[2]);\r\n        endRead = find + 2;\r\n        find = this._currentObject.data.indexOf(';', endRead);\r\n        line = this._currentObject.data.substr(endRead, find - endRead);\r\n        _nowMat.shininess = parseFloat(this._readLine(line));\r\n        endRead = find + 1;\r\n        find = this._currentObject.data.indexOf(';;', endRead);\r\n        line = this._currentObject.data.substr(endRead, find - endRead);\r\n\r\n        var data2 = this._readLine(line.trim()).split(';');\r\n\r\n        _nowMat.specular.r = parseFloat(data2[0]);\r\n        _nowMat.specular.g = parseFloat(data2[1]);\r\n        _nowMat.specular.b = parseFloat(data2[2]);\r\n        endRead = find + 2;\r\n        find = this._currentObject.data.indexOf(';;', endRead);\r\n\r\n        if (find === -1) {\r\n          find = this._currentObject.data.length;\r\n        }\r\n\r\n        line = this._currentObject.data.substr(endRead, find - endRead);\r\n\r\n        var data3 = this._readLine(line.trim()).split(';');\r\n\r\n        _nowMat.emissive.r = parseFloat(data3[0]);\r\n        _nowMat.emissive.g = parseFloat(data3[1]);\r\n        _nowMat.emissive.b = parseFloat(data3[2]);\r\n        var localObject = null;\r\n\r\n        while (true) {\r\n          if (this._currentObject.children.length > 0) {\r\n            localObject = this._currentObject.children.shift();\r\n\r\n            if (this.debug) {\r\n              console.log('processing ' + localObject.name);\r\n            }\r\n\r\n            var fileName = localObject.data.substr(1, localObject.data.length - 2);\r\n\r\n            switch (localObject.type) {\r\n              case 'TextureFilename':\r\n                _nowMat.map = this.texloader.load(fileName);\r\n                break;\r\n\r\n              case 'BumpMapFilename':\r\n                _nowMat.bumpMap = this.texloader.load(fileName);\r\n                _nowMat.bumpScale = 0.05;\r\n                break;\r\n\r\n              case 'NormalMapFilename':\r\n                _nowMat.normalMap = this.texloader.load(fileName);\r\n                _nowMat.normalScale = new Vector2(2, 2);\r\n                break;\r\n\r\n              case 'EmissiveMapFilename':\r\n                _nowMat.emissiveMap = this.texloader.load(fileName);\r\n                break;\r\n\r\n              case 'LightMapFilename':\r\n                _nowMat.lightMap = this.texloader.load(fileName);\r\n                break;\r\n            }\r\n          } else {\r\n            break;\r\n          }\r\n        }\r\n\r\n        this._currentGeo.Materials.push(_nowMat);\r\n      }\r\n    }, {\r\n      key: '_setSkinWeights',\r\n      value: function _setSkinWeights() {\r\n        var boneInf = new XboneInf();\r\n        var endRead = 0;\r\n\r\n        var find = this._currentObject.data.indexOf(';', endRead);\r\n\r\n        var line = this._currentObject.data.substr(endRead, find - endRead);\r\n\r\n        endRead = find + 1;\r\n        boneInf.boneName = line.substr(1, line.length - 2);\r\n        boneInf.BoneIndex = this._currentGeo.BoneInfs.length;\r\n        find = this._currentObject.data.indexOf(';', endRead);\r\n        endRead = find + 1;\r\n        find = this._currentObject.data.indexOf(';', endRead);\r\n        line = this._currentObject.data.substr(endRead, find - endRead);\r\n\r\n        var data = this._readLine(line.trim()).split(',');\r\n\r\n        for (let i = 0; i < data.length; i++) {\r\n          boneInf.Indeces.push(parseInt(data[i]));\r\n        }\r\n\r\n        endRead = find + 1;\r\n        find = this._currentObject.data.indexOf(';', endRead);\r\n        line = this._currentObject.data.substr(endRead, find - endRead);\r\n\r\n        var data2 = this._readLine(line.trim()).split(',');\r\n\r\n        for (let _i = 0; _i < data2.length; _i++) {\r\n          boneInf.Weights.push(parseFloat(data2[_i]));\r\n        }\r\n\r\n        endRead = find + 1;\r\n        find = this._currentObject.data.indexOf(';', endRead);\r\n\r\n        if (find <= 0) {\r\n          find = this._currentObject.data.length;\r\n        }\r\n\r\n        line = this._currentObject.data.substr(endRead, find - endRead);\r\n\r\n        var data3 = this._readLine(line.trim()).split(',');\r\n\r\n        boneInf.OffsetMatrix = new Matrix4();\r\n\r\n        this._ParseMatrixData(boneInf.OffsetMatrix, data3);\r\n\r\n        this._currentGeo.BoneInfs.push(boneInf);\r\n      }\r\n    }, {\r\n      key: '_makePutBoneList',\r\n      value: function _makePutBoneList(_RootName, _bones) {\r\n        var putting = false;\r\n\r\n        for (let frame in this.HieStack) {\r\n          if (this.HieStack[frame].name === _RootName || putting) {\r\n            putting = true;\r\n            var b = new Bone();\r\n            b.name = this.HieStack[frame].name;\r\n            b.applyMatrix4(this.HieStack[frame].FrameTransformMatrix);\r\n            b.matrixWorld = b.matrix;\r\n            b.FrameTransformMatrix = this.HieStack[frame].FrameTransformMatrix;\r\n            b.pos = new Vector3().setFromMatrixPosition(b.FrameTransformMatrix).toArray();\r\n            b.rotq = new Quaternion().setFromRotationMatrix(b.FrameTransformMatrix).toArray();\r\n            b.scl = new Vector3().setFromMatrixScale(b.FrameTransformMatrix).toArray();\r\n\r\n            if (this.HieStack[frame].parentName && this.HieStack[frame].parentName.length > 0) {\r\n              for (let i = 0; i < _bones.length; i++) {\r\n                if (this.HieStack[frame].parentName === _bones[i].name) {\r\n                  _bones[i].add(b);\r\n\r\n                  b.parent = i;\r\n                  break;\r\n                }\r\n              }\r\n            }\r\n\r\n            _bones.push(b);\r\n          }\r\n        }\r\n      }\r\n    }, {\r\n      key: '_makeOutputGeometry',\r\n      value: function _makeOutputGeometry() {\r\n        var mesh = null;\r\n\r\n        if (this._currentGeo.BoneInfs.length > 0) {\r\n          var putBones = [];\r\n\r\n          this._makePutBoneList(this._currentGeo.baseFrame.parentName, putBones);\r\n\r\n          for (let bi = 0; bi < this._currentGeo.BoneInfs.length; bi++) {\r\n            var boneIndex = 0;\r\n\r\n            for (let bb = 0; bb < putBones.length; bb++) {\r\n              if (putBones[bb].name === this._currentGeo.BoneInfs[bi].boneName) {\r\n                boneIndex = bb;\r\n                putBones[bb].OffsetMatrix = new Matrix4();\r\n                putBones[bb].OffsetMatrix.copy(this._currentGeo.BoneInfs[bi].OffsetMatrix);\r\n                break;\r\n              }\r\n            }\r\n\r\n            for (let vi = 0; vi < this._currentGeo.BoneInfs[bi].Indeces.length; vi++) {\r\n              var nowVertexID = this._currentGeo.BoneInfs[bi].Indeces[vi];\r\n              var nowVal = this._currentGeo.BoneInfs[bi].Weights[vi];\r\n              var stride = nowVertexID * 4;\r\n\r\n              switch (this._currentGeo.VertexSetedBoneCount[nowVertexID]) {\r\n                case 0:\r\n                  this._currentGeo.GeometryData.skinIndices[stride] = boneIndex;\r\n                  this._currentGeo.GeometryData.skinWeights[stride] = nowVal;\r\n                  break;\r\n\r\n                case 1:\r\n                  this._currentGeo.GeometryData.skinIndices[stride + 1] = boneIndex;\r\n                  this._currentGeo.GeometryData.skinWeights[stride + 1] = nowVal;\r\n                  break;\r\n\r\n                case 2:\r\n                  this._currentGeo.GeometryData.skinIndices[stride + 2] = boneIndex;\r\n                  this._currentGeo.GeometryData.skinWeights[stride + 2] = nowVal;\r\n                  break;\r\n\r\n                case 3:\r\n                  this._currentGeo.GeometryData.skinIndices[stride + 3] = boneIndex;\r\n                  this._currentGeo.GeometryData.skinWeights[stride + 3] = nowVal;\r\n                  break;\r\n              }\r\n\r\n              this._currentGeo.VertexSetedBoneCount[nowVertexID]++;\r\n\r\n              if (this._currentGeo.VertexSetedBoneCount[nowVertexID] > 4) {\r\n                console.log('warn! over 4 bone weight! :' + nowVertexID);\r\n              }\r\n            }\r\n          }\r\n\r\n          for (let sk = 0; sk < this._currentGeo.Materials.length; sk++) {\r\n            this._currentGeo.Materials[sk].skinning = true;\r\n          }\r\n\r\n          var offsetList = [];\r\n\r\n          for (let _bi = 0; _bi < putBones.length; _bi++) {\r\n            if (putBones[_bi].OffsetMatrix) {\r\n              offsetList.push(putBones[_bi].OffsetMatrix);\r\n            } else {\r\n              offsetList.push(new Matrix4());\r\n            }\r\n          }\r\n\r\n          var bufferGeometry = this._buildGeometry();\r\n\r\n          mesh = new SkinnedMesh(bufferGeometry, this._currentGeo.Materials.length === 1 ? this._currentGeo.Materials[0] : this._currentGeo.Materials);\r\n\r\n          this._initSkeleton(mesh, putBones, offsetList);\r\n        } else {\r\n          var _bufferGeometry = this._buildGeometry();\r\n\r\n          mesh = new Mesh(_bufferGeometry, this._currentGeo.Materials.length === 1 ? this._currentGeo.Materials[0] : this._currentGeo.Materials);\r\n        }\r\n\r\n        mesh.name = this._currentGeo.name;\r\n        var worldBaseMx = new Matrix4();\r\n        var currentMxFrame = this._currentGeo.baseFrame.putBone;\r\n\r\n        if (currentMxFrame && currentMxFrame.parent) {\r\n          while (true) {\r\n            currentMxFrame = currentMxFrame.parent;\r\n\r\n            if (currentMxFrame) {\r\n              worldBaseMx.multiply(currentMxFrame.FrameTransformMatrix);\r\n            } else {\r\n              break;\r\n            }\r\n          }\r\n\r\n          mesh.applyMatrix4(worldBaseMx);\r\n        }\r\n\r\n        this.Meshes.push(mesh);\r\n      }\r\n    }, {\r\n      key: '_initSkeleton',\r\n      value: function _initSkeleton(mesh, boneList, boneInverses) {\r\n        var bones = [],\r\n            bone,\r\n            gbone;\r\n        var i, il;\r\n\r\n        for (i = 0, il = boneList.length; i < il; i++) {\r\n          gbone = boneList[i];\r\n          bone = new Bone();\r\n          bones.push(bone);\r\n          bone.name = gbone.name;\r\n          bone.position.fromArray(gbone.pos);\r\n          bone.quaternion.fromArray(gbone.rotq);\r\n          if (gbone.scl !== undefined) bone.scale.fromArray(gbone.scl);\r\n        }\r\n\r\n        for (i = 0, il = boneList.length; i < il; i++) {\r\n          gbone = boneList[i];\r\n\r\n          if (gbone.parent !== -1 && gbone.parent !== null && bones[gbone.parent] !== undefined) {\r\n            bones[gbone.parent].add(bones[i]);\r\n          } else {\r\n            mesh.add(bones[i]);\r\n          }\r\n        }\r\n\r\n        mesh.updateMatrixWorld(true);\r\n        var skeleton = new Skeleton(bones, boneInverses);\r\n        mesh.bind(skeleton, mesh.matrixWorld);\r\n      }\r\n    }, {\r\n      key: '_readAnimationKey',\r\n      value: function _readAnimationKey() {\r\n        var endRead = 0;\r\n\r\n        var find = this._currentObject.data.indexOf(';', endRead);\r\n\r\n        var line = this._currentObject.data.substr(endRead, find - endRead);\r\n\r\n        endRead = find + 1;\r\n        var nowKeyType = parseInt(this._readLine(line));\r\n        find = this._currentObject.data.indexOf(';', endRead);\r\n        endRead = find + 1;\r\n        line = this._currentObject.data.substr(endRead);\r\n\r\n        var data = this._readLine(line.trim()).split(';;,');\r\n\r\n        for (let i = 0; i < data.length; i++) {\r\n          var data2 = data[i].split(';');\r\n          var keyInfo = new XKeyFrameInfo();\r\n          keyInfo.type = nowKeyType;\r\n          keyInfo.Frame = parseInt(data2[0]);\r\n          keyInfo.index = this._currentAnimeFrames.keyFrames.length;\r\n          keyInfo.time = keyInfo.Frame;\r\n\r\n          if (nowKeyType != 4) {\r\n            var frameFound = false;\r\n\r\n            for (let mm = 0; mm < this._currentAnimeFrames.keyFrames.length; mm++) {\r\n              if (this._currentAnimeFrames.keyFrames[mm].Frame === keyInfo.Frame) {\r\n                keyInfo = this._currentAnimeFrames.keyFrames[mm];\r\n                frameFound = true;\r\n                break;\r\n              }\r\n            }\r\n\r\n            var frameValue = data2[2].split(',');\r\n\r\n            switch (nowKeyType) {\r\n              case 0:\r\n                keyInfo.rot = new Quaternion(parseFloat(frameValue[1]), parseFloat(frameValue[2]), parseFloat(frameValue[3]), parseFloat(frameValue[0]) * -1);\r\n                break;\r\n\r\n              case 1:\r\n                keyInfo.scl = new Vector3(parseFloat(frameValue[0]), parseFloat(frameValue[1]), parseFloat(frameValue[2]));\r\n                break;\r\n\r\n              case 2:\r\n                keyInfo.pos = new Vector3(parseFloat(frameValue[0]), parseFloat(frameValue[1]), parseFloat(frameValue[2]));\r\n                break;\r\n            }\r\n\r\n            if (!frameFound) {\r\n              this._currentAnimeFrames.keyFrames.push(keyInfo);\r\n            }\r\n          } else {\r\n            keyInfo.matrix = new Matrix4();\r\n\r\n            this._ParseMatrixData(keyInfo.matrix, data2[2].split(','));\r\n\r\n            this._currentAnimeFrames.keyFrames.push(keyInfo);\r\n          }\r\n        }\r\n      }\r\n    }, {\r\n      key: '_makeOutputAnimation',\r\n      value: function _makeOutputAnimation() {\r\n        var animationObj = new XAnimationObj(this.options);\r\n        animationObj.fps = this.animTicksPerSecond;\r\n        animationObj.name = this._currentAnime.name;\r\n        animationObj.make(this._currentAnime.AnimeFrames);\r\n        this.animations.push(animationObj);\r\n      }\r\n    }, {\r\n      key: 'assignAnimation',\r\n      value: function assignAnimation(_model, _animation) {\r\n        var model = _model;\r\n        var animation = _animation;\r\n\r\n        if (!model) {\r\n          model = this.Meshes[0];\r\n        }\r\n\r\n        if (!animation) {\r\n          animation = this.animations[0];\r\n        }\r\n\r\n        if (!model || !animation) {\r\n          return null;\r\n        }\r\n\r\n        var put = {};\r\n        put.fps = animation.fps;\r\n        put.name = animation.name;\r\n        put.length = animation.length;\r\n        put.hierarchy = [];\r\n\r\n        for (let b = 0; b < model.skeleton.bones.length; b++) {\r\n          var findAnimation = false;\r\n\r\n          for (let i = 0; i < animation.hierarchy.length; i++) {\r\n            if (model.skeleton.bones[b].name === animation.hierarchy[i].name) {\r\n              findAnimation = true;\r\n              var c_key = animation.hierarchy[i].copy();\r\n              c_key.parent = -1;\r\n\r\n              if (model.skeleton.bones[b].parent && model.skeleton.bones[b].parent.type === 'Bone') {\r\n                for (let bb = 0; bb < put.hierarchy.length; bb++) {\r\n                  if (put.hierarchy[bb].name === model.skeleton.bones[b].parent.name) {\r\n                    c_key.parent = bb;\r\n                    c_key.parentName = model.skeleton.bones[b].parent.name;\r\n                  }\r\n                }\r\n              }\r\n\r\n              put.hierarchy.push(c_key);\r\n              break;\r\n            }\r\n          }\r\n\r\n          if (!findAnimation) {\r\n            var _c_key = animation.hierarchy[0].copy();\r\n\r\n            _c_key.name = model.skeleton.bones[b].name;\r\n            _c_key.parent = -1;\r\n\r\n            for (let k = 0; k < _c_key.keys.length; k++) {\r\n              if (_c_key.keys[k].pos) {\r\n                _c_key.keys[k].pos.set(0, 0, 0);\r\n              }\r\n\r\n              if (_c_key.keys[k].scl) {\r\n                _c_key.keys[k].scl.set(1, 1, 1);\r\n              }\r\n\r\n              if (_c_key.keys[k].rot) {\r\n                _c_key.keys[k].rot.set(0, 0, 0, 1);\r\n              }\r\n            }\r\n\r\n            put.hierarchy.push(_c_key);\r\n          }\r\n        }\r\n\r\n        if (!model.geometry.animations) {\r\n          model.geometry.animations = [];\r\n        }\r\n\r\n        model.geometry.animations.push(AnimationClip.parseAnimation(put, model.skeleton.bones));\r\n\r\n        if (!model.animationMixer) {\r\n          model.animationMixer = new AnimationMixer(model);\r\n        }\r\n\r\n        return put;\r\n      }\r\n    }, {\r\n      key: '_ParseMatrixData',\r\n      value: function _ParseMatrixData(targetMatrix, data) {\r\n        targetMatrix.set(parseFloat(data[0]), parseFloat(data[4]), parseFloat(data[8]), parseFloat(data[12]), parseFloat(data[1]), parseFloat(data[5]), parseFloat(data[9]), parseFloat(data[13]), parseFloat(data[2]), parseFloat(data[6]), parseFloat(data[10]), parseFloat(data[14]), parseFloat(data[3]), parseFloat(data[7]), parseFloat(data[11]), parseFloat(data[15]));\r\n      }\r\n    }]);\r\n    return XLoader;\r\n  }();\r\n\r\n  return XLoader;\r\n}();\r\n\r\nexport { XLoader };\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}