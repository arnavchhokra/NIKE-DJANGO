{"ast":null,"code":"import { Color, DepthTexture, UnsignedShortType, NearestFilter, WebGLRenderTarget, LinearFilter, RGBAFormat, HalfFloatType, ShaderMaterial, UniformsUtils, NoBlending, MeshNormalMaterial, MeshBasicMaterial, SrcAlphaFactor, OneMinusSrcAlphaFactor, AddEquation, NormalBlending } from 'three';\nimport { FullScreenQuad, Pass } from './Pass.js';\nimport { SSRShader, SSRBlurShader, SSRDepthShader } from '../shaders/SSRShader.js';\nimport { CopyShader } from '../shaders/CopyShader.js';\n\nvar SSRPass = function SSRPass(_ref) {\n  var renderer = _ref.renderer,\n      scene = _ref.scene,\n      camera = _ref.camera,\n      width = _ref.width,\n      height = _ref.height,\n      selects = _ref.selects,\n      encoding = _ref.encoding,\n      _ref$isPerspectiveCam = _ref.isPerspectiveCamera,\n      isPerspectiveCamera = _ref$isPerspectiveCam === void 0 ? true : _ref$isPerspectiveCam,\n      _ref$isBouncing = _ref.isBouncing,\n      isBouncing = _ref$isBouncing === void 0 ? false : _ref$isBouncing,\n      _ref$morphTargets = _ref.morphTargets,\n      morphTargets = _ref$morphTargets === void 0 ? false : _ref$morphTargets,\n      groundReflector = _ref.groundReflector;\n  this.width = width !== undefined ? width : 512;\n  this.height = height !== undefined ? height : 512;\n  this.clear = true;\n  this.renderer = renderer;\n  this.scene = scene;\n  this.camera = camera;\n  this.groundReflector = groundReflector;\n  this.opacity = SSRShader.uniforms.opacity.value;\n  this.output = 0;\n  this.maxDistance = SSRShader.uniforms.maxDistance.value;\n  this.surfDist = SSRShader.uniforms.surfDist.value;\n  this.encoding = encoding;\n  this.tempColor = new Color();\n  this._selects = selects;\n  this.isSelective = Array.isArray(this._selects);\n  Object.defineProperty(this, 'selects', {\n    get: function get() {\n      return this._selects;\n    },\n    set: function set(val) {\n      if (this._selects === val) return;\n      this._selects = val;\n\n      if (Array.isArray(val)) {\n        this.isSelective = true;\n        this.ssrMaterial.defines.isSelective = true;\n        this.ssrMaterial.needsUpdate = true;\n      } else {\n        this.isSelective = false;\n        this.ssrMaterial.defines.isSelective = false;\n        this.ssrMaterial.needsUpdate = true;\n      }\n    }\n  });\n  this._isBouncing = isBouncing; ///todo: don't need defineProperty\n\n  Object.defineProperty(this, 'isBouncing', {\n    get: function get() {\n      return this._isBouncing;\n    },\n    set: function set(val) {\n      if (this._isBouncing === val) return;\n      this._isBouncing = val;\n\n      if (val) {\n        this.ssrMaterial.uniforms['tDiffuse'].value = this.prevRenderTarget.texture;\n      } else {\n        this.ssrMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n      }\n    }\n  });\n  this.isBlur = true;\n  this._isDistanceAttenuation = SSRShader.defines.isDistanceAttenuation;\n  Object.defineProperty(this, 'isDistanceAttenuation', {\n    get: function get() {\n      return this._isDistanceAttenuation;\n    },\n    set: function set(val) {\n      if (this._isDistanceAttenuation === val) return;\n      this._isDistanceAttenuation = val;\n      this.ssrMaterial.defines.isDistanceAttenuation = val;\n      this.ssrMaterial.needsUpdate = true;\n    }\n  });\n  this._isFresnel = SSRShader.defines.isFresnel;\n  Object.defineProperty(this, 'isFresnel', {\n    get: function get() {\n      return this._isFresnel;\n    },\n    set: function set(val) {\n      if (this._isFresnel === val) return;\n      this._isFresnel = val;\n      this.ssrMaterial.defines.isFresnel = val;\n      this.ssrMaterial.needsUpdate = true;\n    }\n  });\n  this._isInfiniteThick = SSRShader.defines.isInfiniteThick;\n  Object.defineProperty(this, 'isInfiniteThick', {\n    get: function get() {\n      return this._isInfiniteThick;\n    },\n    set: function set(val) {\n      if (this._isInfiniteThick === val) return;\n      this._isInfiniteThick = val;\n      this.ssrMaterial.defines.isInfiniteThick = val;\n      this.ssrMaterial.needsUpdate = true;\n    }\n  });\n  this.thickTolerance = SSRShader.uniforms.thickTolerance.value; // beauty render target with depth buffer\n\n  var depthTexture = new DepthTexture();\n  depthTexture.type = UnsignedShortType;\n  depthTexture.minFilter = NearestFilter;\n  depthTexture.maxFilter = NearestFilter;\n  this.beautyRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: LinearFilter,\n    magFilter: LinearFilter,\n    format: RGBAFormat,\n    depthTexture: depthTexture,\n    depthBuffer: true\n  }); //for bouncing\n\n  this.prevRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: LinearFilter,\n    magFilter: LinearFilter,\n    format: RGBAFormat\n  }); // normal render target\n\n  this.normalRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: NearestFilter,\n    magFilter: NearestFilter,\n    format: RGBAFormat,\n    type: HalfFloatType\n  }); // metalness render target\n  // if (this.isSelective) {\n\n  this.metalnessRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: NearestFilter,\n    magFilter: NearestFilter,\n    format: RGBAFormat\n  }); // }\n  // ssr render target\n\n  this.ssrRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: LinearFilter,\n    magFilter: LinearFilter,\n    format: RGBAFormat\n  });\n  this.blurRenderTarget = this.ssrRenderTarget.clone();\n  this.blurRenderTarget2 = this.ssrRenderTarget.clone(); // this.blurRenderTarget3 = this.ssrRenderTarget.clone();\n  // ssr material\n\n  if (SSRShader === undefined) {\n    console.error('THREE.SSRPass: The pass relies on SSRShader.');\n  }\n\n  this.ssrMaterial = new ShaderMaterial({\n    defines: Object.assign({\n      MAX_STEP: Math.sqrt(window.innerWidth * window.innerWidth + window.innerHeight * window.innerHeight)\n    }, SSRShader.defines),\n    uniforms: UniformsUtils.clone(SSRShader.uniforms),\n    vertexShader: SSRShader.vertexShader,\n    fragmentShader: SSRShader.fragmentShader,\n    blending: NoBlending\n  });\n\n  if (!isPerspectiveCamera) {\n    this.ssrMaterial.defines.isPerspectiveCamera = isPerspectiveCamera;\n    this.ssrMaterial.needsUpdate = true;\n  }\n\n  this.ssrMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n  this.ssrMaterial.uniforms['tNormal'].value = this.normalRenderTarget.texture; // if (this.isSelective) {\n\n  this.ssrMaterial.defines.isSelective = this.isSelective;\n  this.ssrMaterial.needsUpdate = true;\n  this.ssrMaterial.uniforms['tMetalness'].value = this.metalnessRenderTarget.texture; // }\n\n  this.ssrMaterial.uniforms['tDepth'].value = this.beautyRenderTarget.depthTexture;\n  this.ssrMaterial.uniforms['cameraNear'].value = this.camera.near;\n  this.ssrMaterial.uniforms['cameraFar'].value = this.camera.far;\n  this.ssrMaterial.uniforms['surfDist'].value = this.surfDist;\n  this.ssrMaterial.uniforms['resolution'].value.set(this.width, this.height);\n  this.ssrMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\n  this.ssrMaterial.uniforms['cameraInverseProjectionMatrix'].value.copy(this.camera.projectionMatrixInverse); // normal material\n\n  this.normalMaterial = new MeshNormalMaterial({\n    morphTargets: morphTargets\n  });\n  this.normalMaterial.blending = NoBlending; // if (this.isSelective) {\n  // metalnessOn material\n\n  this.metalnessOnMaterial = new MeshBasicMaterial({\n    color: 'white'\n  }); // metalnessOff material\n\n  this.metalnessOffMaterial = new MeshBasicMaterial({\n    color: 'black'\n  }); // }\n  // blur material\n\n  this.blurMaterial = new ShaderMaterial({\n    defines: Object.assign({}, SSRBlurShader.defines),\n    uniforms: UniformsUtils.clone(SSRBlurShader.uniforms),\n    vertexShader: SSRBlurShader.vertexShader,\n    fragmentShader: SSRBlurShader.fragmentShader\n  });\n  this.blurMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n  this.blurMaterial.uniforms['resolution'].value.set(this.width, this.height); // blur material 2\n\n  this.blurMaterial2 = new ShaderMaterial({\n    defines: Object.assign({}, SSRBlurShader.defines),\n    uniforms: UniformsUtils.clone(SSRBlurShader.uniforms),\n    vertexShader: SSRBlurShader.vertexShader,\n    fragmentShader: SSRBlurShader.fragmentShader\n  });\n  this.blurMaterial2.uniforms['tDiffuse'].value = this.blurRenderTarget.texture;\n  this.blurMaterial2.uniforms['resolution'].value.set(this.width, this.height); // // blur material 3\n  // this.blurMaterial3 = new ShaderMaterial({\n  //   defines: Object.assign({}, SSRBlurShader.defines),\n  //   uniforms: UniformsUtils.clone(SSRBlurShader.uniforms),\n  //   vertexShader: SSRBlurShader.vertexShader,\n  //   fragmentShader: SSRBlurShader.fragmentShader\n  // });\n  // this.blurMaterial3.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;\n  // this.blurMaterial3.uniforms['resolution'].value.set(this.width, this.height);\n  // material for rendering the depth\n\n  this.depthRenderMaterial = new ShaderMaterial({\n    defines: Object.assign({}, SSRDepthShader.defines),\n    uniforms: UniformsUtils.clone(SSRDepthShader.uniforms),\n    vertexShader: SSRDepthShader.vertexShader,\n    fragmentShader: SSRDepthShader.fragmentShader,\n    blending: NoBlending\n  });\n  this.depthRenderMaterial.uniforms['tDepth'].value = this.beautyRenderTarget.depthTexture;\n  this.depthRenderMaterial.uniforms['cameraNear'].value = this.camera.near;\n  this.depthRenderMaterial.uniforms['cameraFar'].value = this.camera.far; // material for rendering the content of a render target\n\n  this.copyMaterial = new ShaderMaterial({\n    uniforms: UniformsUtils.clone(CopyShader.uniforms),\n    vertexShader: CopyShader.vertexShader,\n    fragmentShader: CopyShader.fragmentShader,\n    transparent: true,\n    depthTest: false,\n    depthWrite: false,\n    blendSrc: SrcAlphaFactor,\n    blendDst: OneMinusSrcAlphaFactor,\n    blendEquation: AddEquation,\n    blendSrcAlpha: SrcAlphaFactor,\n    blendDstAlpha: OneMinusSrcAlphaFactor,\n    blendEquationAlpha: AddEquation // premultipliedAlpha:true,\n\n  });\n  this.fsQuad = new FullScreenQuad(null);\n  this.originalClearColor = new Color();\n};\n\nSSRPass.prototype = Object.assign(Object.create(Pass.prototype), {\n  constructor: SSRPass,\n  dispose: function dispose() {\n    // dispose render targets\n    this.beautyRenderTarget.dispose();\n    this.prevRenderTarget.dispose();\n    this.normalRenderTarget.dispose(); // if (this.isSelective)\n\n    this.metalnessRenderTarget.dispose();\n    this.ssrRenderTarget.dispose();\n    this.blurRenderTarget.dispose();\n    this.blurRenderTarget2.dispose(); // this.blurRenderTarget3.dispose();\n    // dispose materials\n\n    this.normalMaterial.dispose(); // if (this.isSelective) {\n\n    this.metalnessOnMaterial.dispose();\n    this.metalnessOffMaterial.dispose(); // }\n\n    this.blurMaterial.dispose();\n    this.blurMaterial2.dispose();\n    this.copyMaterial.dispose();\n    this.depthRenderMaterial.dispose(); // dipsose full screen quad\n\n    this.fsQuad.dispose();\n  },\n  render: function render(renderer, writeBuffer\n  /*, readBuffer, deltaTime, maskActive */\n  ) {\n    // render beauty and depth\n    if (this.encoding) this.beautyRenderTarget.texture.encoding = this.encoding;\n    renderer.setRenderTarget(this.beautyRenderTarget);\n    renderer.clear();\n\n    if (this.groundReflector) {\n      this.groundReflector.doRender(this.renderer, this.scene, this.camera);\n      this.groundReflector.visible = true;\n    }\n\n    renderer.render(this.scene, this.camera);\n    if (this.groundReflector) this.groundReflector.visible = false; // render normals\n\n    this.renderOverride(renderer, this.normalMaterial, this.normalRenderTarget, 0, 0); // render metalnesses\n\n    if (this.isSelective) {\n      this.renderMetalness(renderer, this.metalnessOnMaterial, this.metalnessRenderTarget, 0, 0);\n    } // render SSR\n\n\n    this.ssrMaterial.uniforms['opacity'].value = this.opacity;\n    this.ssrMaterial.uniforms['maxDistance'].value = this.maxDistance;\n    this.ssrMaterial.uniforms['surfDist'].value = this.surfDist;\n    this.ssrMaterial.uniforms['thickTolerance'].value = this.thickTolerance;\n    this.renderPass(renderer, this.ssrMaterial, this.ssrRenderTarget); // render blur\n\n    if (this.isBlur) {\n      this.renderPass(renderer, this.blurMaterial, this.blurRenderTarget);\n      this.renderPass(renderer, this.blurMaterial2, this.blurRenderTarget2); // this.renderPass(renderer, this.blurMaterial3, this.blurRenderTarget3);\n    } // output result to screen\n\n\n    switch (this.output) {\n      case SSRPass.OUTPUT.Default:\n        if (this.isBouncing) {\n          this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n          if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n          this.copyMaterial.blending = NormalBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n          this.copyMaterial.uniforms['tDiffuse'].value = this.prevRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        } else {\n          this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n          if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n          this.copyMaterial.blending = NormalBlending;\n          this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        }\n\n        break;\n\n      case SSRPass.OUTPUT.SSR:\n        if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n\n        if (this.isBouncing) {\n          if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n          this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n          this.copyMaterial.blending = NormalBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n        }\n\n        break;\n\n      case SSRPass.OUTPUT.Beauty:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSRPass.OUTPUT.Depth:\n        this.renderPass(renderer, this.depthRenderMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSRPass.OUTPUT.Normal:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.normalRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSRPass.OUTPUT.Metalness:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.metalnessRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      default:\n        console.warn('THREE.SSRPass: Unknown output type.');\n    }\n  },\n  renderPass: function renderPass(renderer, passMaterial, renderTarget, clearColor, clearAlpha) {\n    // save original state\n    this.originalClearColor.copy(renderer.getClearColor(this.tempColor));\n    var originalClearAlpha = renderer.getClearAlpha(this.tempColor);\n    var originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget); // setup pass state\n\n    renderer.autoClear = false;\n\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n\n    this.fsQuad.material = passMaterial;\n    this.fsQuad.render(renderer); // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  },\n  renderOverride: function renderOverride(renderer, overrideMaterial, renderTarget, clearColor, clearAlpha) {\n    this.originalClearColor.copy(renderer.getClearColor(this.tempColor));\n    var originalClearAlpha = renderer.getClearAlpha(this.tempColor);\n    var originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget);\n    renderer.autoClear = false;\n    clearColor = overrideMaterial.clearColor || clearColor;\n    clearAlpha = overrideMaterial.clearAlpha || clearAlpha;\n\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n\n    this.scene.overrideMaterial = overrideMaterial;\n    renderer.render(this.scene, this.camera);\n    this.scene.overrideMaterial = null; // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  },\n  renderMetalness: function renderMetalness(renderer, overrideMaterial, renderTarget, clearColor, clearAlpha) {\n    var _this = this;\n\n    this.originalClearColor.copy(renderer.getClearColor(this.tempColor));\n    var originalClearAlpha = renderer.getClearAlpha(this.tempColor);\n    var originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget);\n    renderer.autoClear = false;\n    clearColor = overrideMaterial.clearColor || clearColor;\n    clearAlpha = overrideMaterial.clearAlpha || clearAlpha;\n\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n\n    this.scene.traverseVisible(function (child) {\n      child._SSRPassMaterialBack = child.material;\n\n      if (_this._selects.includes(child)) {\n        child.material = _this.metalnessOnMaterial;\n      } else {\n        child.material = _this.metalnessOffMaterial;\n      }\n    });\n    renderer.render(this.scene, this.camera);\n    this.scene.traverseVisible(function (child) {\n      child.material = child._SSRPassMaterialBack;\n    }); // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  },\n  setSize: function setSize(width, height) {\n    this.width = width;\n    this.height = height;\n    this.ssrMaterial.defines.MAX_STEP = Math.sqrt(width * width + height * height);\n    this.ssrMaterial.needsUpdate = true;\n    this.beautyRenderTarget.setSize(width, height);\n    this.prevRenderTarget.setSize(width, height);\n    this.ssrRenderTarget.setSize(width, height);\n    this.normalRenderTarget.setSize(width, height); // if (this.isSelective)\n\n    this.metalnessRenderTarget.setSize(width, height);\n    this.blurRenderTarget.setSize(width, height);\n    this.blurRenderTarget2.setSize(width, height); // this.blurRenderTarget3.setSize(width, height);\n\n    this.ssrMaterial.uniforms['resolution'].value.set(width, height);\n    this.ssrMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\n    this.ssrMaterial.uniforms['cameraInverseProjectionMatrix'].value.copy(this.camera.projectionMatrixInverse);\n    this.blurMaterial.uniforms['resolution'].value.set(width, height);\n    this.blurMaterial2.uniforms['resolution'].value.set(width, height);\n  }\n});\nSSRPass.OUTPUT = {\n  Default: 0,\n  SSR: 1,\n  Beauty: 3,\n  Depth: 4,\n  Normal: 5,\n  Metalness: 7\n};\nexport { SSRPass };","map":{"version":3,"names":["Color","DepthTexture","UnsignedShortType","NearestFilter","WebGLRenderTarget","LinearFilter","RGBAFormat","HalfFloatType","ShaderMaterial","UniformsUtils","NoBlending","MeshNormalMaterial","MeshBasicMaterial","SrcAlphaFactor","OneMinusSrcAlphaFactor","AddEquation","NormalBlending","FullScreenQuad","Pass","SSRShader","SSRBlurShader","SSRDepthShader","CopyShader","SSRPass","renderer","scene","camera","width","height","selects","encoding","isPerspectiveCamera","isBouncing","morphTargets","groundReflector","undefined","clear","opacity","uniforms","value","output","maxDistance","surfDist","tempColor","_selects","isSelective","Array","isArray","Object","defineProperty","get","set","val","ssrMaterial","defines","needsUpdate","_isBouncing","prevRenderTarget","texture","beautyRenderTarget","isBlur","_isDistanceAttenuation","isDistanceAttenuation","_isFresnel","isFresnel","_isInfiniteThick","isInfiniteThick","thickTolerance","depthTexture","type","minFilter","maxFilter","magFilter","format","depthBuffer","normalRenderTarget","metalnessRenderTarget","ssrRenderTarget","blurRenderTarget","clone","blurRenderTarget2","console","error","assign","MAX_STEP","Math","sqrt","window","innerWidth","innerHeight","vertexShader","fragmentShader","blending","near","far","copy","projectionMatrix","projectionMatrixInverse","normalMaterial","metalnessOnMaterial","color","metalnessOffMaterial","blurMaterial","blurMaterial2","depthRenderMaterial","copyMaterial","transparent","depthTest","depthWrite","blendSrc","blendDst","blendEquation","blendSrcAlpha","blendDstAlpha","blendEquationAlpha","fsQuad","originalClearColor","prototype","create","constructor","dispose","render","writeBuffer","setRenderTarget","doRender","visible","renderOverride","renderMetalness","renderPass","OUTPUT","Default","renderToScreen","SSR","Beauty","Depth","Normal","Metalness","warn","passMaterial","renderTarget","clearColor","clearAlpha","getClearColor","originalClearAlpha","getClearAlpha","originalAutoClear","autoClear","setClearColor","setClearAlpha","material","overrideMaterial","traverseVisible","child","_SSRPassMaterialBack","includes","setSize"],"sources":["D:/Jord/l4fycy/node_modules/three-stdlib/postprocessing/SSRPass.js"],"sourcesContent":["import { Color, DepthTexture, UnsignedShortType, NearestFilter, WebGLRenderTarget, LinearFilter, RGBAFormat, HalfFloatType, ShaderMaterial, UniformsUtils, NoBlending, MeshNormalMaterial, MeshBasicMaterial, SrcAlphaFactor, OneMinusSrcAlphaFactor, AddEquation, NormalBlending } from 'three';\nimport { FullScreenQuad, Pass } from './Pass.js';\nimport { SSRShader, SSRBlurShader, SSRDepthShader } from '../shaders/SSRShader.js';\nimport { CopyShader } from '../shaders/CopyShader.js';\n\nvar SSRPass = function ({\n  renderer,\n  scene,\n  camera,\n  width,\n  height,\n  selects,\n  encoding,\n  isPerspectiveCamera = true,\n  isBouncing = false,\n  morphTargets = false,\n  groundReflector\n}) {\n  this.width = width !== undefined ? width : 512;\n  this.height = height !== undefined ? height : 512;\n  this.clear = true;\n  this.renderer = renderer;\n  this.scene = scene;\n  this.camera = camera;\n  this.groundReflector = groundReflector;\n  this.opacity = SSRShader.uniforms.opacity.value;\n  this.output = 0;\n  this.maxDistance = SSRShader.uniforms.maxDistance.value;\n  this.surfDist = SSRShader.uniforms.surfDist.value;\n  this.encoding = encoding;\n  this.tempColor = new Color();\n  this._selects = selects;\n  this.isSelective = Array.isArray(this._selects);\n  Object.defineProperty(this, 'selects', {\n    get() {\n      return this._selects;\n    },\n\n    set(val) {\n      if (this._selects === val) return;\n      this._selects = val;\n\n      if (Array.isArray(val)) {\n        this.isSelective = true;\n        this.ssrMaterial.defines.isSelective = true;\n        this.ssrMaterial.needsUpdate = true;\n      } else {\n        this.isSelective = false;\n        this.ssrMaterial.defines.isSelective = false;\n        this.ssrMaterial.needsUpdate = true;\n      }\n    }\n\n  });\n  this._isBouncing = isBouncing; ///todo: don't need defineProperty\n\n  Object.defineProperty(this, 'isBouncing', {\n    get() {\n      return this._isBouncing;\n    },\n\n    set(val) {\n      if (this._isBouncing === val) return;\n      this._isBouncing = val;\n\n      if (val) {\n        this.ssrMaterial.uniforms['tDiffuse'].value = this.prevRenderTarget.texture;\n      } else {\n        this.ssrMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n      }\n    }\n\n  });\n  this.isBlur = true;\n  this._isDistanceAttenuation = SSRShader.defines.isDistanceAttenuation;\n  Object.defineProperty(this, 'isDistanceAttenuation', {\n    get() {\n      return this._isDistanceAttenuation;\n    },\n\n    set(val) {\n      if (this._isDistanceAttenuation === val) return;\n      this._isDistanceAttenuation = val;\n      this.ssrMaterial.defines.isDistanceAttenuation = val;\n      this.ssrMaterial.needsUpdate = true;\n    }\n\n  });\n  this._isFresnel = SSRShader.defines.isFresnel;\n  Object.defineProperty(this, 'isFresnel', {\n    get() {\n      return this._isFresnel;\n    },\n\n    set(val) {\n      if (this._isFresnel === val) return;\n      this._isFresnel = val;\n      this.ssrMaterial.defines.isFresnel = val;\n      this.ssrMaterial.needsUpdate = true;\n    }\n\n  });\n  this._isInfiniteThick = SSRShader.defines.isInfiniteThick;\n  Object.defineProperty(this, 'isInfiniteThick', {\n    get() {\n      return this._isInfiniteThick;\n    },\n\n    set(val) {\n      if (this._isInfiniteThick === val) return;\n      this._isInfiniteThick = val;\n      this.ssrMaterial.defines.isInfiniteThick = val;\n      this.ssrMaterial.needsUpdate = true;\n    }\n\n  });\n  this.thickTolerance = SSRShader.uniforms.thickTolerance.value; // beauty render target with depth buffer\n\n  var depthTexture = new DepthTexture();\n  depthTexture.type = UnsignedShortType;\n  depthTexture.minFilter = NearestFilter;\n  depthTexture.maxFilter = NearestFilter;\n  this.beautyRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: LinearFilter,\n    magFilter: LinearFilter,\n    format: RGBAFormat,\n    depthTexture: depthTexture,\n    depthBuffer: true\n  }); //for bouncing\n\n  this.prevRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: LinearFilter,\n    magFilter: LinearFilter,\n    format: RGBAFormat\n  }); // normal render target\n\n  this.normalRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: NearestFilter,\n    magFilter: NearestFilter,\n    format: RGBAFormat,\n    type: HalfFloatType\n  }); // metalness render target\n  // if (this.isSelective) {\n\n  this.metalnessRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: NearestFilter,\n    magFilter: NearestFilter,\n    format: RGBAFormat\n  }); // }\n  // ssr render target\n\n  this.ssrRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n    minFilter: LinearFilter,\n    magFilter: LinearFilter,\n    format: RGBAFormat\n  });\n  this.blurRenderTarget = this.ssrRenderTarget.clone();\n  this.blurRenderTarget2 = this.ssrRenderTarget.clone(); // this.blurRenderTarget3 = this.ssrRenderTarget.clone();\n  // ssr material\n\n  if (SSRShader === undefined) {\n    console.error('THREE.SSRPass: The pass relies on SSRShader.');\n  }\n\n  this.ssrMaterial = new ShaderMaterial({\n    defines: Object.assign({\n      MAX_STEP: Math.sqrt(window.innerWidth * window.innerWidth + window.innerHeight * window.innerHeight)\n    }, SSRShader.defines),\n    uniforms: UniformsUtils.clone(SSRShader.uniforms),\n    vertexShader: SSRShader.vertexShader,\n    fragmentShader: SSRShader.fragmentShader,\n    blending: NoBlending\n  });\n\n  if (!isPerspectiveCamera) {\n    this.ssrMaterial.defines.isPerspectiveCamera = isPerspectiveCamera;\n    this.ssrMaterial.needsUpdate = true;\n  }\n\n  this.ssrMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n  this.ssrMaterial.uniforms['tNormal'].value = this.normalRenderTarget.texture; // if (this.isSelective) {\n\n  this.ssrMaterial.defines.isSelective = this.isSelective;\n  this.ssrMaterial.needsUpdate = true;\n  this.ssrMaterial.uniforms['tMetalness'].value = this.metalnessRenderTarget.texture; // }\n\n  this.ssrMaterial.uniforms['tDepth'].value = this.beautyRenderTarget.depthTexture;\n  this.ssrMaterial.uniforms['cameraNear'].value = this.camera.near;\n  this.ssrMaterial.uniforms['cameraFar'].value = this.camera.far;\n  this.ssrMaterial.uniforms['surfDist'].value = this.surfDist;\n  this.ssrMaterial.uniforms['resolution'].value.set(this.width, this.height);\n  this.ssrMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\n  this.ssrMaterial.uniforms['cameraInverseProjectionMatrix'].value.copy(this.camera.projectionMatrixInverse); // normal material\n\n  this.normalMaterial = new MeshNormalMaterial({\n    morphTargets\n  });\n  this.normalMaterial.blending = NoBlending; // if (this.isSelective) {\n  // metalnessOn material\n\n  this.metalnessOnMaterial = new MeshBasicMaterial({\n    color: 'white'\n  }); // metalnessOff material\n\n  this.metalnessOffMaterial = new MeshBasicMaterial({\n    color: 'black'\n  }); // }\n  // blur material\n\n  this.blurMaterial = new ShaderMaterial({\n    defines: Object.assign({}, SSRBlurShader.defines),\n    uniforms: UniformsUtils.clone(SSRBlurShader.uniforms),\n    vertexShader: SSRBlurShader.vertexShader,\n    fragmentShader: SSRBlurShader.fragmentShader\n  });\n  this.blurMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n  this.blurMaterial.uniforms['resolution'].value.set(this.width, this.height); // blur material 2\n\n  this.blurMaterial2 = new ShaderMaterial({\n    defines: Object.assign({}, SSRBlurShader.defines),\n    uniforms: UniformsUtils.clone(SSRBlurShader.uniforms),\n    vertexShader: SSRBlurShader.vertexShader,\n    fragmentShader: SSRBlurShader.fragmentShader\n  });\n  this.blurMaterial2.uniforms['tDiffuse'].value = this.blurRenderTarget.texture;\n  this.blurMaterial2.uniforms['resolution'].value.set(this.width, this.height); // // blur material 3\n  // this.blurMaterial3 = new ShaderMaterial({\n  //   defines: Object.assign({}, SSRBlurShader.defines),\n  //   uniforms: UniformsUtils.clone(SSRBlurShader.uniforms),\n  //   vertexShader: SSRBlurShader.vertexShader,\n  //   fragmentShader: SSRBlurShader.fragmentShader\n  // });\n  // this.blurMaterial3.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;\n  // this.blurMaterial3.uniforms['resolution'].value.set(this.width, this.height);\n  // material for rendering the depth\n\n  this.depthRenderMaterial = new ShaderMaterial({\n    defines: Object.assign({}, SSRDepthShader.defines),\n    uniforms: UniformsUtils.clone(SSRDepthShader.uniforms),\n    vertexShader: SSRDepthShader.vertexShader,\n    fragmentShader: SSRDepthShader.fragmentShader,\n    blending: NoBlending\n  });\n  this.depthRenderMaterial.uniforms['tDepth'].value = this.beautyRenderTarget.depthTexture;\n  this.depthRenderMaterial.uniforms['cameraNear'].value = this.camera.near;\n  this.depthRenderMaterial.uniforms['cameraFar'].value = this.camera.far; // material for rendering the content of a render target\n\n  this.copyMaterial = new ShaderMaterial({\n    uniforms: UniformsUtils.clone(CopyShader.uniforms),\n    vertexShader: CopyShader.vertexShader,\n    fragmentShader: CopyShader.fragmentShader,\n    transparent: true,\n    depthTest: false,\n    depthWrite: false,\n    blendSrc: SrcAlphaFactor,\n    blendDst: OneMinusSrcAlphaFactor,\n    blendEquation: AddEquation,\n    blendSrcAlpha: SrcAlphaFactor,\n    blendDstAlpha: OneMinusSrcAlphaFactor,\n    blendEquationAlpha: AddEquation // premultipliedAlpha:true,\n\n  });\n  this.fsQuad = new FullScreenQuad(null);\n  this.originalClearColor = new Color();\n};\n\nSSRPass.prototype = Object.assign(Object.create(Pass.prototype), {\n  constructor: SSRPass,\n  dispose: function () {\n    // dispose render targets\n    this.beautyRenderTarget.dispose();\n    this.prevRenderTarget.dispose();\n    this.normalRenderTarget.dispose(); // if (this.isSelective)\n\n    this.metalnessRenderTarget.dispose();\n    this.ssrRenderTarget.dispose();\n    this.blurRenderTarget.dispose();\n    this.blurRenderTarget2.dispose(); // this.blurRenderTarget3.dispose();\n    // dispose materials\n\n    this.normalMaterial.dispose(); // if (this.isSelective) {\n\n    this.metalnessOnMaterial.dispose();\n    this.metalnessOffMaterial.dispose(); // }\n\n    this.blurMaterial.dispose();\n    this.blurMaterial2.dispose();\n    this.copyMaterial.dispose();\n    this.depthRenderMaterial.dispose(); // dipsose full screen quad\n\n    this.fsQuad.dispose();\n  },\n  render: function (renderer, writeBuffer\n  /*, readBuffer, deltaTime, maskActive */\n  ) {\n    // render beauty and depth\n    if (this.encoding) this.beautyRenderTarget.texture.encoding = this.encoding;\n    renderer.setRenderTarget(this.beautyRenderTarget);\n    renderer.clear();\n\n    if (this.groundReflector) {\n      this.groundReflector.doRender(this.renderer, this.scene, this.camera);\n      this.groundReflector.visible = true;\n    }\n\n    renderer.render(this.scene, this.camera);\n    if (this.groundReflector) this.groundReflector.visible = false; // render normals\n\n    this.renderOverride(renderer, this.normalMaterial, this.normalRenderTarget, 0, 0); // render metalnesses\n\n    if (this.isSelective) {\n      this.renderMetalness(renderer, this.metalnessOnMaterial, this.metalnessRenderTarget, 0, 0);\n    } // render SSR\n\n\n    this.ssrMaterial.uniforms['opacity'].value = this.opacity;\n    this.ssrMaterial.uniforms['maxDistance'].value = this.maxDistance;\n    this.ssrMaterial.uniforms['surfDist'].value = this.surfDist;\n    this.ssrMaterial.uniforms['thickTolerance'].value = this.thickTolerance;\n    this.renderPass(renderer, this.ssrMaterial, this.ssrRenderTarget); // render blur\n\n    if (this.isBlur) {\n      this.renderPass(renderer, this.blurMaterial, this.blurRenderTarget);\n      this.renderPass(renderer, this.blurMaterial2, this.blurRenderTarget2); // this.renderPass(renderer, this.blurMaterial3, this.blurRenderTarget3);\n    } // output result to screen\n\n\n    switch (this.output) {\n      case SSRPass.OUTPUT.Default:\n        if (this.isBouncing) {\n          this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n          if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n          this.copyMaterial.blending = NormalBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n          this.copyMaterial.uniforms['tDiffuse'].value = this.prevRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        } else {\n          this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n          if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n          this.copyMaterial.blending = NormalBlending;\n          this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        }\n\n        break;\n\n      case SSRPass.OUTPUT.SSR:\n        if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n\n        if (this.isBouncing) {\n          if (this.isBlur) this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget2.texture;else this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n          this.copyMaterial.blending = NoBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n          this.copyMaterial.uniforms['tDiffuse'].value = this.ssrRenderTarget.texture;\n          this.copyMaterial.blending = NormalBlending;\n          this.renderPass(renderer, this.copyMaterial, this.prevRenderTarget);\n        }\n\n        break;\n\n      case SSRPass.OUTPUT.Beauty:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSRPass.OUTPUT.Depth:\n        this.renderPass(renderer, this.depthRenderMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSRPass.OUTPUT.Normal:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.normalRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSRPass.OUTPUT.Metalness:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.metalnessRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      default:\n        console.warn('THREE.SSRPass: Unknown output type.');\n    }\n  },\n  renderPass: function (renderer, passMaterial, renderTarget, clearColor, clearAlpha) {\n    // save original state\n    this.originalClearColor.copy(renderer.getClearColor(this.tempColor));\n    var originalClearAlpha = renderer.getClearAlpha(this.tempColor);\n    var originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget); // setup pass state\n\n    renderer.autoClear = false;\n\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n\n    this.fsQuad.material = passMaterial;\n    this.fsQuad.render(renderer); // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  },\n  renderOverride: function (renderer, overrideMaterial, renderTarget, clearColor, clearAlpha) {\n    this.originalClearColor.copy(renderer.getClearColor(this.tempColor));\n    var originalClearAlpha = renderer.getClearAlpha(this.tempColor);\n    var originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget);\n    renderer.autoClear = false;\n    clearColor = overrideMaterial.clearColor || clearColor;\n    clearAlpha = overrideMaterial.clearAlpha || clearAlpha;\n\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n\n    this.scene.overrideMaterial = overrideMaterial;\n    renderer.render(this.scene, this.camera);\n    this.scene.overrideMaterial = null; // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  },\n  renderMetalness: function (renderer, overrideMaterial, renderTarget, clearColor, clearAlpha) {\n    this.originalClearColor.copy(renderer.getClearColor(this.tempColor));\n    var originalClearAlpha = renderer.getClearAlpha(this.tempColor);\n    var originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget);\n    renderer.autoClear = false;\n    clearColor = overrideMaterial.clearColor || clearColor;\n    clearAlpha = overrideMaterial.clearAlpha || clearAlpha;\n\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n\n    this.scene.traverseVisible(child => {\n      child._SSRPassMaterialBack = child.material;\n\n      if (this._selects.includes(child)) {\n        child.material = this.metalnessOnMaterial;\n      } else {\n        child.material = this.metalnessOffMaterial;\n      }\n    });\n    renderer.render(this.scene, this.camera);\n    this.scene.traverseVisible(child => {\n      child.material = child._SSRPassMaterialBack;\n    }); // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  },\n  setSize: function (width, height) {\n    this.width = width;\n    this.height = height;\n    this.ssrMaterial.defines.MAX_STEP = Math.sqrt(width * width + height * height);\n    this.ssrMaterial.needsUpdate = true;\n    this.beautyRenderTarget.setSize(width, height);\n    this.prevRenderTarget.setSize(width, height);\n    this.ssrRenderTarget.setSize(width, height);\n    this.normalRenderTarget.setSize(width, height); // if (this.isSelective)\n\n    this.metalnessRenderTarget.setSize(width, height);\n    this.blurRenderTarget.setSize(width, height);\n    this.blurRenderTarget2.setSize(width, height); // this.blurRenderTarget3.setSize(width, height);\n\n    this.ssrMaterial.uniforms['resolution'].value.set(width, height);\n    this.ssrMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\n    this.ssrMaterial.uniforms['cameraInverseProjectionMatrix'].value.copy(this.camera.projectionMatrixInverse);\n    this.blurMaterial.uniforms['resolution'].value.set(width, height);\n    this.blurMaterial2.uniforms['resolution'].value.set(width, height);\n  }\n});\nSSRPass.OUTPUT = {\n  Default: 0,\n  SSR: 1,\n  Beauty: 3,\n  Depth: 4,\n  Normal: 5,\n  Metalness: 7\n};\n\nexport { SSRPass };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}